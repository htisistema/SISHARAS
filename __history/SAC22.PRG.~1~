* ENTRADA DE PRODUTO
********************
MEMVAR nivel_acess,mdata_sis,cod_operado,getlist,memp_resa,mend_firm,mcid_firm,;
       mfone_firm,minsc_firm,mcgc_firm

FUNCTION sac22
***************
LOCAL MPRG:='SAC22',mtitulo:='ENTRADA DE PRODUTO',;
      op,i,point,msaldo_atu,mmensagem,;
      m_transp:={},m_point:={},mcod_aux,mqtd_ent:={},mquantd_aux,;
      mpreco_aux,mvlr_base,mcod_nat,mtp_nota:='  ',mreg,y:=0,mtela_per,;
      aret:={},cComm,m_param:={},mtot_p,cons_ped:={},mgramatura:=0,machou:=0

PRIVATE opcao,tela,lba,cba,mcod_forn,mfornece,mnum_ped,f4,mp,mv,;
        mdat_ped,mped_forn,mdata_ped,micm,mfob,mcif,mdia1,mdia2,mdia3,mdia4,mdia5,;
        mtransp,mnota,mvol_nota,mvlr_nota,mcomprador,mrecebedor,memissao,msaida,;
        mchegada,mfrete,mfrete_aux,mencargo_f,mdisp_asse,mtot_vlr,mtot_vol,mcod_op,;
        mfabrica,muf,mperc,msaldo_mer,menc_aux,mdisp_aux,mpercent,MCONFIS,mpis,;
        mcod_merc,mgru_sub,mmerc,mcod_bc,mquantd,tp_ipi,mtot_des,msoma,mimposto,;
        munidade,mp_lucro,mpr_unit,mdesc1,mdesc2,mdesc3,mipi,mipi_aux,mpeso,;
        mvlr_merc,mcust_merc,mpr_venda,mlucro,mpr_medio,mcust_real,mvlr_fat,;
        mvlr_ent,mavista,m_entrada:={},m_demo:={},mii:=0,mii_aux:=0,mvlr_icmsub:=0,mbas_icmsu:=0,;
        micm_firm:=0,mcus_merc := 0,mcus_real := 0,mvl_nota,mvl_base,mdesc_aux,mnivel_cal:=' ',;
        mserie:=SPACE(3),mcfop,micmsub:=0,mmodelo:='  ',mvalor_icm:=0,muf_forn:='  ',;
        mnatureza,mcredito,msai_ent,mper_vlr,mper_qtd,m_tipo4:={},;
        mpr_unit4:=0,mvlr_merc4:=0,mcust_mer4:=0,mcust_rea4:=0,mpr_venda4:=0,;
        mpr_medio4:=0,mtot_icm:=0,mtot_ipi:=0,msaldo_ant:=0,set_aredonda,set_vlr_ent,mvarejo:=1,mnorm_ele:= 'N',;
        nulo:='NULL',mtot_icmsub := 0,mvlr_icm_sub := 0,mtipo_icmsub:='I',mcons_merc:={}

IF ! ver_nivel(mprg,mtitulo,'15',nivel_acess,,'AMBIE')
        RETURN NIL
ENDIF
lba = 23
cba = 90
*------------------------------------------------------------
IF ! AbriArq('sacbalan','balan');RETURN NIL;ENDIF
IF ! AbriArq('insopera','sen');RETURN NIL;ENDIF
IF ! AbriArq('sacdolar','dolar');RETURN NIL;ENDIF
IF ! AbriArq('sacped_e','ped_e');RETURN NIL;ENDIF
IF ! AbriArq('sacforn','forn');RETURN NIL;ENDIF
IF ! AbriArq('sacgrupo','grup');RETURN NIL;ENDIF
IF ! AbriArq('sacmerc','merc');RETURN NIL;ENDIF
IF ! AbriArq('sacmov','mov');RETURN NIL;ENDIF
IF ! AbriArq('sactotnt','totnt');RETURN NIL;ENDIF
IF ! AbriArq('sacicm','icm');RETURN NIL;ENDIF
IF ! AbriArq('sacuf','tabuf');RETURN NIL;ENDIF
IF ! AbriArq('sacdupp','dupp');RETURN NIL;ENDIF
IF ! AbriArq('sactran','tran');RETURN NIL;ENDIF
*------------------------------------------------------------
//SET KEY 281 TO f4_merc('*')           // inclusao de PRODUTO ALT+P
SET KEY -9 TO alt_dados()
***************
set_aredonda := m_set[1,103]
set_vlr_ent  := m_set[1,7]
micm_firm := m_set[1,20]
mpis := m_set[1,2]
mconfis := m_set[1,3]
mimposto := m_set[1,4]
mpercent := m_set[1,12]
mvlr_ent := m_set[1,7]
mavista := SPACE(1)
set_key('forn')
op_tela(00,05,27,95,mtitulo)
WHILE .T.
        exibi_prg(mprg)
        limpa(0,0,33,100)
        mnatureza:=SPACE(40)
        mcredito := msai_ent := ' '
        micm_firm := m_set[1,20]
        memissao  := mchegada  := mdata_sis
        mtot_vlr   := mtot_vol := mtot_icm := mtot_vlr := mtot_des :=;
        mtot_ipi   := mvol_nota := mvlr_nota := msoma := msaldo_atu := ;
        mnum_ped   := micm := mfrete := mfrete_aux := mencargo_f := menc_aux :=;
        mdisp_asse := mdisp_aux := msaldo_mer := mperc := mvlr_base := mcod_forn :=;
        mvalor_icm    := mvlr_icmsub := mbas_icmsub := mper_vlr := mper_qtd := mtot_icmsub := 0
        i := 1
        ASIZE(m_entrada,0)
        ASIZE(m_tipo4,0)
        ASIZE(m_demo,0)
        ASIZE(m_transp,0)
        ASIZE(m_point,0)
        ASIZE(mqtd_ent,0)
        mped_forn  := SPACE(6)
        mfornece   := mfabrica   := SPACE(30)
        mcod_op    := SPACE(2)
        mavista    := mfob := mcif := SPACE(1)
        mdia1      := mdia2 := mdia3 := mdia4 := mdia5 := mdia6 := mdia7 := mdia8 := mdia9 := mdia10 := SPACE(3)
        mnota      := SPACE(10)
        mtransp    := mcomprador := mrecebedor := SPACE(15)
        mv         := mnivel_cal := SPACE(1)
        mp         := 'X'
        mcod_nat   := SPACE(5)
        mdata_ped  := msaida := CTOD('  /  /  ')
        mmodelo    := '01'
        mtipo_icmsub:='I'
        SET INTEN ON
        mensagem('Preencha os Campos - <ESC> p/ Retornar')
        janela(0,0,' Informacoes de Impostos da Empresa ','*',1)
        DEVPOS(1,1);DEVOUT('ICM(%):')
        DEVPOS(1,14);DEVOUT('PIS(%):')
        DEVPOS(1,28);DEVOUT('Confis(%):')
        DEVPOS(1,45);DEVOUT('Outros Impostos(%):')
        @ 2,0 TO 2,cba
        janela(2,0,' Informacoes do Fornecedor ','*',1)
        DEVPOS(3,1);DEVOUT('No.Int.: ')
        DEVPOS(3,18);DEVOUT('No.Ped.:')
        DEVPOS(3,34);DEVOUT('Fornec.:')
        @ 4,0 TO 4,cba
        janela(4,0,' Informacoes da Nota ','*',1)
        DEVPOS(5,1);DEVOUT('Nivel:')
        DEVPOS(5,09);DEVOUT('FOB:')
        DEVPOS(5,15);DEVOUT('CIF:')
        DEVPOS(5,21);DEVOUT('Pag.:Av.:')
        DEVPOS(5,32);DEVOUT('Dias:')
        DEVPOS(6,1);DEVOUT('Numero:')
        DEVPOS(6,21);DEVOUT('Volume:')
        DEVPOS(6,41);DEVOUT('Valor:')
        DEVPOS(6,61);DEVOUT('Base ICMS:')
        DEVPOS(7,1);DEVOUT('Valor ICMS:')
        DEVPOS(7,32);DEVOUT('CFOP:')
        DEVPOS(7,44);DEVOUT('Serie:')
        DEVPOS(7,54);DEVOUT('Modelo:')
        DEVPOS(7,65);DEVOUT('Tipo de Nota:')
        DEVPOS(8,1);DEVOUT('Emissao:')
        DEVPOS(8,20);DEVOUT('Saida:')
        DEVPOS(8,37);DEVOUT('Chegada:')
        DEVPOS(8,56);DEVOUT('Frete:')
        DEVPOS(9,01);DEVOUT('Encargos:')
        DEVPOS(9,26);DEVOUT('Desp.Asse.:')
        DEVPOS(10,1);DEVOUT('Vlr.ICM Subst.:')
        DEVPOS(10,29);DEVOUT('Base ICM Subst.:')
        DEVPOS(10,59);DEVOUT('Tipo ICM-SUB [I]ndiv. [G]eral:')
        @ 11,0 TO 11,cba
        janela(11,0,' Mercadorias Solicitadas ','*',1)
        DEVPOS(12,1);DEVOUT('Cod.Produto:')
        DEVPOS(12,63);DEVOUT('UN:')
        DEVPOS(13,1);DEVOUT('CFOP......:')
        DEVPOS(14,1);DEVOUT('Quantidade:')
        DEVPOS(15,1);DEVOUT('Lucro (%).:')
        DEVPOS(16,1);DEVOUT('Vlr.Unit..:')
        DEVPOS(17,1);DEVOUT('ICMS (%)..:')
        DEVPOS(18,1);DEVOUT('Gramatura.:')
        DEVPOS(19,1);DEVOUT('Desconto..:')
        DEVPOS(20,1);DEVOUT('IPI (%)...:')
        DEVPOS(21,1);DEVOUT('I.I (%)...:')
        DEVPOS(22,1);DEVOUT('Vl.ICM Sub:')

        botao(14,49,21,76,,' Valores Atuais  ')
        DEVPOS(15,50);DEVOUT('Vlr.Mercad.:')
        DEVPOS(16,50);DEVOUT('Cus.Mercad.:')
        DEVPOS(17,50);DEVOUT('Custo Real.:')
        DEVPOS(18,50);DEVOUT('Custo Medio:')
        DEVPOS(19,50);DEVOUT('Preco Venda:')
        DEVPOS(20,50);DEVOUT('Lucro R$...:')
        DEVPOS(21,50);DEVOUT('Saldo Atual:             ')
        @ 23,0 TO 23,cba
        janela(23,0,' RESULTADOS ','*',1)
        DEVPOS(24,1);DEVOUT('Volume Informado:')
        DEVPOS(24,1);DEVOUT('Volume Informado:')
        DEVPOS(24,35);DEVOUT('Valor Informado:')
        DEVPOS(25,1);DEVOUT('Volume Digitados:')
        DEVPOS(25,35);DEVOUT('Valor Digitados:')
        DEVPOS(25,65);DEVOUT('Itens Digitados:')
        DEVPOS(26,19);DEVOUT('-----------')
        DEVPOS(26,52);DEVOUT('------------')
        DEVPOS(27,1);DEVOUT('Diferenca Vol...:')
        DEVPOS(27,35);DEVOUT('Difierenca Vlr.:')
        mcod_aux := SPACE(1)
        setcor(1)
        @ 35,00 GET mcod_aux PICT '9' VALID mcod_aux $ '1,2,3,4,9'
        READ
        IF LASTKEY() = 27
                RELEASE ALL
                wvw_lclosewindow()
                RETURN NIL
        ENDIF
        Wvw_SetTitle( ,' Entrada de Mercadoria '+mcod_aux)
        mcod_op = STRZERO(VAL(mcod_aux),2)
        IF mcod_op = '04'
                mtela_per := SAVESCREEN(00,00,24,79)
                botao(04,10,07,50,,' Percentual de Nota ')
                DEVPOS(05,11);DEVOUT('Percentual do Valor.....:')
*               DEVPOS(06,11);DEVOUT('Percentual da Quantidade:')
                @ 05,37 GET mper_vlr PICT '999.99'
*               @ 06,37 GET mper_qtd PICT '999.99'
                READ
                IF EMPTY(mper_vlr) .AND. EMPTY(mper_qtd)
                        atencao('Este modulo tem que ser informado algum percentual !!!')
                        RESTSCREEN(00,00,24,79,mtela_per)
                        LOOP
                ENDIF
                opcao := op_simnao('S','Confirma os percentuais:')
                RESTSCREEN(00,00,24,79,mtela_per)
                IF opcao = 'N';LOOP;ENDIF
        ENDIF
        IF mcod_op <> '09'
                IF mcod_op = '02'
                        micm_firm := mpis := mconfis :=0
                ENDIF
                @ 1,08 GET micm_firm PICT '99.99'       //VALID lim_get() WHEN men_get(2,9,'Informe o percentual de ICM do Estado ou ENTER p/continuar')
                @ 1,21 GET mpis PICT '999.99' WHEN m_set[1,8] <> 'N'
                @ 1,38 GET mconfis PICT '999.99' WHEN m_set[1,8] <> 'N'
                @ 1,64 GET mimposto PICT '999.99' WHEN m_set[1,8] <> 'N'
                @ 3,10 GET mnum_ped PICT '999999' WHEN m_set[1,8] <> 'N'      //.AND. men_get(4,13,'Informe o No.do pedido interno ou ENTER p/continuar') VALID lim_get()
                READ
                IF LASTKEY() = 27
                        fimset()
                        RELEASE ALL
                        wvw_lclosewindow()
                        RETURN NIL
                ENDIF
                setcor(3)
                DEVPOS(3,10);DEVOUT(STRZERO(mnum_ped,6))
                setcor(1)
                IF ! EMPTY(mnum_ped)
                        ********************
                        SELE('ped_e');ORDSETFOCUS(1)
                        GO TOP
                        ********************
                        SEEK STRZERO(mnum_ped,6)
                        IF ! FOUND()
                                atencao('Pedido nao Cadastrado !!!')
                                LOOP
                        ENDIF
                        IF ped_e->recebi = '*'
                                atencao('Este Pedido ja foi Processado !!!')
                                LOOP
                        ENDIF
                        mped_forn:= ped_e->ped_forn
                        mdata_ped := ped_e->dat_ped
                        memissao := ped_e->dat_ped
                        mcod_forn := VAL(ped_e->cod_forn)
                        mfornece := ped_e->fornece
                        mcif := ped_e->cif
                        mfob := ped_e->fob
                        IF ped_e->dia1 = 'AV'
                                mavista = 'X'
                        ELSE
                                mdia1 := ped_e->dia1
                        ENDIF
                        mdia2 := ped_e->dia2
                        mdia3 := ped_e->dia3
                        mdia4 := ped_e->dia4
                        mdia5 := ped_e->dia5
                        mtransp := ped_e->transp
                        mcomprador := ped_e->comprador
                        mfrete_aux := ped_e->frete
                        menc_aux := ped_e->encargo_f
                        mdisp_aux := ped_e->disp_asse
                        IF ped_e->tp_desc = 'P'
                                mp := 'X'
                        ELSE
                                mv := 'X'
                        ENDIF
                ENDIF
                @ 3,27 GET mped_forn PICT '999999'      //WHEN men_get(4,36,'Informe o No.do pedido fornecedor ou ENTER p/continuar') VALID lim_get()
                READ
                IF LASTKEY() = 27;LOOP;ENDIF
                IF EMPTY(mnum_ped)
                        f6_forn()
                ENDIF
                @ 3,42 GET mcod_forn PICT '9999' VALID IF(EMPTY(mcod_forn),.F.,ent_forn(@mcod_forn,3,47))
                READ
                setcor(3)
                DEVPOS(3,42);DEVOUT(STRZERO(mcod_forn,4))
                DEVPOS(3,47);DEVOUT(forn->razao)
                muf_forn := muf := forn->uf
                mfornece := forn->razao
                setcor(1)
                ver_uf(muf)
                micm := mperc
                IF LASTKEY() = 27;LOOP;ENDIF
                opcao := 'S'
                IF mcod_op = '02' .OR. mcod_op = '04'
                        micm_firm = 0
                ENDIF
                @ 5,7 GET mnivel_cal PICT '@!' VALID mnivel_cal $ '1,2,3'       //.AND. lim_get() WHEN men_get(6,7,'Nivel [1]: Verifica dos os dados valor total da NOTA e volume - NIVEL [2]: Verifica o Volume e o preco de venda e calculado so o percentual de lucro')
                @ 5,13 GET mfob PICT '@!' VALID mfob $ 'X, '    //.AND. lim_get() WHEN men_get(6,13,'Se o frete for pago pela empresa ou ENTER p/continuar')
                @ 5,19 GET mcif PICT '@!' VALID mcif $ 'X, ' WHEN mfob = ' '
                @ 5,30 GET mavista PICT '@!' VALID mavista $ 'X, '      //.AND. lim_get() WHEN men_get(6,42,'Informe os dias de prazo para pagamento p/que possa ser Gerada a DUPLICATA A PAGAR')
                @ 5,37 GET mdia1 PICT '999' WHEN mavista = ' '
                @ 5,41 GET mdia2 PICT '999' WHEN mavista = ' ' .AND. ! EMPTY(mdia1)
                @ 5,45 GET mdia3 PICT '999' WHEN mavista = ' ' .AND. ! EMPTY(mdia2)
                @ 5,49 GET mdia4 PICT '999' WHEN mavista = ' ' .AND. ! EMPTY(mdia3)
                @ 5,53 GET mdia5 PICT '999' WHEN mavista = ' ' .AND. ! EMPTY(mdia4)
                @ 5,57 GET mdia6 PICT '999' WHEN mavista = ' ' .AND. ! EMPTY(mdia5)
                @ 5,61 GET mdia7 PICT '999' WHEN mavista = ' ' .AND. ! EMPTY(mdia6)
                @ 5,65 GET mdia8 PICT '999' WHEN mavista = ' ' .AND. ! EMPTY(mdia7)
                @ 5,69 GET mdia9 PICT '999' WHEN mavista = ' ' .AND. ! EMPTY(mdia8)
                @ 5,73 GET mdia10 PICT '999' WHEN mavista = ' ' .AND. ! EMPTY(mdia9)
                @ 6,09 GET mnota PICT '@!' VALID ver_ent()
                READ
                IF LASTKEY() = 27;LOOP;ENDIF
                IF mcod_op = '02'
                        mtp_nota := 'PD'
                ELSE
                        mtp_nota := 'NF'
                ENDIF
                mensagem('Fazendo Pesquisa da NOTA FISCAL se ja foi Processada Aguarde......')
                aret:={}
                sr_getconnection():exec( "select sr_recno from sacmov where sacmov.documento = "+sr_cdbvalue(mtp_nota+mnota)+" AND sacmov.ent_sai = 'E' AND sacmov.cod_forn = "+sr_cdbvalue(STRZERO(mcod_forn,4)),,.t.,@aret)
                setcor(1)
                *************
                IF LEN(aret) > 0
                        atencao('Esta Nota ja foi processada')
                        LOOP
                ENDIF
                **************************
                SELE('mov');ORDSETFOCUS(4)
                **************************
                mensagem('Preencha os Campos - <ESC> p/ Retornar')
                @ 6,29 GET mvol_nota PICT '999,999.999' VALID IF(EMPTY(mvol_nota),.F.,.T.)
                @ 6,47 GET mvlr_nota PICT '9,999,999.99' VALID IF(EMPTY(mvlr_nota),.F.,.T.)
                @ 6,71 GET mvlr_base PICT '9,999,999.99' WHEN (mnivel_cal = '1' .OR. mnivel_cal = '3') .AND. m_set[1,8] <> 'N'
                @ 7,12 GET mvalor_icm PICT '999,999.99' VALID IF(mvalor_icm > mvlr_base,.F.,.T.) WHEN (mnivel_cal = '1' .OR. mnivel_cal = '3') .AND. m_set[1,8] <> 'N'
                @ 7,38 GET mcod_nat PICT '9.999' VALID IF(EMPTY(mcod_nat),.F.,ver_nat(mcod_nat,'E')) WHEN (mnivel_cal = '1' .OR. mnivel_cal = '3') .AND. m_set[1,8] <> 'N'
                READ
                IF LASTKEY() = 27;LOOP;ENDIF
                @ 7,51 GET mserie PICT '@!' WHEN m_set[1,8] <> 'N'
                @ 7,62 GET mmodelo PICT '@!' WHEN m_set[1,8] <> 'N'
                @ 7,79 GET mnorm_ele PICT '@!' VALID mnorm_ele $ 'N,E' .AND. lim_get() WHEN men_get(0,0,'Informe os [N]->p/Nota Fiscal NORMAL ou [E]-> p/Nota Fiscal ELETRONICA')
                @ 8,10 GET memissao PICT '99/99/99'
                @ 8,27 GET msaida PICT '99/99/99' WHEN (mnivel_cal = '1' .OR. mnivel_cal = '3') .AND. m_set[1,8] <> 'N'
                @ 8,46 GET mchegada PICT '99/99/99' VALID IF(EMPTY(mchegada),.F.,.T.)
                @ 8,62 GET mfrete_aux PICT '999,999.99' VALID IF(mfob = 'X' .AND. EMPTY(mfrete_aux),.F.,.T.) WHEN (mnivel_cal = '1' .OR. mnivel_cal = '3') .AND. mcif = ' ' .AND. m_set[1,8] <> 'N'
                @ 9,11 GET menc_aux PICT '999,999.99'   //WHEN mnivel_cal = '1'
                @ 9,38 GET mdisp_aux PICT '999,999.99'  //WHEN mnivel_cal = '1'
                @ 10,17 GET mvlr_icmsub PICT '999,999.99' WHEN m_set[1,8] <> 'N'      //.AND. WHEN mnivel_cal = '1'
                @ 10,47 GET mbas_icmsub PICT '999,999.99' VALID IF(mbas_icmsub <= mvlr_icmsub,.F.,.T.) WHEN m_set[1,8] <> 'N' .AND. mvlr_icmsub > 0      //.AND. WHEN mnivel_cal = '1'
                @ 10,89 GET mtipo_icmsub PICT '@!' VALID lim_get() WHEN m_set[1,8] <> 'N' .AND. mvlr_icmsub > 0 .AND. men_get(0,0,'Informe [I] Para infomar o ICM-SUB por Produto [G]eral o ICM-SUB FRACIONADO para todos os Produtos')
                //@ 10,78 GET mtot_icmsub PICT '999,999.99' VALID IF(mtot_icmsub <= mbas_icmsub,.T.,.F.) .AND. lim_get() WHEN m_set[1,8] <> 'N' .AND. mvlr_icmsub > 0 .AND. men_get(2,9,'Informe o Valor Total dos Produtos que possui ICMS Subst. CST:[060]')
                //@ 10,60 GET mp PICT '@!' VALID mp $ 'X, ' WHEN (mnivel_cal = '1' .OR. mnivel_cal = '3') .AND. EMPTY(mnum_ped)
                //@ 10,71 GET mv PICT '@!' VALID IF(EMPTY(mp) .AND. EMPTY(mv) .AND. LASTKEY() = 13,.F.,.T.) WHEN (mnivel_cal = '1' .OR. mnivel_cal = '3') .AND. EMPTY(mnum_ped) .AND. mp = ' '
                READ
                IF LASTKEY() = 27;LOOP;ENDIF
                DEVPOS(24,19);DEVOUT(TRANSFORM(mvol_nota,'999,999.999'))
                DEVPOS(24,52);DEVOUT(TRANSFORM(mvlr_nota,'9,999,999.99'))

                IF muf_forn <> 'EX'
                        mcfop := mcod_nat
                        IF ! EMPTY(mnum_ped)
                                ASIZE(mqtd_ent,0)
                                ********************
                                SELE('ped_e');ORDSETFOCUS(1)
                                GO TOP
                                ********************
                                SEEK STRZERO(mnum_ped,6)

                                mped_forn := ped_e->ped_forn
                                mdata_ped := ped_e->dat_ped
                                mcod_forn := VAL(ped_e->cod_forn)
                                mfornece := ped_e->fornece
                                mcif := ped_e->cif
                                mfob := ped_e->fob
                                mdia1 := ped_e->dia1
                                mdia2 := ped_e->dia2
                                mdia3 := ped_e->dia3
                                mtransp := ped_e->transp
                                mcomprador := ped_e->comprador
                                mfrete_aux := ped_e->frete
                                menc_aux := ped_e->encargo_f
                                mdisp_aux := ped_e->disp_asse
                                mquantd := ped_e->quantd
                                mquantd_aux := ped_e->quantd
                                mpreco_aux := mvlr_fat := ped_e->vlr_fat
                                mipi_aux := ped_e->ipi
                                WHILE STRZERO(mnum_ped,6) = ped_e->num_ped .AND. ! EOF()
                                        AADD(mqtd_ent,{ped_e->cod_merc,ped_e->quantd})
                                        mtot_des := (ped_e->vlr_fat * ped_e->quantd)
                                        IF ped_e->tp_desc = 'R'
                                                mtot_des := mtot_des - ped_e->desc1 * ped_e->quantd
                                                mtot_des := mtot_des - ped_e->desc2 * ped_e->quantd
                                                mtot_des := mtot_des - ped_e->desc3 * ped_e->quantd
                                                mtot_vlr := mtot_vlr + (mtot_des + (ped_e->ipi*ped_e->quantd))
                                        ELSE
                                                mtot_des := mtot_des - (mtot_des * (ped_e->desc1 / 100))
                                                mtot_des := mtot_des - (mtot_des * (ped_e->desc2 / 100))
                                                mtot_des := mtot_des - (mtot_des * (ped_e->desc3 / 100))
                                                mtot_vlr := mtot_vlr + (mtot_des + (mtot_des * (ped_e->ipi/100)))
                                        ENDIF
                                        mtot_vlr := iat(mtot_vlr,2)
                                        mtot_vol := mtot_vol + ped_e->quantd
                                        mtot_des := 0
                                        DEVPOS(25,19);DEVOUT(TRANSFORM(mtot_vol,'999,999.999'))
                                        DEVPOS(25,52);DEVOUT(TRANSFORM(mtot_vlr,'9,999,999.99'))
                                        DEVPOS(25,82);DEVOUT(TRANSFORM(LEN(mqtd_ent),'9,999'))
                                        DEVPOS(27,19);DEVOUT(TRANSFORM(mvol_nota - mtot_vol,'999,999.999'))
                                        DEVPOS(27,52);DEVOUT(TRANSFORM(mvlr_nota - mtot_vlr,'9,999,999.99'))
                                        SKIP
                                ENDDO
                        ENDIF
                        opcao := op_simnao('S','Confirma os dados da Nota Fiscal:')
                        IF opcao = 'N'
                                LOOP
                        ELSE
                                IF mfrete_aux + menc_aux > mvlr_nota
                                        atencao('Frete mais encargos esta maior que valor da nota !!!')
                                        LOOP
                                ENDIF
                                //mfrete := (IF(ver_serie() = '141204',mfrete_aux*.93,mfrete_aux)/mvlr_nota)

                                mfrete := mfrete_aux/(mvlr_nota - mfrete_aux)
                                mencargo_f := (menc_aux/mvlr_nota)
                                mdisp_asse := (mdisp_aux/mvlr_nota)
                                msoma := mtot_vlr - (mvlr_nota - mfrete_aux - menc_aux - mvlr_icmsub)
                                IF msoma > set_vlr_ent .OR. msoma < (set_vlr_ent * -1) .OR. mtot_vol <> mvol_nota
                                        IF ! EMPTY(mnum_ped)
                                                mmensagem := SAVESCREEN(12,09,22,60)
                                                setcor(3)
                                                botao(12,10,21,60)
                                                setcor(1)
                                                DEVPOS(13,12);DEVOUT('Valor da Nota:')
                                                DEVPOS(14,12);DEVOUT('Valor Pedido.:')
                                                DEVPOS(15,12);DEVOUT('Diferenca....:')
                                                DEVPOS(16,12);DEVOUT('Volume Nota..:')
                                                DEVPOS(17,12);DEVOUT('Volume Pedido:')
                                                DEVPOS(18,12);DEVOUT('Diferenca....:')
                                                setcor(3)
                                                DEVPOS(13,27);DEVOUT(TRANSFORM(mvlr_nota - menc_aux - mfrete_aux,'999,999,999.99'))
                                                DEVPOS(14,27);DEVOUT(TRANSFORM(mtot_vlr,'999,999,999.99'))
                                                DEVPOS(15,27);DEVOUT(TRANSFORM(mtot_vlr - (mvlr_nota - menc_aux - mfrete_aux),'999999,999.99'))
                                                DEVPOS(16,27);DEVOUT(TRANSFORM(mvol_nota,'999999.999'))
                                                DEVPOS(17,27);DEVOUT(TRANSFORM(mtot_vol,'999999.999'))
                                                DEVPOS(18,27);DEVOUT(TRANSFORM(mvol_nota - mtot_vol,'999999.999'))
                                                setcor(1)
                                                @ 19,11 TO 19,59
                                                SETCOLOR('i')
                                                DEVPOS(20,12);DEVOUT('Pressione qualquer tecla p/continuar')
                                                setcor(1)
                                                INKEY(0)
                                                RESTSCREEN(12,09,22,60,mmensagem)
                                        ENDIF
                                        mtot_vlr := mtot_vol := 0
                                        ASIZE(m_tipo4,0)
                                        ASIZE(m_entrada,0)
                                        ASIZE(m_demo,0)
                                        WHILE .T.
                                                botao(14,49,21,76,,' Valores Atuais  ')
                                                DEVPOS(15,50);DEVOUT('Vlr.Mercad.:')
                                                DEVPOS(16,50);DEVOUT('Cus.Mercad.:')
                                                DEVPOS(17,50);DEVOUT('Custo Real.:')
                                                DEVPOS(18,50);DEVOUT('Custo Medio:')
                                                DEVPOS(19,50);DEVOUT('Preco Venda:')
                                                DEVPOS(20,50);DEVOUT('Lucro R$...:')
                                                DEVPOS(21,50);DEVOUT('Saldo Atual:             ')

                                                mmerc := SPACE(40)
                                                munidade := SPACE(3)
                                                mp_lucro := mpr_unit := mvlr_merc := mcus_merc := mcus_real :=;
                                                mpr_venda := mpr_medio := mlucro := mdesc1 := mdesc2 := mdesc3 := mipi := ;
                                                mipi_aux := mii := mii_aux := mpeso := mquantd := mcod_merc := ;
                                                mdesc_aux := mvlr_merc4 := mcus_merc4 := mcus_real4 := mpr_venda4 := ;
                                                mpr_medio4 := mpr_unit4 := 0
                                                setcor(3)
                                                DEVPOS(12,14);DEVOUTPICT(mcod_merc,'9999')
                                                DEVPOS(12,20);DEVOUT(mmerc)
                                                DEVPOS(12,66);DEVOUT(munidade)
                                                DEVPOS(15,13);DEVOUTPICT(mp_lucro,'999.99')
                                                IF mp == 'X'
                                                        tp_ipi = 'PERCENTUAL'
                                                ELSE
                                                        tp_ipi = 'VALOR (R$)'
                                                ENDIF
                                                setcor(1)
                                                mensagem('Digite Codigo ou <ENTER>p/Desc. - <ALT+P>Cad.PROD. - <F10> Consulta - P/alterar valor da nota digite = ALTERAR NOTA')
                                                mcod_bc := SPACE(14)
                                                f4 := ' '
                                                @ 12,14 GET mcod_bc PICT '@!' //WHEN men_get(13,14,'Digite o Codigo ou <ENTER>p/Digitar Descricao - <ALT+P>cadastra PRODUTOS')
                                                READ
                                                IF LASTKEY() = 27
                                                        opcao := op_simnao('N','Deseja abandonar a entrada da NOTA:')
                                                        IF opcao = 'N'
                                                                LOOP
                                                        ENDIF
                                                        RESTSCREEN(00,00,24,79,tela)
                                                        DBCLOSEALL()
                                                        wvw_lclosewindow()
                                                        RETURN NIL
                                                ENDIF
                                                IF mcod_bc = 'ALTERAR NOTA'
                                                        IF ! aut_sen('**** Senha p/Liberar a Alteracao:','ALT_DADOS')
                                                                LOOP
                                                        ENDIF
                                                        @ 6,25 GET mvol_nota PICT '999,999.999' VALID IF(EMPTY(mvol_nota),.F.,.T.)
                                                        @ 6,43 GET mvlr_nota PICT '9,999,999.99' VALID IF(EMPTY(mvlr_nota),.F.,.T.)
                                                        READ
                                                        LOOP
                                                ENDIF
                                                IF ! EMPTY(mcod_bc)
                                                        IF LEN(RTRIM(mcod_bc)) > 5 .OR. VAL(mcod_bc) = 0
                                                                mcons_merc:={}
                                                                sr_getconnection():exec("SELECT * FROM sacmerc WHERE cod_barr = "+sr_cdbvalue(mcod_bc),,.t.,@mcons_merc)
                                                                IF LEN(mcons_merc) = 0
                                                                        mcons_merc:={}
                                                                        sr_getconnection():exec("SELECT * FROM sacmerc WHERE ref = "+sr_cdbvalue(mcod_bc),,.t.,@mcons_merc)
                                                                        IF LEN(mcons_merc) = 0
                                                                                atencao('Codigo de BARRA e REFERENCIA AUXILIAR nao cadastrado')
                                                                                LOOP
                                                                        ENDIF
                                                                ENDIF
                                                                mcod_merc := VAL(mcod_bc)
                                                        ELSE
                                                                mcod_merc := VAL(mcod_bc)
                                                                mcons_merc:={}
                                                                sr_getconnection():exec("SELECT * FROM sacmerc WHERE cod_merc = "+sr_cdbvalue(STRZERO(mcod_merc,5)),,.t.,@mcons_merc)
                                                                IF LEN(mcons_merc) = 0
                                                                        atencao('Codigo da mercadoria nao cadastrado')
                                                                        LOOP
                                                                ENDIF
                                                        ENDIF
                                                ELSEIF ! EMPTY(mmerc)
                                                        IF(m_set[1,93] <> 'A',f4_merc(),f4_merc1())
                                                                //f4_merc()
                                                                IF LASTKEY() = 27;LOOP;ENDIF
                                                                mcons_merc:={}
                                                                sr_getconnection():exec("SELECT * FROM sacmerc WHERE cod_merc = "+sr_cdbvalue(STRZERO(mcod_merc,5)),,.t.,@mcons_merc)
                                                                IF LEN(mcons_merc) = 0
                                                                        atencao('Codigo da mercadoria nao cadastrado')
                                                                        LOOP
                                                                ENDIF
                                                ENDIF
                                                IF EMPTY(mcod_bc) .AND. EMPTY(mmerc)
                                                        LOOP
                                                ENDIF
                                                y := 0
                                                machou := SPACE(5)
                                                FOR y = 1 TO LEN(m_entrada)
                                                        IF mcod_merc = m_entrada[y,2]
                                                                machou := STRZERO(m_entrada[y,2],5)
                                                                EXIT
                                                        ENDIF
                                                NEXT
                                                IF ! EMPTY(machou) .AND. ver_serie() <> '141302'
                                                        atencao('Este Produto ja foi Incluido')
                                                        mcfop      := m_entrada[y,25]
                                                        mcod_nat   := m_entrada[y,25]
                                                        mquantd    := m_entrada[y,20]
                                                        mpr_unit   := m_entrada[y,4]
                                                        micm       := m_entrada[y,27]
                                                        mgramatura := m_entrada[y,11]
                                                        mdesc1     := m_entrada[y,14]
                                                        mdesc2     := m_entrada[y,15]
                                                        mcons_merc:={}
                                                        sr_getconnection():exec("SELECT * FROM sacmerc WHERE cod_merc = "+sr_cdbvalue(machou),,.t.,@mcons_merc)
                                                        IF LEN(mcons_merc) = 0
                                                                atencao('Codigo da mercadoria nao cadastrado')
                                                                LOOP
                                                        ENDIF
                                                ENDIF

                                                mcod_merc := VAL(mcons_merc[1,8])
                                                mmerc := mcons_merc[1,9]
                                                munidade := mcons_merc[1,14]
                                                mp_lucro := mcons_merc[1,22]
                                                mpeso := mcons_merc[1,17]
						mgramatura := mcons_merc[1,76]
                                                mvlr_icm_sub := 0
                                                setcor(3)
                                                DEVPOS(12,14);DEVOUT(STRZERO(mcod_merc,5))
                                                DEVPOS(12,21);DEVOUT(mmerc)
                                                DEVPOS(12,66);DEVOUT(munidade)
                                                DEVPOS(15,13);DEVOUTPICT(mp_lucro,'999.99')
                                                DEVPOS(18,13);DEVOUTPICT(mgramatura,'9.999')
                                                DEVPOS(15,63);DEVOUTPICT(mcons_merc[1,43],'9,999,999.99')
                                                DEVPOS(16,63);DEVOUTPICT(mcons_merc[1,44],'9,999,999.99')
                                                DEVPOS(17,63);DEVOUTPICT(mcons_merc[1,45],'9,999,999.99')
                                                DEVPOS(18,63);DEVOUTPICT(mcons_merc[1,48],'9,999,999.99')
                                                DEVPOS(19,63);DEVOUTPICT(mcons_merc[1,46],'9,999,999.99')
                                                DEVPOS(20,63);DEVOUTPICT(mcons_merc[1,46]-mcons_merc[1,48],'9,999,999.99')
                                                DEVPOS(21,63);DEVOUTPICT(mcons_merc[1,56],'999,999.99')
                                                setcor(1)

                                                //ver_merc()
                                                mcfop := mcod_nat
                                                @ 13,13 GET mcfop PICT '9.999'
                                                @ 14,13 GET mquantd PICT (unidade(mcons_merc[1,14])) VALID IF(EMPTY(mquantd),.F.,.T.)
                                                @ 15,13 GET mp_lucro PICT '999.99'      //VALID lim_get() WHEN men_get(14,28,'Informe o percentual de lucro que deseja')
                                                //@ 16,13 GET mpr_unit PICT (ALLTRIM(m_set[1,97])) VALID IF(EMPTY(mpr_unit),.F.,.T.)    //WHEN men_get(14,45,'Informe o Valor de Venda')
                                                @ 16,13 GET mpr_unit PICT '9,999,999.9999' VALID IF(EMPTY(mpr_unit),.F.,.T.)    //WHEN men_get(14,45,'Informe o Valor de Venda')
                                                @ 17,13 GET micm PICT '999.99' WHEN (mnivel_cal = '1' .OR. mnivel_cal = '3')    //.AND. men_get(14,62,'Informe o percentual de ICMS')
                                                @ 18,13 GET mgramatura PICT '9,999' WHEN mgramatura > 0
                                                //@ 19,13 GET mdesc1 PICT '9999.9999' WHEN (mnivel_cal = '1' .OR. mnivel_cal = '3')       //.AND. men_get(15,09,'Informe desconto '+tp_ipi)
                                                @ 20,13 GET mipi_aux PICT '999,999.9999' WHEN (mnivel_cal = '1' .OR. mnivel_cal = '3')  //.AND. men_get(15,45,'Informe IPI '+tp_ipi)
                                                @ 21,13 GET mii_aux PICT '9999.999' WHEN (mnivel_cal = '1' .OR. mnivel_cal = '3')       //.AND. men_get(15,45,'Informe I.I. [Imposto de Importacao] '+tp_ipi)
                                                @ 22,13 GET mvlr_icm_sub PICT '999,999.99' WHEN (mnivel_cal = '1' .OR. mnivel_cal = '3') .AND. mtipo_icmsub = 'I'
                                                READ
                                                IF LASTKEY() = 27;LOOP;ENDIF
                                                mquantd_aux := mquantd
                                                mpreco_aux := mpr_unit
                                                IF mgramatura > 1
                                                        mquantd := mquantd_aux * mgramatura
                                                        mpr_unit := mpreco_aux / mgramatura
                                                ENDIF
                                                IF mv = 'X'
                                                        mipi := (mipi_aux / (mquantd * mpr_unit)) * 100
                                                        mii := (mii_aux / (mquantd * mpr_unit)) * 100
                                                        mdesc_aux := (mdesc1 / mpr_unit) * 100
                                                        mdesc1 := mdesc_aux
                                                        mdesc_aux := (mdesc2 / mpr_unit) * 100
                                                        mdesc2 := mdesc_aux
                                                        mdesc_aux := (mdesc3 / mpr_unit) * 100
                                                        mdesc3 := mdesc_aux
                                                ELSEIF mp = 'X'
                                                        mipi := mipi_aux
                                                        mii := mii_aux
                                                ENDIF
                                                setcor(3)
                                                DEVPOS(14,13);DEVOUTPICT(mquantd,(unidade(mcons_merc[1,14])))
                                                DEVPOS(16,13);DEVOUTPICT(mpr_unit,'9,999,999.9999')
                                                setcor(1)
                                                * Calculo de Custo da Mercadoria
                                                calc_cus()
                                                ********************************
                                                IF ! EMPTY(machou) .AND. ver_serie() <> '141302'
                                                        opcao := op_simnao('S','Confirma a Alteracao da Mercadoria:')
                                                ELSE
                                                        opcao := op_simnao('S','Confirma a Entrada da Mercadoria:')
                                                ENDIF
                                                IF opcao = 'N'
                                                        LOOP
                                                ELSE
                                                        mtot_icmsub := mtot_icmsub + mvlr_icm_sub
                                                        SR_BEGINTRANSACTION()
                                                        TRY
                                                                sr_getconnection():exec("UPDATE sacmerc SET p_lucro = "+sr_cdbvalue(mp_lucro) +" WHERE cod_merc = "+sr_cdbvalue(mcons_merc[1,8]),,.f.)
                                                                sr_getconnection():exec('COMMIT',,.f.)
                                                                sr_committransaction()
                                                        CATCH e
                                                        SR_ENDTRANSACTION()
                                                        END

                                                        IF ! EMPTY(machou) .AND. ver_serie() <> '141302'
                                                                m_entrada[y,25] := mcfop     
                                                                m_entrada[y,25] := mcod_nat  
                                                                m_entrada[y,20] := mquantd   
                                                                m_entrada[y,10] := mquantd   
                                                                m_entrada[y,4]  := mpr_unit  
                                                                m_entrada[y,27] := micm      
                                                                m_entrada[y,11] := mgramatura
                                                                m_entrada[y,14] := mdesc1    
                                                                m_entrada[y,15] := mdesc2    
                                                                m_demo[y]       := STRZERO(mcod_merc,5)+'-'+mmerc+' '+TRANSFORM(mquantd_aux,'99999.9999')+' '+TRANSFORM(mpreco_aux,'9,999,999.99')
                                                                
                                                                mtot_des := mtot_vlr := mtot_vol := x := 0
                                                                
                                                                FOR x = 1 TO LEN(m_entrada)
                                                                        mtot_des := (m_entrada[x,4] * m_entrada[x,20])
                                                                        mtot_des := mtot_des - (mtot_des * (m_entrada[x,14] / 100))
                                                                        mtot_des := mtot_des - (mtot_des * (m_entrada[x,15] / 100))
                                                                        mtot_vlr := mtot_vlr + (mtot_des + ((m_entrada[x,4]*m_entrada[x,20]) * (m_entrada[x,12]/100)))
                                                                        mtot_vlr := mtot_vlr + (mtot_des + ((m_entrada[x,4]*m_entrada[x,20]) * (m_entrada[x,22]/100)))
                                                                        mtot_vlr := iat(mtot_vlr,2)
                                                                        mtot_vol := iat(mtot_vol + m_entrada[x,20],set_aredonda)
                                                                NEXT
                                                                mtot_des := 0
                                                                IF alt_dados('*')
                                                                        EXIT
                                                                ENDIF
                                                        ELSE

                                                                *                     1           2      3      4         5          6          7
                                                                *         8         9      10       11       12    13    14     15     16
                                                                *          17           18            19          20         21      22       23            24        25      26   27        28
                                                                AADD(m_entrada,{mcons_merc[1,7],mcod_merc,mmerc,mpr_unit,mvlr_merc,mcust_merc,mcust_real,;
                                                                     mpr_medio,mpr_venda,mquantd,mgramatura,mipi,mpeso,mdesc1,mdesc2,mdesc3,;
                                                                     mcons_merc[1,30],mcons_merc[1,31],mcons_merc[1,61],mquantd_aux,mpreco_aux,mii,mcons_merc[1,14],mcons_merc[1,68],mcfop,micmsub,micm,mcons_merc[1,56]})
                                                                AADD(m_tipo4  ,{mcons_merc[1,7],mcod_merc,mmerc,mpr_unit4,mvlr_merc4,mcust_mer4,mcust_rea4,;
                                                                     mpr_medio4,mpr_venda4,mquantd,mcons_merc[1,74],mipi,mpeso,mdesc1,mdesc2,mdesc3,;
                                                                     mcons_merc[1,30],mcons_merc[1,31],mcons_merc[1,61],mquantd_aux,mpreco_aux,mii,mcons_merc[1,14],mcons_merc[1,68],mcfop,micmsub,micm,mcons_merc[1,56]})
                                                                AADD(m_demo,STRZERO(mcod_merc,5)+'-'+mmerc+' '+TRANSFORM(mquantd_aux,'99999.9999')+' '+TRANSFORM(mpreco_aux,'9,999,999.99'))
                                                                mtot_des := (mpr_unit * mquantd)
                                                                mtot_des := mtot_des - (mtot_des * (mdesc1 / 100))
                                                                mtot_des := mtot_des - (mtot_des * (mdesc2 / 100))
                                                                mtot_des := mtot_des - (mtot_des * (mdesc3 / 100))
                                                                mtot_vlr := mtot_vlr + (mtot_des + ((mpr_unit*mquantd) * (mipi/100)))
                                                                mtot_vlr := mtot_vlr + (mtot_des + ((mpr_unit*mquantd) * (mii/100)))
                                                                mtot_vlr := iat(mtot_vlr,2)
                                                                mtot_vol := iat(mtot_vol + mquantd_aux,set_aredonda)
                                                                mtot_des := 0
                                                                IF alt_dados('*')
                                                                        EXIT
                                                                ENDIF
                                                        ENDIF
                                                        setcor(3)
                                                        DEVPOS(25,19);DEVOUT(TRANSFORM(mtot_vol,'999,999.999'))
                                                        DEVPOS(25,52);DEVOUT(TRANSFORM(mtot_vlr,'9,999,999.99'))
                                                        DEVPOS(25,82);DEVOUT(TRANSFORM(LEN(m_entrada),'9,999'))
                                                        DEVPOS(27,19);DEVOUT(TRANSFORM(mvol_nota - mtot_vol,'999,999.999'))
                                                        DEVPOS(27,52);DEVOUT(TRANSFORM(mvlr_nota - mtot_vlr,'9,999,999.99'))
                                                        setcor(1)
                                                        LOOP
                                                ENDIF
                                        ENDDO

                                ENDIF
                                IF (mnivel_cal = '2' .AND. iat(mtot_vol,set_aredonda) = mvol_nota) .OR. ((msoma <= set_vlr_ent .AND. msoma >= (set_vlr_ent * -1));
                                   .AND. iat(mtot_vol,set_aredonda) = mvol_nota)
                                        mtot_vlr = mtot_vlr + menc_aux + mfrete_aux
                                        
                                        IF mtot_icmsub <> mvlr_icmsub
                                                opcao := op_simnao('N','Existe uma Diferenca no valor do ICM SUBSTITUTO, Valor Informado pela Nota:'+TRANSFORM(mvlr_icmsub,'999,999.99')+' Valor Digitado por Produto:'+TRANSFORM(mtot_icmsub,'999,999.99')+' Diferenca de :'+TRANSFORM(mtot_icmsub - mvlr_icmsub,'999,999.99'))
                                                IF opcao = 'N'
                                                        LOOP
                                                ENDIF
                                        ENDIF                                                        
                                        opcao := op_simnao('S','Todas Informacoes "OK"... Confirma Entrada:')
                                        IF opcao = 'N'
                                                LOOP
                                        ELSE
*                                               mvlr_nota
*                                               mvl_base := msoma
                                                repl_forn()
                                                IF ! EMPTY(mnum_ped) .AND. msoma <= mvlr_ent ;
                                                   .AND. msoma >= (mvlr_ent * -1) .AND.;
                                                    mtot_vol == mvol_nota
                                                        ********************
                                                        SELE('ped_e');ORDSETFOCUS(1)
                                                        GO TOP
                                                        ********************
                                                        SEEK STRZERO(mnum_ped,6)
                                                        IF ! FOUND()
                                                                atencao('Pedido nao Cadastrado !!!')
                                                                LOOP
                                                        ENDIF
                                                        //mfrete := (IF(ver_serie() = '141204',mfrete_aux*.93,mfrete_aux)/mvlr_nota)
                                                        mfrete := mfrete_aux / (mvlr_nota - mfrete_aux)
                                                        mencargo_f := (menc_aux/mvlr_nota)
                                                        mdisp_asse := (mdisp_aux/mvlr_nota)
                                                        WHILE STRZERO(mnum_ped,6) = ped_e->num_ped
                                                                mpeso := ped_e->peso
                                                                mpr_unit := ped_e->vlr_fat
                                                                point := RECNO()
                                                                ver_lucro(ped_e->cod_merc)
                                                                GO point
                                                                mquantd := ped_e->quantd
                                                                IF ped_e->tp_desc = 'R'
                                                                        mdesc1 := (ped_e->desc1/ped_e->vlr_fat)*100
                                                                        mdesc2 := (ped_e->desc2/ped_e->vlr_fat)*100
                                                                        mdesc3 := (ped_e->desc3/ped_e->vlr_fat)*100
                                                                        mipi := (ped_e->ipi/ped_e->vlr_fat)*100
                                                                ELSE
                                                                        mdesc1 := ped_e->desc1
                                                                        mdesc2 := ped_e->desc2
                                                                        mdesc3 := ped_e->desc3
                                                                        mipi := ped_e->ipi
                                                                ENDIF
                                                                mcod_merc := VAL(ped_e->cod_merc)
                                                                setcor(3)
                                                                DEVPOS(12,14);DEVOUT(STRZERO(mcod_merc,5))
                                                                DEVPOS(12,20);DEVOUT(ped_e->merc)
                                                                DEVPOS(12,66);DEVOUT(ped_e->unidade)
                                                                DEVPOS(14,13);DEVOUTPICT(mquantd,(unidade(mcons_merc[1,14])))
                                                                DEVPOS(15,13);DEVOUTPICT(mp_lucro,'999.99')
                                                                DEVPOS(16,13);DEVOUTPICT(ped_e->vlr_fat,'9,999,999.9999')
                                                                DEVPOS(19,13);DEVOUTPICT(mdesc1,'9,999.9999')
                                                                DEVPOS(20,13);DEVOUTPICT(mipi,'9,999.9999')
                                                                setcor(1)
                                                                calc_cus()
                                                                GO point
                                                                mensagem('Tecle <ENTER> p/Continuar ou <ESC> p/Abandonar Tudo')
                                                                INKEY(0)
                                                                IF LASTKEY() = 27
                                                                        RESTSCREEN(00,00,24,79,tela)
                                                                        EXIT
                                                                ENDIF
                                                                *                  1        2           3       4        5          6          7
                                                                *       8          9        10         11         12    13    14     15     16
                                                                *       17     18      19     20       21      22      23
                                                                AADD(m_entrada,{ped_e->gru_sub,VAL(ped_e->cod_merc),ped_e->merc,mpr_unit,mvlr_merc,mcust_merc,mcust_real,;
                                                                    mpr_medio,mpr_venda,mquantd,mcons_merc[1,74],mipi,mpeso,mdesc1,mdesc2,mdesc3,;
                                                                    ped_e->cod_fab,ped_e->fabrica,ped_e->isento,mquantd,mpr_venda,mii,mcons_merc[1,14],mcons_merc[1,68],mcfop,micmsub,micm,mcons_merc[1,56]})
                                                                AADD(m_tipo4  ,{ped_e->gru_sub,VAL(ped_e->cod_merc),ped_e->merc,mpr_unit4,mvlr_merc4,mcust_mer4,mcust_rea4,;
                                                                    mpr_medio4,mpr_venda4,mquantd,mcons_merc[1,74],mipi,mpeso,mdesc1,mdesc2,mdesc3,;
                                                                    ped_e->cod_fab,ped_e->fabrica,ped_e->isento,mquantd,mpr_venda,mii,mcons_merc[1,14],mcons_merc[1,68],mcfop,micmsub,micm,mcons_merc[1,56]})
                                                                SKIP
                                                        ENDDO
                                                        IF LASTKEY() = 27;EXIT;ENDIF
                                                ENDIF
                                                IF ! EMPTY(mnum_ped)
                                                        SR_BEGINTRANSACTION()
                                                        TRY
                                                                i := 0
                                                                FOR i=1 TO LEN(m_entrada)
                                                                        aret:={}
                                                                        sr_getconnection():exec("SELECT saldo_comp FROM sacmerc WHERE cod_merc = "+sr_cdbvalue(mqtd_ent[i,1]),,.t.,@aret)
                                                                        sr_getconnection():exec("UPDATE sacmerc SET saldo_comp  = "+sr_cdbvalue(aret[1,1] - mqtd_ent[i,2])+" WHERE cod_merc = "+sr_cdbvalue(mqtd_ent[i,1]),,.f.)
                                                                        IF SR_SetActiveConnection(nCnn1) > 0
                                                                                sr_getconnection():exec("UPDATE sacmerc SET saldo_comp  = "+sr_cdbvalue(aret[1,1] - mqtd_ent[i,2])+" WHERE cod_merc = "+sr_cdbvalue(mqtd_ent[i,1]),,.f.)
                                                                                sr_getconnection():exec("COMMIT",,.f.)
                                                                        ENDIF
                                                                        SR_SetActiveConnection(nCnn)
                                                                        sr_getconnection():exec("COMMIT",,.f.)
                                                                NEXT
                                                        sr_committransaction()
                                                        CATCH e
                                                        SR_ENDTRANSACTION()
                                                        END
                                                ENDIF
                                                IF mcod_op = '02' .OR. mcod_op ='03'
                                                        i := 0
                                                        SR_BEGINTRANSACTION()
                                                                FOR i=1 TO LEN(m_entrada)
                                                                        IF mcod_op = '03'
                                                                                ver_nat(m_entrada[i,25],'E')
                                                                                aret := {}
                                                                                //TRY
                                                                                        sr_getconnection():exec("SELECT saldo_fis,icm FROM sacmerc WHERE cod_merc = "+sr_cdbvalue(STRZERO(m_entrada[i,2],5)),,.t.,@aret)
                                                                                //CATCH e
                                                                                //        tracelog(valtoprg())
                                                                                //        sr_rollbacktransaction()
                                                                                //END
                                                                                //TRY
                                                                                        sr_getconnection():exec("UPDATE sacmerc SET dat_ult_e = "+sr_cdbvalue(mchegada)+;
                                                                                                        ",saldo_fis = "+sr_cdbvalue(aret[1,1] + IF(mcredito='S',m_entrada[i,10],0))+;
                                                                                                                ",icm = "+sr_cdbvalue(iat(aret[1,2] + IF(! EMPTY(m_entrada[i,27]),((m_entrada[i,5] * m_entrada[i,10])* (m_entrada[i,27]/100)),0),2))+;
                                                                                                        " WHERE cod_merc = "+sr_cdbvalue(STRZERO(m_entrada[i,2],5)),,.f.)
                                                                                        IF mcredito='S'
                                                                                                sr_getconnection():exec('INSERT INTO logprod_fis (data_sis,data,'+;
                                                                                                        'hora,cod_prod,quantd,saldo_ant,saldo_pos,cod_oper,prog,terminal,'+;
                                                                                                        'processo,ent_sai )'+;
                                                                                                        ' VALUES ('+;
                                                                                                        sr_cdbvalue(DATE())+','+; //1
                                                                                                        sr_cdbvalue(mdata_sis)+','+; //2
                                                                                                        sr_cdbvalue(TIME())+','+; //3
                                                                                                        sr_cdbvalue(STRZERO(m_entrada[i,2],5))+','+; //4
                                                                                                        sr_cdbvalue(m_entrada[i,10])+','+; //5
                                                                                                        sr_cdbvalue(aret[1,1])+','+; //6
                                                                                                        sr_cdbvalue(aret[1,1] + m_entrada[i,10])+','+; //7
                                                                                                        sr_cdbvalue(cod_operado)+','+; //8
                                                                                                        sr_cdbvalue('SAC22')+','+; //9
                                                                                                        sr_cdbvalue(LEFT(NETNAME(),15))+','+; //12
                                                                                                        sr_cdbvalue('ENTRADA: '+mtp_nota+mnota)+','+; //11
                                                                                                        sr_cdbvalue('E')+')',,.f.)
                                                                                        ENDIF
                                                                                //CATCH e
                                                                                //        tracelog(valtoprg())
                                                                                //        sr_rollbacktransaction()
                                                                                //END
                                                                                        //sr_getconnection():exec("COMMIT",,.f.)
                                                                                mtp_nota := 'NF'

                                                                        ELSE
                                                                                mtp_nota := 'PD'
                                                                                aret := {}
                                                                                                         //         1        2       3         4        5         6       7         8       9        10     11     12      13
                                                                                sr_getconnection():exec("SELECT saldo_mer,pr_unit,vlr_merc,cust_merc,pr_venda,cust_real,pr_medio,doc_ent,cod_barr,cod_merc,merc,unidade,sittrib FROM sacmerc WHERE cod_merc = "+sr_cdbvalue(STRZERO(m_entrada[i,2],5)),,.t.,@aret)
                                                                                mlinha := aret[1,9]+aret[1,10]+aret[1,11]+aret[1,12]+STRZERO((aret[1,1] + m_entrada[i,10])*1000,13)+STRZERO(iat(m_entrada[i,9])*100,14)+aret[1,13]
                                                                                //TRY
                                                                                        sr_getconnection():exec("UPDATE sacmerc SET data_atu = "+sr_cdbvalue(mdata_sis)+;
                                                                                                        ",a_pr_unit = "+sr_cdbvalue(aret[1,2])+;
                                                                                                        ",a_vlr_merc = "+sr_cdbvalue(aret[1,3])+;
                                                                                                        ",a_cust_mer = "+sr_cdbvalue(aret[1,4])+;
                                                                                                        ",a_pr_venda = "+sr_cdbvalue(aret[1,5])+;
                                                                                                        ",a_cust_rea = "+sr_cdbvalue(aret[1,6])+;
                                                                                                        ",a_pr_medio = "+sr_cdbvalue(aret[1,7])+;
                                                                                                        ",pr_unit   = "+sr_cdbvalue(iat(m_entrada[i,4],set_aredonda))+;
                                                                                                        ",vlr_merc  = "+sr_cdbvalue(iat(m_entrada[i,5],set_aredonda))+;
                                                                                                        ",cust_merc = "+sr_cdbvalue(iat(m_entrada[i,6],set_aredonda))+;
                                                                                                        ",pr_venda  = "+sr_cdbvalue(iat(m_entrada[i,9],set_aredonda))+;
                                                                                                        ",cust_real = "+sr_cdbvalue(iat(m_entrada[i,7],set_aredonda))+;
                                                                                                        ",pr_medio  = "+sr_cdbvalue(iat(m_entrada[i,8],set_aredonda))+;
                                                                                                        ",saldo_ant = "+sr_cdbvalue(aret[1,1])+;
                                                                                                        ",saldo_mer = "+sr_cdbvalue(aret[1,1] + m_entrada[i,10] )+;
                                                                                                        ",dat_ult_e = "+sr_cdbvalue(mchegada)+;
                                                                                                        ",ul_alt_pr = "+IF(aret[1,5] <> m_entrada[i,9],sr_cdbvalue(mdata_sis),nulo)+;
                                                                                                        ",opera_pr     = "+sr_cdbvalue(cod_operado)+;
                                                                                                        ",isento    = "+sr_cdbvalue(m_entrada[i,19])+;
                                                                                                        ",doc_ent_a = "+sr_cdbvalue(aret[1,8])+;
                                                                                                        ",doc_ent   = "+sr_cdbvalue('PD'+mnota)+;
                                                                                                        ",chv_cript = "+sr_cdbvalue(CRIPTO(mlinha,1))+;
                                                                                                        " WHERE cod_merc = "+sr_cdbvalue(STRZERO(m_entrada[i,2],5)),,.f.)
                                                                                //CATCH e
                                                                                //        tracelog(valtoprg())
                                                                                //        sr_rollbacktransaction()
                                                                                //END
                                                                                //TRY
                                                                                        sr_getconnection():exec('INSERT INTO logproduto (data_sis,data,'+;
                                                                                        'hora,cod_prod,quantd,saldo_ant,saldo_pos,cod_oper,prog,terminal,'+;
                                                                                        'processo,ent_sai,SR_DELETED )'+;
                                                                                        ' VALUES ('+;
                                                                                        sr_cdbvalue(DATE())+','+; //1
                                                                                        sr_cdbvalue(mdata_sis)+','+; //2
                                                                                        sr_cdbvalue(TIME())+','+; //3
                                                                                        sr_cdbvalue(STRZERO(m_entrada[i,2],5))+','+; //4
                                                                                        sr_cdbvalue(m_entrada[i,10])+','+; //5
                                                                                        sr_cdbvalue(aret[1,1])+','+; //6
                                                                                        sr_cdbvalue(aret[1,1] + m_entrada[i,10])+','+; //7
                                                                                        sr_cdbvalue(cod_operado)+','+; //8
                                                                                        sr_cdbvalue('SAC22')+','+; //9
                                                                                        sr_cdbvalue(LEFT(NETNAME(),15))+','+; //12
                                                                                        sr_cdbvalue(IF(mcod_op = '02','ENTRADA: PD','ENTRADA: NF')+mnota)+','+; //11
                                                                                        sr_cdbvalue('E')+','+; //11
                                                                                        sr_cdbvalue(' ')+')',,.f.)
                                                                                //CATCH e
                                                                                //        tracelog(valtoprg())
                                                                                //        sr_rollbacktransaction()
                                                                                //END
                                                                        ENDIF
                                                                NEXT
                                                                sr_committransaction()
                                                        SR_ENDTRANSACTION()
                                                        i := 0
                                                        FOR i=1 TO LEN(m_entrada)
                                                                IF mcod_op = '03'
                                                                        *************
                                                                        SELE('mov');ORDSETFOCUS(1)
                                                                        *************
                                                                        atu_movi('NF','03',i)
                                                                ELSE
                                                                        *************
                                                                        SELE('mov');ORDSETFOCUS(1)
                                                                        *************
                                                                        atu_movi('PD','02',i)
                                                                ENDIF
                                                        NEXT
                                                        i := 0
                                                        FOR i=1 TO LEN(m_entrada)
                                                                IF mnum_ped > 0
                                                                        ************
                                                                        SELE('ped_e');ORDSETFOCUS(2)
                                                                        GO TOP
                                                                        ************

                                                                        IF ! ped_e->(DBSEEK(STRZERO(m_entrada[i,2],5) + STRZERO(mnum_ped,6)))
                                                                                LOOP
                                                                        ENDIF
                                                                        IF ! BLOQREG()
                                                                                atencao('Nao foi Possivel Acessar o Arquivo')
                                                                                LOOP
                                                                        ENDIF
                                                                        ped_e-> recebi := '*'
                                                                        IF m_entrada[i,10] >= ped_e->quantd
                                                                                ped_e-> saldo := ped_e->saldo - m_entrada[i,10]
                                                                                DBCOMMIT()
                                                                                DBUNLOCK()
                                                                                LOOP
                                                                        ELSE
                                                                                WHILE .T.
                                                                                        op := mensagem1('Quantidade a Menor <S>aldo <D>evolvido:',' ','S,D')
                                                                                        IF LASTKEY() = 27;LOOP;ENDIF
                                                                                        IF op = 'S'
                                                                                                ped_e-> saldo := ped_e->saldo - m_entrada[i,10]
                                                                                                DBCOMMIT()
                                                                                                DBUNLOCK()
                                                                                                EXIT
                                                                                        ELSE
                                                                                                ped_e-> saldo := ped_e->saldo - ped_e->quantd
                                                                                                ped_e-> devolvido := ped_e->saldo - m_entrada[i,10]
                                                                                                DBCOMMIT()
                                                                                                DBUNLOCK()
                                                                                                EXIT
                                                                                        ENDIF
                                                                                ENDDO
                                                                        ENDIF
                                                                ENDIF
                                                        NEXT i
                                                        IF mcod_op = '03'
                                                                sr_getconnection():exec('INSERT INTO sactotnt (empresa,'+;
                                                                        'documento,serie,modelo,'+;
                                                                        'num_ped,emissao,ent_sai,'+;
                                                                        'cod_cli,cliente,uf_cli,'+;
                                                                        'cid_cli,insc_cli,cpf_cli,'+;
                                                                        'cgc_cli,vl_base,vl_nota,'+;
                                                                        'vl_icm,vlr_icmsub,base_icmsu,'+;
                                                                        'frete,encargo_f,disp_asse,ipi,'+;
                                                                        'cod_nat,norm_ele,'+;
                                                                        'SR_DELETED )'+;
                                                                        ' VALUES ('+;
                                                                        sr_cdbvalue(mcodempresa         )+','+; //1
                                                                        sr_cdbvalue('NF'+mnota          )+','+; //2
                                                                        sr_cdbvalue(mserie              )+','+; //3
                                                                        sr_cdbvalue(mmodelo             )+','+; //4
                                                                        sr_cdbvalue(STRZERO(mnum_ped,6) )+','+; //5
                                                                        sr_cdbvalue(mchegada            )+','+; //6
                                                                        sr_cdbvalue('E'                 )+','+; //7
                                                                        sr_cdbvalue(STRZERO(mcod_forn,4))+','+; //8
                                                                        sr_cdbvalue(LEFT(mfornece,30)   )+','+;//9
                                                                        sr_cdbvalue(forn->uf    )+','+;//10
                                                                        sr_cdbvalue(forn->cidade)+','+; //11
                                                                        sr_cdbvalue(forn->insc  )+','+;//12
                                                                        sr_cdbvalue(forn->cpf   )+','+;//13
                                                                        sr_cdbvalue(forn->cgc   )+','+;//14
                                                                        sr_cdbvalue(mvlr_base   )+','+;//15
                                                                        sr_cdbvalue(mvlr_nota   )+','+;//16
                                                                        sr_cdbvalue(mvalor_icm  )+','+;//17
                                                                        sr_cdbvalue(mvlr_icmsub )+','+;//18
                                                                        sr_cdbvalue(mbas_icmsub )+','+;//19
                                                                        sr_cdbvalue(mfrete_aux  )+','+;//20
                                                                        sr_cdbvalue(menc_aux    )+','+;//21
                                                                        sr_cdbvalue(mdisp_aux   )+','+;//22
                                                                        sr_cdbvalue(iat(mtot_ipi,2))+','+;//23
                                                                        sr_cdbvalue(mcod_nat    )+','+;//24
                                                                        sr_cdbvalue(mnorm_ele    )+','+;//25
                                                                        sr_cdbvalue(' ')+')',,.f.)
                                                        ENDIF
                                                ELSE
                                                        SR_BEGINTRANSACTION()
                                                        i := 0
                                                        FOR i=1 TO LEN(m_entrada)
                                                                aret := {}
                                                                                          //         1        2        3     4    5        6        7        8         9        10       11       12     13     14      15
                                                                sr_getconnection():exec("SELECT saldo_mer,saldo_fis,doc_ent,icm,pr_unit,vlr_merc,cust_merc,pr_venda,cust_real,pr_medio,cod_barr,cod_merc,merc,unidade,sittrib FROM sacmerc WHERE cod_merc = "+sr_cdbvalue(STRZERO(m_entrada[i,2],5)),,.t.,@aret)
                                                                mlinha := aret[1,11]+aret[1,12]+aret[1,13]+aret[1,14]+STRZERO((aret[1,1] + m_tipo4[i,10])*1000,13)+STRZERO(iat(m_tipo4[i,9])*100,14)+aret[1,15]

                                                                IF mcod_op = '04'
                                                                                        //",ul_alt_pr = "+sr_cdbvalue(mchegada                          )+;
                                                                        ver_nat(m_tipo4[i,25],'E')
                                                                        sr_getconnection():exec("UPDATE sacmerc SET data_atu = "+sr_cdbvalue(mdata_sis)+;
                                                                                        ",dat_ult_e = "+sr_cdbvalue(mchegada                          )+;
                                                                                        ",ul_alt_pr = "+IF(aret[1,8] <> m_tipo4[i,9],sr_cdbvalue(mdata_sis),nulo)+; //sr_cdbvalue(IF(aret[1,8] <> m_tipo4[i,9],mdata_sis,nulo))+;
                                                                                        ",opera_pr     = "+sr_cdbvalue(cod_operado)+;
                                                                                        ",isento    = "+sr_cdbvalue(m_entrada[i,19]                   )+;
                                                                                        ",doc_ent_a = "+sr_cdbvalue(aret[1,3]                     )+;
                                                                                        ",doc_ent   = "+sr_cdbvalue('PD'+mnota                        )+;
                                                                                        ",a_pr_unit  = "+sr_cdbvalue(aret[1,5] )+;
                                                                                        ",a_vlr_merc = "+sr_cdbvalue(aret[1,6] )+;
                                                                                        ",a_cust_mer = "+sr_cdbvalue(aret[1,7] )+;
                                                                                        ",a_pr_venda = "+sr_cdbvalue(aret[1,8] )+;
                                                                                        ",a_cust_rea = "+sr_cdbvalue(aret[1,9] )+;
                                                                                        ",a_pr_medio = "+sr_cdbvalue(aret[1,10])+;
                                                                                        ",pr_unit   = "+sr_cdbvalue(iat(m_tipo4[i,4],set_aredonda))+;
                                                                                        ",vlr_merc  = "+sr_cdbvalue(iat(m_tipo4[i,5],set_aredonda))+;
                                                                                        ",cust_merc = "+sr_cdbvalue(iat(m_tipo4[i,6],set_aredonda))+;
                                                                                        ",pr_venda  = "+sr_cdbvalue(iat(m_tipo4[i,9],set_aredonda))+;
                                                                                        ",cust_real = "+sr_cdbvalue(iat(m_tipo4[i,7],set_aredonda))+;
                                                                                        ",pr_medio  = "+sr_cdbvalue(iat(m_tipo4[i,8],set_aredonda))+;
                                                                                        ",saldo_mer = "+sr_cdbvalue(aret[1,1] + m_tipo4[i,10])+;
                                                                                        ",saldo_fis = "+sr_cdbvalue(aret[1,2] + IF(mcredito='S',m_tipo4[i,10],0))+;
                                                                                        ",icm = "+sr_cdbvalue(iat(aret[1,4] + IF(! EMPTY(m_entrada[i,27]),((m_tipo4[i,5] * m_tipo4[i,10])* (m_tipo4[i,27]/100)),0),2))+;
                                                                                        ",chv_cript = "+sr_cdbvalue(CRIPTO(mlinha,1))+;
                                                                                        " WHERE cod_merc = "+sr_cdbvalue(STRZERO(m_entrada[i,2],5)),,.f.)
                                                                        sr_getconnection():exec('INSERT INTO logproduto (data_sis,data,'+;
                                                                                'hora,cod_prod,quantd,saldo_ant,saldo_pos,cod_oper,prog,terminal,'+;
                                                                                'processo,ent_sai,SR_DELETED )'+;
                                                                                ' VALUES ('+;
                                                                                sr_cdbvalue(DATE())+','+; //1
                                                                                sr_cdbvalue(mdata_sis)+','+; //2
                                                                                sr_cdbvalue(TIME())+','+; //3
                                                                                sr_cdbvalue(STRZERO(m_entrada[i,2],5))+','+; //4
                                                                                sr_cdbvalue(m_tipo4[i,10])+','+; //5
                                                                                sr_cdbvalue(aret[1,1])+','+; //6
                                                                                sr_cdbvalue(aret[1,1] + m_tipo4[i,10])+','+; //7
                                                                                sr_cdbvalue(cod_operado)+','+; //8
                                                                                sr_cdbvalue('SAC22')+','+; //9
                                                                                sr_cdbvalue(LEFT(NETNAME(),15))+','+; //12
                                                                                sr_cdbvalue(IF(mcod_op = '02','ENTRADA: PD','ENTRADA: NF')+mnota)+','+; //11
                                                                                sr_cdbvalue('E')+','+; //11
                                                                                sr_cdbvalue(' ')+')',,.f.)
                                                                                IF mcredito='S'
                                                                                        sr_getconnection():exec('INSERT INTO logprod_fis (data_sis,data,'+;
                                                                                                'hora,cod_prod,quantd,saldo_ant,saldo_pos,cod_oper,prog,terminal,'+;
                                                                                                'processo,ent_sai )'+;
                                                                                                ' VALUES ('+;
                                                                                                sr_cdbvalue(DATE())+','+; //1
                                                                                                sr_cdbvalue(mdata_sis)+','+; //2
                                                                                                sr_cdbvalue(TIME())+','+; //3
                                                                                                sr_cdbvalue(STRZERO(m_entrada[i,2],5))+','+; //4
                                                                                                sr_cdbvalue(m_tipo4[i,10])+','+; //5
                                                                                                sr_cdbvalue(aret[1,2])+','+; //6
                                                                                                sr_cdbvalue(aret[1,2] + m_tipo4[i,10])+','+; //7
                                                                                                sr_cdbvalue(cod_operado)+','+; //8
                                                                                                sr_cdbvalue('SAC22')+','+; //9
                                                                                                sr_cdbvalue(LEFT(NETNAME(),15))+','+; //12
                                                                                                sr_cdbvalue('ENTRADA: '+mtp_nota+mnota)+','+; //11
                                                                                                sr_cdbvalue('E')+')',,.f.)
                                                                                ENDIF
                                                                ELSE
                                                                        ver_nat(m_entrada[i,25],'E')
                                                                        sr_getconnection():exec("UPDATE sacmerc SET data_atu = "+sr_cdbvalue(mdata_sis)+;
                                                                                        ",dat_ult_e  = "+sr_cdbvalue(mchegada                          )+;
                                                                                        ",ul_alt_pr = "+IF(aret[1,8] <> m_entrada[i,9],sr_cdbvalue(mdata_sis),nulo)+;//sr_cdbvalue(IF(aret[1,8] <> m_entrada[i,9],mdata_sis,nulo))+; //",ul_alt_pr  = "+sr_cdbvalue(mchegada                          )+;
                                                                                        ",opera_pr     = "+sr_cdbvalue(cod_operado)+;
                                                                                        ",isento     = "+sr_cdbvalue(m_entrada[i,19]                   )+;
                                                                                        ",doc_ent_a  = "+sr_cdbvalue(aret[1,3]                     )+;
                                                                                        ",doc_ent    = "+sr_cdbvalue('PD'+mnota                        )+;
                                                                                        ",a_pr_unit  = "+sr_cdbvalue(aret[1,5] )+;
                                                                                        ",a_vlr_merc = "+sr_cdbvalue(aret[1,6] )+;
                                                                                        ",a_cust_mer = "+sr_cdbvalue(aret[1,7] )+;
                                                                                        ",a_pr_venda = "+sr_cdbvalue(aret[1,8] )+;
                                                                                        ",a_cust_rea = "+sr_cdbvalue(aret[1,9] )+;
                                                                                        ",a_pr_medio = "+sr_cdbvalue(aret[1,10])+;
                                                                                        ",pr_unit   = "+sr_cdbvalue(iat(m_entrada[i,4],set_aredonda))+;
                                                                                        ",vlr_merc  = "+sr_cdbvalue(iat(m_entrada[i,5],set_aredonda))+;
                                                                                        ",cust_merc = "+sr_cdbvalue(iat(m_entrada[i,6],set_aredonda))+;
                                                                                        ",pr_venda  = "+sr_cdbvalue(iat(m_entrada[i,9],set_aredonda))+;
                                                                                        ",cust_real = "+sr_cdbvalue(iat(m_entrada[i,7],set_aredonda))+;
                                                                                        ",pr_medio  = "+sr_cdbvalue(iat(m_entrada[i,8],set_aredonda))+;
                                                                                        ",saldo_mer = "+sr_cdbvalue(aret[1,1] + m_entrada[i,10])+;
                                                                                        ",saldo_fis = "+sr_cdbvalue(aret[1,2] + IF(mcredito='S',m_entrada[i,10],0))+;
                                                                                        ",icm = "+sr_cdbvalue(iat(aret[1,4] + IF(! EMPTY(m_entrada[i,27]),((m_entrada[i,5] * m_entrada[i,10])* (m_entrada[i,27]/100)),0),2))+;
                                                                                        ",chv_cript = "+sr_cdbvalue(CRIPTO(mlinha,1))+;
                                                                                        " WHERE cod_merc = "+sr_cdbvalue(STRZERO(m_entrada[i,2],5)),,.f.)
                                                                        sr_getconnection():exec('INSERT INTO logproduto (data_sis,data,'+;
                                                                                'hora,cod_prod,quantd,saldo_ant,saldo_pos,cod_oper,prog,terminal,'+;
                                                                                'processo,ent_sai,SR_DELETED )'+;
                                                                                ' VALUES ('+;
                                                                                sr_cdbvalue(DATE())+','+; //1
                                                                                sr_cdbvalue(mdata_sis)+','+; //2
                                                                                sr_cdbvalue(TIME())+','+; //3
                                                                                sr_cdbvalue(STRZERO(m_entrada[i,2],5))+','+; //4
                                                                                sr_cdbvalue(m_entrada[i,10])+','+; //5
                                                                                sr_cdbvalue(aret[1,1])+','+; //6
                                                                                sr_cdbvalue(aret[1,1] + m_entrada[i,10])+','+; //7
                                                                                sr_cdbvalue(cod_operado)+','+; //8
                                                                                sr_cdbvalue('SAC22')+','+; //9
                                                                                sr_cdbvalue(LEFT(NETNAME(),15))+','+; //12
                                                                                sr_cdbvalue(IF(mcod_op = '02','ENTRADA: PD','ENTRADA: NF')+mnota)+','+; //11
                                                                                sr_cdbvalue('E')+','+; //11
                                                                                sr_cdbvalue(' ')+')',,.f.)
                                                                                IF mcredito='S'
                                                                                        sr_getconnection():exec('INSERT INTO logprod_fis (data_sis,data,'+;
                                                                                                'hora,cod_prod,quantd,saldo_ant,saldo_pos,cod_oper,prog,terminal,'+;
                                                                                                'processo,ent_sai )'+;
                                                                                                ' VALUES ('+;
                                                                                                sr_cdbvalue(DATE())+','+; //1
                                                                                                sr_cdbvalue(mdata_sis)+','+; //2
                                                                                                sr_cdbvalue(TIME())+','+; //3
                                                                                                sr_cdbvalue(STRZERO(m_entrada[i,2],5))+','+; //4
                                                                                                sr_cdbvalue(m_entrada[i,10])+','+; //5
                                                                                                sr_cdbvalue(aret[1,2])+','+; //6
                                                                                                sr_cdbvalue(aret[1,2] + m_entrada[i,10])+','+; //7
                                                                                                sr_cdbvalue(cod_operado)+','+; //8
                                                                                                sr_cdbvalue('SAC22')+','+; //9
                                                                                                sr_cdbvalue(LEFT(NETNAME(),15))+','+; //12
                                                                                                sr_cdbvalue('ENTRADA: '+mtp_nota+mnota)+','+; //11
                                                                                                sr_cdbvalue('E')+')',,.f.)
                                                                                ENDIF
                                                                ENDIF
                                                        NEXT
                                                        sr_committransaction()
                                                        SR_ENDTRANSACTION()

                                                        i := 0
                                                        FOR i=1 TO LEN(m_entrada)
                                                                *************
                                                                SELE('mov');ORDSETFOCUS(1)
                                                                *************
                                                                mtp_nota := 'NF'
                                                                atu_movi('NF','01',i)

                                                                IF mcod_op = '04'
                                                                        sr_getconnection():exec('INSERT INTO sacmov (empresa,'+;
                                                                                'documento,serie,modelo,'+;
                                                                                'num_ped,ped_forn,'+;
                                                                                'gru_sub,codigo,produto,cod_fab,'+;
                                                                                'fabrica,unidade,data_s_e,ent_sai,'+;
                                                                                'saldo_ant,quantd,quantd_aux,'+;
                                                                                'pr_venda1,pr_venda,pr_unit,cod_forn,'+;
                                                                                'fornece,uf_cli,icm_aliq,icm_sub,'+;
                                                                                'fob,cif,dia1,dia2,dia3,emissao,saida,'+;
                                                                                'chegada,frete,encargo_f,disp_asse,'+;
                                                                                'ipi_aliq,ipi,peso,desc1,desc2,desc3,'+;
                                                                                'tipo,isento,sittrib,cod_nat,cod_oper,'+;
                                                                                'icm,norm_ele,SR_DELETED )'+;
                                                                                ' VALUES ('+;
                                                                                sr_cdbvalue(mcodempresa         )+','+; //1
                                                                                sr_cdbvalue('PD'+mnota          )+','+; //2
                                                                                sr_cdbvalue(mserie              )+','+; //3
                                                                                sr_cdbvalue(mmodelo             )+','+; //4
                                                                                sr_cdbvalue(STRZERO(mnum_ped,6) )+','+; //5
                                                                                sr_cdbvalue(mped_forn              )+','+; //6
                                                                                sr_cdbvalue(m_tipo4[i,1]           )+','+; //8
                                                                                sr_cdbvalue(STRZERO(m_tipo4[i,2],5))+','+;//9
                                                                                sr_cdbvalue(m_tipo4[i,3]           )+','+;//10
                                                                                sr_cdbvalue(m_tipo4[i,17]          )+','+; //11
                                                                                sr_cdbvalue(LEFT(m_tipo4[i,18],30))+','+;//12
                                                                                sr_cdbvalue(m_tipo4[i,23]          )+','+;//13
                                                                                sr_cdbvalue(mchegada               )+','+;//14
                                                                                sr_cdbvalue('E'                    )+','+;//15
                                                                                sr_cdbvalue(m_tipo4[i,28]          )+','+;//16
                                                                                sr_cdbvalue(m_tipo4[i,10]          )+','+;//17
                                                                                sr_cdbvalue(m_tipo4[i,10]          )+','+;//18
                                                                                sr_cdbvalue(iat(mcons_merc[1,46],2)         )+','+;//19
                                                                                sr_cdbvalue(iat(m_tipo4[i,9],2)           )+','+;//20
                                                                                sr_cdbvalue(iat(m_tipo4[i,5],2)           )+','+;//21
                                                                                sr_cdbvalue(STRZERO(mcod_forn,4)   )+','+;//22
                                                                                sr_cdbvalue(LEFT(mfornece,30)      )+','+;//23
                                                                                sr_cdbvalue(forn->uf               )+','+;//24
                                                                                sr_cdbvalue(m_tipo4[i,27]                                       )+','+;//13
                                                                                sr_cdbvalue(m_tipo4[i,26]                                       )+','+;//14
                                                                                sr_cdbvalue(mfob                                                )+','+;//15
                                                                                sr_cdbvalue(mcif                                                )+','+;//16
                                                                                sr_cdbvalue(STRZERO(val(mdia1),2)                               )+','+;//17
                                                                                sr_cdbvalue(STRZERO(val(mdia2),2)                               )+','+;//18
                                                                                sr_cdbvalue(STRZERO(val(mdia3),2)                               )+','+;//19
                                                                                sr_cdbvalue(memissao                                            )+','+;//20
                                                                                sr_cdbvalue(msaida                                              )+','+;//21
                                                                                sr_cdbvalue(mchegada                                            )+','+;//22
                                                                                sr_cdbvalue(iat((m_tipo4[i,5] * m_tipo4[i,10]) * mfrete,2)    )+','+;//23
                                                                                sr_cdbvalue(iat((m_tipo4[i,5] * m_tipo4[i,10]) * mencargo_f,2))+','+;//24
                                                                                sr_cdbvalue(iat((m_tipo4[i,5] * m_tipo4[i,10]) * mdisp_asse,2))+','+;//13
                                                                                sr_cdbvalue(m_tipo4[i,12]                                       )+','+;//14
                                                                                sr_cdbvalue(iat((m_tipo4[i,5] * m_tipo4[i,10]) * (m_tipo4[i,12]/100),2))+','+;//15
                                                                                sr_cdbvalue(m_tipo4[i,13]                                       )+','+;//16
                                                                                sr_cdbvalue(iat((m_tipo4[i,4] * m_tipo4[i,10]) * (m_tipo4[i,14]/100),2))+','+;//17
                                                                                sr_cdbvalue(iat((m_tipo4[i,4] * m_tipo4[i,10])* (m_tipo4[i,15]/100),2) )+','+;//18
                                                                                sr_cdbvalue(iat((m_tipo4[i,4] * m_tipo4[i,10])*(m_tipo4[i,16]/100),2)  )+','+;//19
                                                                                sr_cdbvalue('02'                                                )+','+;//20
                                                                                sr_cdbvalue(m_tipo4[i,19]                                       )+','+;//21
                                                                                sr_cdbvalue(m_tipo4[i,24]                                       )+','+;//22
                                                                                sr_cdbvalue(m_tipo4[i,25]                                       )+','+;//23
                                                                                sr_cdbvalue(cod_operado                                         )+','+;//24
                                                                                sr_cdbvalue(iat(IF(! EMPTY(m_tipo4[i,27]),((m_tipo4[i,5] * m_tipo4[i,10]) * (m_tipo4[i,27]/100)),0),4))+','+;//25
                                                                                sr_cdbvalue(mnorm_ele)+','+;//26
                                                                                sr_cdbvalue(' ')+')',,.f.)
                                                                ENDIF
                                                        NEXT
                                                        i := 0
                                                        FOR i=1 TO LEN(m_entrada)
                                                                IF mnum_ped > 0
                                                                        ************
                                                                        SELE('ped_e');ORDSETFOCUS(2)
                                                                        GO TOP
                                                                        ************
                                                                        SEEK STRZERO(m_entrada[i,2],5) + STRZERO(mnum_ped,6)
                                                                        IF ! FOUND()
                                                                                LOOP
                                                                        ENDIF
                                                                        IF BLOQREG()
                                                                                ped_e-> recebi := '*'
                                                                                IF m_entrada[i,10] >= ped_e->quantd
                                                                                        ped_e-> saldo := ped_e->saldo - m_entrada[i,10]
                                                                                        DBCOMMIT()
                                                                                        DBUNLOCK()
                                                                                        LOOP
                                                                                ELSE
                                                                                        WHILE .T.
                                                                                                botao(10,10,12,30,'Quantidade a Menor <S>aldo <D>evolvido:',,,,0)
                                                                                                op := SPACE(1)
                                                                                                @ 11,COL()+1 GET op PICT '@!' VALID op $ 'S,D'
                                                                                                READ
                                                                                                IF LASTKEY() = 27;LOOP;ENDIF
                                                                                                IF op = 'S'
                                                                                                        IF BLOQREG()
                                                                                                                ped_e-> saldo := ped_e->saldo - m_entrada[i,10]
                                                                                                                DBCOMMIT()
                                                                                                                DBUNLOCK()
                                                                                                                EXIT
                                                                                                        ENDIF
                                                                                                ELSE
                                                                                                        IF BLOQREG()
                                                                                                                ped_e-> saldo := ped_e->saldo - ped_e->quantd
                                                                                                                ped_e-> devolvido := ped_e->saldo - m_entrada[i,10]
                                                                                                                DBCOMMIT()
                                                                                                                DBUNLOCK()
                                                                                                                EXIT
                                                                                                        ENDIF
                                                                                                ENDIF
                                                                                        ENDDO
                                                                                ENDIF
                                                                        ENDIF

                                                                ENDIF
                                                        NEXT i
                                                        sr_getconnection():exec('INSERT INTO sactotnt (empresa,'+;
                                                                'documento,serie,modelo,'+;
                                                                'num_ped,emissao,ent_sai,'+;
                                                                'cod_cli,cliente,uf_cli,'+;
                                                                'cid_cli,insc_cli,cpf_cli,'+;
                                                                'cgc_cli,vl_base,vl_nota,'+;
                                                                'vl_icm,vlr_icmsub,base_icmsu,'+;
                                                                'frete,encargo_f,disp_asse,ipi,'+;
                                                                'cod_nat,norm_ele,'+;
                                                                'SR_DELETED )'+;
                                                                ' VALUES ('+;
                                                                sr_cdbvalue(mcodempresa         )+','+; //1
                                                                sr_cdbvalue('NF'+mnota          )+','+; //2
                                                                sr_cdbvalue(mserie              )+','+; //3
                                                                sr_cdbvalue(mmodelo             )+','+; //4
                                                                sr_cdbvalue(STRZERO(mnum_ped,6) )+','+; //5
                                                                sr_cdbvalue(mchegada            )+','+; //6
                                                                sr_cdbvalue('E'                 )+','+; //7
                                                                sr_cdbvalue(STRZERO(mcod_forn,4))+','+; //8
                                                                sr_cdbvalue(LEFT(mfornece,30)   )+','+;//9
                                                                sr_cdbvalue(forn->uf    )+','+;//10
                                                                sr_cdbvalue(forn->cidade)+','+; //11
                                                                sr_cdbvalue(forn->insc  )+','+;//12
                                                                sr_cdbvalue(forn->cpf   )+','+;//13
                                                                sr_cdbvalue(forn->cgc   )+','+;//14
                                                                sr_cdbvalue(mvlr_base   )+','+;//15
                                                                sr_cdbvalue(mvlr_nota   )+','+;//16
                                                                sr_cdbvalue(mvalor_icm)+','+;//17
                                                                sr_cdbvalue(mvlr_icmsub )+','+;//18
                                                                sr_cdbvalue(mbas_icmsub )+','+;//19
                                                                sr_cdbvalue(mfrete_aux  )+','+;//20
                                                                sr_cdbvalue(menc_aux    )+','+;//21
                                                                sr_cdbvalue(mdisp_aux   )+','+;//22
                                                                sr_cdbvalue(iat(mtot_ipi,2))+','+;//23
                                                                sr_cdbvalue(mcod_nat    )+','+;//24
                                                                sr_cdbvalue(mnorm_ele    )+','+;//25
                                                                sr_cdbvalue(' ')+')',,.f.)
                                                        IF mcod_op = '04'
                                                                sr_getconnection():exec('INSERT INTO sactotnt (empresa,'+;
                                                                        'documento,serie,modelo,'+;
                                                                        'num_ped,emissao,ent_sai,'+;
                                                                        'cod_cli,cliente,uf_cli,'+;
                                                                        'cid_cli,insc_cli,cpf_cli,'+;
                                                                        'cgc_cli,vl_base,vl_nota,'+;
                                                                        'vl_icm,vlr_icmsub,base_icmsu,'+;
                                                                        'frete,encargo_f,disp_asse,ipi,'+;
                                                                        'cod_nat,norm_ele,'+;
                                                                        'SR_DELETED )'+;
                                                                        ' VALUES ('+;
                                                                        sr_cdbvalue(mcodempresa         )+','+; //1
                                                                        sr_cdbvalue('PD'+mnota          )+','+; //2
                                                                        sr_cdbvalue(mserie              )+','+; //3
                                                                        sr_cdbvalue(mmodelo             )+','+; //4
                                                                        sr_cdbvalue(STRZERO(mnum_ped,6) )+','+; //5
                                                                        sr_cdbvalue(mchegada            )+','+; //6
                                                                        sr_cdbvalue('E'                 )+','+; //7
                                                                        sr_cdbvalue(STRZERO(mcod_forn,4))+','+; //8
                                                                        sr_cdbvalue(LEFT(mfornece,30)   )+','+;//9
                                                                        sr_cdbvalue(forn->uf    )+','+;//10
                                                                        sr_cdbvalue(forn->cidade)+','+; //11
                                                                        sr_cdbvalue(forn->insc  )+','+;//12
                                                                        sr_cdbvalue(forn->cpf   )+','+;//13
                                                                        sr_cdbvalue(forn->cgc   )+','+;//14
                                                                        sr_cdbvalue(iat(mvlr_base / IF(EMPTY(mper_vlr),1,mper_vlr/100),2))+','+;//24
                                                                        sr_cdbvalue(iat(mvlr_nota / IF(EMPTY(mper_vlr),1,mper_vlr/100),2))+','+;//16
                                                                        sr_cdbvalue(iat(mvalor_icm / IF(EMPTY(mper_vlr),1,mper_vlr/100),2))+','+;//17
                                                                        sr_cdbvalue(iat(mvlr_icmsub / IF(EMPTY(mper_vlr),1,mper_vlr/100),2))+','+;//18
                                                                        sr_cdbvalue(iat(mbas_icmsub / IF(EMPTY(mper_vlr),1,mper_vlr/100),2))+','+;//19
                                                                        sr_cdbvalue(iat(mfrete_aux / IF(EMPTY(mper_vlr),1,mper_vlr/100),2))+','+;//20
                                                                        sr_cdbvalue(iat(menc_aux / IF(EMPTY(mper_vlr),1,mper_vlr/100),2))+','+;//21
                                                                        sr_cdbvalue(iat(mdisp_aux / IF(EMPTY(mper_vlr),1,mper_vlr/100),2))+','+;//22
                                                                        sr_cdbvalue(iat(mtot_ipi / IF(EMPTY(mper_vlr),1,mper_vlr/100),2))+','+;//23
                                                                        sr_cdbvalue(mcod_nat                                       )+','+;//24
                                                                        sr_cdbvalue(mnorm_ele                                       )+','+;//25
                                                                        sr_cdbvalue(' ')+')',,.f.)
                                                        ENDIF
                                                        cons_icm:={}
                                                        sr_getconnection():exec( "SELECT * FROM sacicm",,.t.,@cons_icm)
                                                        IF LEN(cons_icm) > 0
                                                                SR_BEGINTRANSACTION()
                                                                TRY
                                                                sr_getconnection():exec("UPDATE sacicm SET data = "+sr_cdbvalue(mchegada)+;
                                                                                ",documento  = "+sr_cdbvalue('NF'+mnota                          )+;
                                                                                ",deb_cred  = "+sr_cdbvalue(cons_icm[1,3] +iat(mtot_icm,2)     )+;
                                                                                " WHERE sr_recno = 1",,.f.)
                                                                sr_committransaction()
                                                                CATCH e
                                                                SR_ENDTRANSACTION()
                                                                END
                                                        ELSE
                                                                sr_getconnection():exec('INSERT INTO sacicm (data,'+;
                                                                        'documento,deb_cred,'+;
                                                                        'SR_DELETED )'+;
                                                                        ' VALUES ('+;
                                                                        sr_cdbvalue(mchegada         )+','+; //1
                                                                        sr_cdbvalue('NF'+mnota       )+','+; //2
                                                                        sr_cdbvalue(iat(mtot_icm,2))+','+; //3
                                                                        sr_cdbvalue(' ')+')',,.f.)
                                                        ENDIF
                                                ENDIF
                                                sr_getconnection():exec("COMMIT",,.f.)
                                                IF ! EMPTY(mdia1) .OR. mfob = 'X'
                                                        opcao := op_simnao('S','Deseja Gerar DUPLICATA A PAGAR:')
                                                        IF opcao = 'S';dup_pag();ENDIF
                                                ENDIF
                                                IF ! EMPTY(mavista)
                                                        opcao := op_simnao('S','Deseja Gerar DUPLICATA A PAGAR avista:')
                                                        IF opcao = 'S';dup_pag();ENDIF
                                                ENDIF
                                                opcao := op_simnao('S','Deseja emitir o resumo da nota fiscal de entrada: ')
                                                IF opcao = 'S'
                                                        imp_resu(mtp_nota,mnota)
                                                        IF mcod_op = '04'
                                                                imp_resu('PD',mnota)
                                                        ENDIF
                                                ENDIF
                                                //IF ver_serie() = '141204'
                                                //        opcao := op_simnao('S','Deseja emitir o resumo da NF de entrada p/Verificacao:')
                                                //        IF opcao = 'S';resu_veri();ENDIF
                                                //ENDIF
                                                opcao := op_simnao('N','Deseja emitir ETIQUETA DOS PRODUTOS [S/n]:')
                                                IF opcao = 'S';sac5etq1('E');ENDIF
                                        ENDIF
                                ENDIF
                        ENDIF
                ELSE    // NOTA DE IMPORTACAO
                        mv := 'X'
                        mcfop := mcod_nat
                        opcao := op_simnao('S','Confirma os dados da Nota Fiscal:')
                        IF opcao = 'N'
                                LOOP
                        ELSE
                                //mfrete := (IF(ver_serie() = '141204',mfrete_aux*.93,mfrete_aux)/mvlr_nota)
                                mfrete := mfrete_aux / (mvlr_nota - mfrete_aux)
                                mencargo_f := (menc_aux/mvlr_nota)
                                mdisp_asse := (mdisp_aux/mvlr_nota)
*                               IF mtot_vol <> mvol_nota
                                        mtot_vlr := mtot_vol := 0
                                        ASIZE(m_entrada,0)
                                        ASIZE(m_tipo4,0)
                                        ASIZE(m_demo,0)
                                        WHILE .T.
                                                botao(14,49,21,76,,' Valores Atuais  ')
                                                DEVPOS(15,50);DEVOUT('Vlr.Mercad.:')
                                                DEVPOS(16,50);DEVOUT('Cus.Mercad.:')
                                                DEVPOS(17,50);DEVOUT('Custo Real.:')
                                                DEVPOS(18,50);DEVOUT('Custo Medio:')
                                                DEVPOS(19,50);DEVOUT('Preco Venda:')
                                                DEVPOS(20,50);DEVOUT('Lucro R$...:')
                                                DEVPOS(21,50);DEVOUT('Saldo Atual:             ')

                                                IF mtot_vol = mvol_nota
                                                        EXIT
                                                ENDIF
                                                *************
                                                SELE('merc');ORDSETFOCUS(1)
                                                GO TOP
                                                *************
                                                munidade := SPACE(3)
                                                mmerc := SPACE(40)
                                                mcod_bc := SPACE(14)
                                                mcod_merc := mquantd := mp_lucro := ;
                                                mdesc_aux := mdesc1 := ;
                                                mdesc2 := mdesc3 := mipi := mipi_aux := ;
                                                mii := mii_aux := mpeso := mlucro := ;
                                                mvlr_merc := mcus_merc := mcus_real :=;
                                                mpr_venda := mpr_medio := mpr_unit := ;
                                                mvlr_merc4 := mcus_merc4 := mcus_real4 :=;
                                                mpr_venda4 := mpr_medio4 := mpr_unit4 := mvlr_icm_sub := 0
                                                setcor(3)
                                                DEVPOS(12,14);DEVOUTPICT(STRZERO(mcod_merc,5),'9999')
                                                DEVPOS(12,20);DEVOUT(mmerc)
                                                DEVPOS(12,66);DEVOUT(munidade)
                                                DEVPOS(15,13);DEVOUTPICT(mp_lucro,'999.99')
                                                IF mp == 'X'
                                                        tp_ipi = 'PERCENTUAL'
                                                ELSE
                                                        tp_ipi = 'VALOR (R$)'
                                                ENDIF
                                                setcor(1)
                                                mensagem('Digite Codigo ou <ENTER>p/Desc. - <ALT+P>Cad.PROD. - <F10>Consulta')
                                                f4 := ' '
                                                @ 12,14 GET mcod_bc PICT '@!'   //WHEN men_get(13,14,'Digite o Codigo ou <ENTER>p/Digitar Descricao - <ALT+P>cadastra PRODUTOS') VALID lim_get()
                                                READ
                                                IF LASTKEY() = 27
                                                        opcao := op_simnao('N','Deseja abandonar a entrada da NOTA:')
                                                        IF opcao = 'N'
                                                                LOOP
                                                        ENDIF
                                                        RESTSCREEN(00,00,24,79,tela)
                                                        DBCLOSEALL()
                                                        wvw_lclosewindow()
                                                        RETURN NIL
                                                ENDIF
                                                IF EMPTY(mcod_bc)
                                                        @ 12,21 GET mmerc PICT '@!'             //VALID lim_get() WHEN men_get(12,21,'<Digite descricao mercadoria>  <ENTER>p/retornar ')
                                                        READ
                                                        IF LASTKEY() = 27;LOOP;ENDIF
                                                ENDIF
                                                IF EMPTY(mcod_bc) .AND. EMPTY(mmerc)
                                                        LOOP
                                                ENDIF
                                                IF ! EMPTY(mcod_bc)
                                                        IF LEN(RTRIM(mcod_bc)) > 5 .OR. VAL(mcod_bc) = 0
                                                                mcons_merc:={}
                                                                sr_getconnection():exec("SELECT * FROM sacmerc WHERE cod_barr = "+sr_cdbvalue(mcod_bc),,.t.,@mcons_merc)
                                                                IF LEN(mcons_merc) = 0
                                                                        mcons_merc:={}
                                                                        sr_getconnection():exec("SELECT * FROM sacmerc WHERE ref = "+sr_cdbvalue(mcod_bc),,.t.,@mcons_merc)
                                                                        IF LEN(mcons_merc) = 0
                                                                                atencao('Codigo de BARRA e REFERENCIA AUXILIAR nao cadastrado')
                                                                                LOOP
                                                                        ENDIF
                                                                ENDIF
                                                                mcod_merc := VAL(mcod_bc)
                                                        ELSE
                                                                mcod_merc := VAL(mcod_bc)
                                                                mcons_merc:={}
                                                                sr_getconnection():exec("SELECT * FROM sacmerc WHERE cod_merc = "+sr_cdbvalue(mcod_bc),,.t.,@mcons_merc)
                                                                IF LEN(mcons_merc) = 0
                                                                        atencao('Codigo da mercadoria nao cadastrado')
                                                                        LOOP
                                                                ENDIF
                                                        ENDIF
                                                ELSEIF ! EMPTY(mmerc)
                                                        IF(m_set[1,93] <> 'A',f4_merc(),f4_merc1())
                                                                //f4_merc()
                                                                IF LASTKEY() = 27;LOOP;ENDIF
                                                                mcons_merc:={}
                                                                sr_getconnection():exec("SELECT * FROM sacmerc WHERE cod_merc = "+sr_cdbvalue(mcod_bc),,.t.,@mcons_merc)
                                                                IF LEN(mcons_merc) = 0
                                                                        atencao('Codigo da mercadoria nao cadastrado')
                                                                        LOOP
                                                                ENDIF
                                                ENDIF

                                                y := 0
                                                FOR y = 1 TO LEN(m_entrada)
                                                        IF mcod_merc = m_entrada[y,2]
                                                                atencao('Este Produto ja foi Incluido')
                                                                EXIT
                                                        ENDIF
                                                NEXT
                                                mcod_merc := VAL(mcons_merc[1,8])
                                                mmerc := mcons_merc[1,9]
                                                munidade := mcons_merc[1,14]
                                                mp_lucro := mcons_merc[1,22]
                                                mpeso := mcons_merc[1,17]
						mgramatura := mcons_merc[1,76]
                                                setcor(3)
                                                DEVPOS(12,14);DEVOUT(STRZERO(mcod_merc,5))
                                                DEVPOS(12,21);DEVOUT(mcons_merc[1,9])
                                                DEVPOS(12,66);DEVOUT(munidade)
                                                DEVPOS(15,13);DEVOUTPICT(mp_lucro,'999.99')
                                                DEVPOS(18,13);DEVOUTPICT(mgramatura,'9.999')
                                                DEVPOS(15,63);DEVOUTPICT(mcons_merc[1,43],'9,999,999.99')
                                                DEVPOS(16,63);DEVOUTPICT(mcons_merc[1,44],'9,999,999.99')
                                                DEVPOS(17,63);DEVOUTPICT(mcons_merc[1,45],'9,999,999.99')
                                                DEVPOS(18,63);DEVOUTPICT(mcons_merc[1,48],'9,999,999.99')
                                                DEVPOS(19,63);DEVOUTPICT(mcons_merc[1,46],'9,999,999.99')
                                                DEVPOS(20,63);DEVOUTPICT(mcons_merc[1,46]-mcons_merc[1,48],'9,999,999.99')
                                                DEVPOS(21,63);DEVOUTPICT(mcons_merc[1,56],'999,999.99')
                                                setcor(1)
                                                //ver_merc()
                                                mcfop := mcod_nat
                                                @ 13,13 GET mcfop PICT '9.999'
                                                @ 14,13 GET mquantd PICT (unidade(mcons_merc[1,14])) VALID IF(EMPTY(mquantd),.F.,.T.)
                                                @ 15,13 GET mp_lucro PICT '999.99'
                                                //@ 16,13 GET mpr_unit PICT (ALLTRIM(m_set[1,97])) VALID IF(EMPTY(mpr_unit),.F.,.T.)
                                                @ 16,13 GET mpr_unit PICT '9,999,999.9999' VALID IF(EMPTY(mpr_unit),.F.,.T.)
                                                @ 17,13 GET micm PICT '999.99' WHEN (mnivel_cal = '1' .OR. mnivel_cal = '3')
                                                @ 18,13 GET mgramatura PICT '9.999' WHEN mgramatura > 0
                                                //@ 19,13 GET mdesc1 PICT '9999.9999' WHEN (mnivel_cal = '1' .OR. mnivel_cal = '3')       //.AND. men_get(15,09,'Informe desconto '+tp_ipi)
                                                @ 20,13 GET mipi_aux PICT '999,999.9999' WHEN (mnivel_cal = '1' .OR. mnivel_cal = '3')  //.AND. men_get(15,45,'Informe IPI '+tp_ipi)
                                                @ 21,13 GET mii_aux PICT '9999.999' WHEN (mnivel_cal = '1' .OR. mnivel_cal = '3')       //.AND. men_get(15,45,'Informe I.I. [Imposto de Importacao] '+tp_ipi)
                                                @ 22,13 GET mvlr_icm_sub PICT '999,999.99' WHEN (mnivel_cal = '1' .OR. mnivel_cal = '3') .AND. mtipo_icmsub = 'I'
                                                READ
                                                IF LASTKEY() = 27;LOOP;ENDIF
                                                mquantd_aux := mquantd
                                                mpreco_aux := mpr_unit
                                                IF mgramatura > 1
                                                        mquantd := mquantd_aux * mgramatura
                                                        mpr_unit := mpreco_aux / mgramatura
                                                ENDIF

                                                IF mv = 'X'
                                                        mipi := (mipi_aux / (mquantd * mpr_unit)) * 100
                                                        mii := (mii_aux / (mquantd * mpr_unit)) * 100
                                                        mdesc_aux := (mdesc1 / mpr_unit) * 100
                                                        mdesc1 := mdesc_aux
                                                        mdesc_aux := (mdesc2 / mpr_unit) * 100
                                                        mdesc2 := mdesc_aux
                                                        mdesc_aux := (mdesc3 / mpr_unit) * 100
                                                        mdesc3 := mdesc_aux
                                                ENDIF
                                                setcor(3)
                                                DEVPOS(14,13);DEVOUTPICT(mquantd,(unidade(mcons_merc[1,14])))
                                                DEVPOS(16,13);DEVOUTPICT(mpr_unit,'9,999,999.9999')
                                                setcor(1)
                                                * Calculo de Custo da Mercadoria
                                                calc_cus()
                                                ********************************
                                                opcao := op_simnao('S','Confirma a Entrada da Mercadoria:')
                                                IF opcao = 'N'
                                                        LOOP
                                                ELSE
                                                        SR_BEGINTRANSACTION()
                                                        TRY
                                                        mtot_icmsub := mtot_icmsub + mvlr_icm_sub
                                                        sr_getconnection():exec("UPDATE sacmerc SET p_lucro = "+sr_cdbvalue(mp_lucro) +" WHERE cod_merc = "+sr_cdbvalue(mcons_merc[1,8]),,.f.)
                                                        sr_getconnection():exec('COMMIT',,.f.)
                                                        sr_committransaction()
                                                        CATCH e
                                                        SR_ENDTRANSACTION()
                                                        END
                                                        *                      1          2      3      4         5          6          7
                                                        *         8         9      10         11         12    13    14     15     16
                                                        *          17           18            19          20         21      22       23            24        25      26   27
                                                        AADD(m_entrada,{mcons_merc[1,7],mcod_merc,mmerc,mpr_unit,mvlr_merc,mcust_merc,mcust_real,;
                                                             mpr_medio,mpr_venda,mquantd,mcons_merc[1,74],mipi,mpeso,mdesc1,mdesc2,mdesc3,;
                                                             mcons_merc[1,30],mcons_merc[1,31],mcons_merc[1,61],mquantd_aux,mpreco_aux,mii,mcons_merc[1,14],mcons_merc[1,68],mcfop,micmsub,micm,mcons_merc[1,56]})
                                                        AADD(m_tipo4  ,{mcons_merc[1,7],mcod_merc,mmerc,mpr_unit4,mvlr_merc4,mcust_mer4,mcust_rea4,;
                                                             mpr_medio4,mpr_venda4,mquantd,mcons_merc[1,74],mipi,mpeso,mdesc1,mdesc2,mdesc3,;
                                                             mcons_merc[1,30],mcons_merc[1,31],mcons_merc[1,61],mquantd_aux,mpreco_aux,mii,mcons_merc[1,14],mcons_merc[1,68],mcfop,micmsub,micm,mcons_merc[1,56]})
                                                        AADD(m_demo,STRZERO(mcod_merc,5)+'-'+mmerc+' '+TRANSFORM(mquantd_aux,'99999.9999')+' '+TRANSFORM(mpreco_aux,'9,999,999.99'))
                                                        mtot_des := (mpr_unit * mquantd)
                                                        mtot_des := mtot_des - (mtot_des * (mdesc1 / 100))
                                                        mtot_des := mtot_des - (mtot_des * (mdesc2 / 100))
                                                        mtot_vlr := mtot_vlr + (mtot_des + ((mpr_unit*mquantd) * (mipi/100)))
                                                        mtot_vlr := mtot_vlr + (mtot_des + ((mpr_unit*mquantd) * (mii/100)))
                                                        mtot_vlr := iat(mtot_vlr,2)
                                                        mtot_vol := iat(mtot_vol + mquantd_aux,set_aredonda)
                                                        mtot_des := 0
                                                        setcor(3)
                                                        DEVPOS(25,19);DEVOUT(TRANSFORM(mtot_vol,'999,999.999'))
                                                        DEVPOS(25,52);DEVOUT(TRANSFORM(mtot_vlr,'9,999,999.99'))
                                                        DEVPOS(25,82);DEVOUT(TRANSFORM(LEN(m_entrada),'9,999'))
                                                        DEVPOS(27,19);DEVOUT(TRANSFORM(mvol_nota - mtot_vol,'999,999.999'))
                                                        DEVPOS(27,52);DEVOUT(TRANSFORM(mvlr_nota - mtot_vlr,'9,999,999.99'))
                                                        setcor(1)
                                                        LOOP
                                                ENDIF
                                        ENDDO
*                               ENDIF
                                IF iat(mtot_vol,set_aredonda) = mvol_nota
                                        mtot_vlr := mtot_vlr + menc_aux + mfrete_aux
                                        IF mtot_icmsub <> mvlr_icmsub
                                                opcao := op_simnao('N','Existe uma Diferenca no valor do ICM SUBSTITUTO, Valor Informado pela Nota:'+TRANSFORM(mvlr_icmsub,'999,999.99')+' Valor Digitado por Produto:'+TRANSFORM(mtot_icmsub,'999,999.99')+' Diferenca de :'+TRANSFORM(mtot_icmsub - mvlr_icmsub,'999,999.99'))
                                                IF opcao = 'N'
                                                        LOOP
                                                ENDIF
                                        ENDIF                                                        

                                        opcao := op_simnao('S','Todas Informacoes "OK"... Confirma Entrada:')
                                        IF opcao = 'N'
                                                LOOP
                                        ELSE

                                                mvl_base := msoma
                                                repl_forn()
                                                i := 0
                                                SR_BEGINTRANSACTION()
                                                FOR i=1 TO LEN(m_entrada)
                                                        aret := {}
                                                                                  //         1        2        3     4    5        6        7        8         9        10       11       12     13     14      15
                                                        sr_getconnection():exec("SELECT saldo_mer,saldo_fis,doc_ent,icm,pr_unit,vlr_merc,cust_merc,pr_venda,cust_real,pr_medio,cod_barr,cod_merc,merc,unidade,sittrib FROM sacmerc WHERE cod_merc = "+sr_cdbvalue(STRZERO(m_entrada[i,2],5)),,.t.,@aret)
                                                        mlinha := aret[1,11]+aret[1,12]+aret[1,13]+aret[1,14]+STRZERO((aret[1,1] + m_entrada[i,10])*1000,13)+STRZERO(iat(m_entrada[i,9])*100,14)+aret[1,15]
                                                        ver_nat(m_entrada[i,25],'E')
                                                        sr_getconnection():exec("UPDATE sacmerc SET data_atu = "+sr_cdbvalue(mdata_sis)+;
                                                                              ",a_pr_unit = "+sr_cdbvalue(aret[1,5])+;
                                                                              ",a_vlr_merc = "+sr_cdbvalue(aret[1,6])+;
                                                                              ",a_cust_mer = "+sr_cdbvalue(aret[1,7])+;
                                                                              ",a_pr_venda = "+sr_cdbvalue(aret[1,8] )+;
                                                                              ",a_cust_rea = "+sr_cdbvalue(aret[1,9])+;
                                                                              ",a_pr_medio = "+sr_cdbvalue(aret[1,10] )+;
                                                                              ",pr_unit   = "+sr_cdbvalue(iat(m_entrada[i,4],set_aredonda))+;
                                                                              ",vlr_merc  = "+sr_cdbvalue(iat(m_entrada[i,5],set_aredonda))+;
                                                                              ",cust_merc = "+sr_cdbvalue(iat(m_entrada[i,6],set_aredonda))+;
                                                                              ",pr_venda  = "+sr_cdbvalue(iat(m_entrada[i,9],set_aredonda))+;
                                                                              ",cust_real = "+sr_cdbvalue(iat(m_entrada[i,7],set_aredonda))+;
                                                                              ",pr_medio  = "+sr_cdbvalue(iat(m_entrada[i,8],set_aredonda))+;
                                                                              ",saldo_mer = "+sr_cdbvalue(aret[1,1] + m_entrada[i,10]   )+;
                                                                              ",dat_ult_e = "+sr_cdbvalue(mchegada                          )+;
                                                                              ",ul_alt_pr = "+IF(aret[1,8] <> m_entrada[i,9],sr_cdbvalue(mdata_sis),nulo)+;//sr_cdbvalue(IF(aret[1,8] <> m_entrada[i,9],mdata_sis,nulo))+; //",ul_alt_pr = "+sr_cdbvalue(mchegada                          )+;
                                                                              ",opera_pr     = "+sr_cdbvalue(cod_operado)+;
                                                                              ",isento    = "+sr_cdbvalue(m_entrada[i,19]                   )+;
                                                                              ",doc_ent_a = "+sr_cdbvalue(aret[1,3]                     )+;
                                                                              ",doc_ent   = "+sr_cdbvalue('PD'+mnota                        )+;
                                                                              ",saldo_fis = "+sr_cdbvalue(aret[1,2] + IF(mcredito='S',m_entrada[i,10],0))+;
                                                                              ",icm = "+sr_cdbvalue(iat(aret[1,4] + IF(! EMPTY(m_entrada[i,27]),((m_entrada[i,5] * m_entrada[i,10])* (m_entrada[i,27]/100)),0),2))+;
                                                                              ",chv_cript = "+sr_cdbvalue(CRIPTO(mlinha,1))+;
                                                                              " WHERE cod_merc = "+sr_cdbvalue(STRZERO(m_entrada[i,2],5)),,.f.)
                                                        sr_getconnection():exec('INSERT INTO logproduto (data_sis,data,'+;
                                                                                'hora,cod_prod,quantd,saldo_ant,saldo_pos,cod_oper,prog,terminal,'+;
                                                                                'processo,ent_sai,SR_DELETED )'+;
                                                                                ' VALUES ('+;
                                                                                sr_cdbvalue(DATE())+','+; //1
                                                                                sr_cdbvalue(mdata_sis)+','+; //2
                                                                                sr_cdbvalue(TIME())+','+; //3
                                                                                sr_cdbvalue(STRZERO(m_entrada[i,2],5))+','+; //4
                                                                                sr_cdbvalue(m_entrada[i,10])+','+; //5
                                                                                sr_cdbvalue(aret[1,1])+','+; //6
                                                                                sr_cdbvalue(aret[1,1] + m_entrada[i,10])+','+; //7
                                                                                sr_cdbvalue(cod_operado)+','+; //8
                                                                                sr_cdbvalue('SAC22')+','+; //9
                                                                                sr_cdbvalue(LEFT(NETNAME(),15))+','+; //12
                                                                                sr_cdbvalue(IF(mcod_op = '02','ENTRADA: PD','ENTRADA: NF')+mnota)+','+; //11
                                                                                sr_cdbvalue('E')+','+; //11
                                                                                sr_cdbvalue(' ')+')',,.f.)
                                                                                IF mcredito='S'
                                                                                        sr_getconnection():exec('INSERT INTO logprod_fis (data_sis,data,'+;
                                                                                                'hora,cod_prod,quantd,saldo_ant,saldo_pos,cod_oper,prog,terminal,'+;
                                                                                                'processo,ent_sai )'+;
                                                                                                ' VALUES ('+;
                                                                                                sr_cdbvalue(DATE())+','+; //1
                                                                                                sr_cdbvalue(mdata_sis)+','+; //2
                                                                                                sr_cdbvalue(TIME())+','+; //3
                                                                                                sr_cdbvalue(STRZERO(m_entrada[i,2],5))+','+; //4
                                                                                                sr_cdbvalue(m_entrada[i,10])+','+; //5
                                                                                                sr_cdbvalue(aret[1,2])+','+; //6
                                                                                                sr_cdbvalue(aret[1,2] + m_entrada[i,10])+','+; //7
                                                                                                sr_cdbvalue(cod_operado)+','+; //8
                                                                                                sr_cdbvalue('SAC22')+','+; //9
                                                                                                sr_cdbvalue(LEFT(NETNAME(),15))+','+; //12
                                                                                                sr_cdbvalue('ENTRADA: '+mtp_nota+mnota)+','+; //11
                                                                                                sr_cdbvalue('E')+')',,.f.)
                                                                                ENDIF
                                                NEXT
                                                sr_committransaction()
                                                SR_ENDTRANSACTION()
                                                i := 0
                                                FOR i=1 TO LEN(m_entrada)
                                                        *************
                                                        SELE('mov');ORDSETFOCUS(1)
                                                        *************
                                                        mtp_nota := 'NF'
                                                        atu_movi('NF','01',i)
                                                NEXT i
                                                sr_getconnection():exec('INSERT INTO sactotnt (empresa,'+;
                                                        'documento,serie,modelo,'+;
                                                        'num_ped,emissao,ent_sai,'+;
                                                        'cod_cli,cliente,uf_cli,'+;
                                                        'cid_cli,insc_cli,cpf_cli,'+;
                                                        'cgc_cli,vl_nota,'+;
                                                        'vl_icm,aliq_icm,vlr_icmsub,base_icmsu,'+;
                                                        'frete,encargo_f,disp_asse,ipi,'+;
                                                        'vl_base,cod_nat,norm_ele,'+;
                                                        'SR_DELETED )'+;
                                                        ' VALUES ('+;
                                                        sr_cdbvalue(mcodempresa         )+','+; //1
                                                        sr_cdbvalue('NF'+mnota          )+','+; //2
                                                        sr_cdbvalue(mserie              )+','+; //3
                                                        sr_cdbvalue(mmodelo             )+','+; //4
                                                        sr_cdbvalue(STRZERO(mnum_ped,6) )+','+; //5
                                                        sr_cdbvalue(mchegada            )+','+; //6
                                                        sr_cdbvalue('E'                 )+','+; //7
                                                        sr_cdbvalue(STRZERO(mcod_forn,4))+','+; //8
                                                        sr_cdbvalue(LEFT(mfornece,30)   )+','+;//9
                                                        sr_cdbvalue(forn->uf    )+','+;//10
                                                        sr_cdbvalue(forn->cidade)+','+; //11
                                                        sr_cdbvalue(forn->insc  )+','+;//12
                                                        sr_cdbvalue(forn->cpf   )+','+;//13
                                                        sr_cdbvalue(forn->cgc   )+','+;//14
                                                        sr_cdbvalue(mvlr_nota   )+','+;//15
                                                        sr_cdbvalue(mvalor_icm     )+','+;//16
                                                        sr_cdbvalue(m_entrada[1,27])+','+;//17
                                                        sr_cdbvalue(mvlr_icmsub )+','+;//18
                                                        sr_cdbvalue(mbas_icmsub )+','+;//19
                                                        sr_cdbvalue(mfrete_aux  )+','+;//20
                                                        sr_cdbvalue(menc_aux    )+','+;//21
                                                        sr_cdbvalue(mdisp_aux   )+','+;//22
                                                        sr_cdbvalue(iat(mtot_ipi,2))+','+;//23
                                                        sr_cdbvalue(mvlr_base   )+','+;//24
                                                        sr_cdbvalue(mcod_nat    )+','+;//24
                                                        sr_cdbvalue(mnorm_ele    )+','+;//25
                                                        sr_cdbvalue(' ')+')',,.f.)
                                                sr_getconnection():exec("COMMIT",,.f.)
                                                ****************
                                                SELE('icm')
                                                GO TOP
                                                ****************
                                                IF BLOQREG()
                                                        icm-> data := mchegada
                                                        icm-> documento := 'NF'+mnota
                                                        icm-> deb_cred := icm->deb_cred + iat(mtot_icm,2)
                                                        DBCOMMIT()
                                                        DBUNLOCK()
                                                ENDIF
                                                opcao := mensagem1('Deseja emitir o resumo da nota fiscal de entrada: ','S','S,N')
                                                IF opcao = 'S'
                                                        imp_resu(mtp_nota,mnota)
                                                ENDIF
                                        ENDIF
                                ENDIF
                        ENDIF
                ENDIF
        ELSE
                f6_forn()
                @ 3,42 GET mcod_forn PICT '9999' VALID IF(EMPTY(mcod_forn),.F.,ent_forn(@mcod_forn,3,47))
                READ
                setcor(3)
                DEVPOS(3,42);DEVOUT(STRZERO(mcod_forn,4))
                DEVPOS(3,47);DEVOUT(forn->razao)
                muf_forn := forn->uf
                muf      := forn->uf
                setcor(1)
                ver_uf(muf)
                micm := mperc
                IF LASTKEY() = 27;LOOP;ENDIF
                @ 6,09 GET mnota PICT '@!' VALID ver_ent()
                READ
                IF LASTKEY() = 27;LOOP;ENDIF
                **************************
                SELE('mov');ORDSETFOCUS(4)
                GO TOP
                **************************
                mtp_nota := 'PD'
                IF mov->(DBSEEK(mtp_nota+mnota+'  '+'E'+STRZERO(mcod_forn,4)))
                        atencao('Esta Nota ja foi processada')
                        LOOP
                ENDIF
                @ 6,25 GET mvol_nota PICT '999,999.999' VALID IF(EMPTY(mvol_nota),.F.,.T.)
                READ
                IF LASTKEY() = 27;LOOP;ENDIF
                mv := 'X'
                mcfop := mcod_nat
                opcao := op_simnao('S','Confirma os dados da Nota Fiscal:')
                IF opcao = 'N'
                        LOOP
                ELSE
                        mtot_vlr := mtot_vol := 0
                        ASIZE(m_entrada,0)
                        ASIZE(m_tipo4,0)
                        ASIZE(m_demo,0)
                        WHILE .T.
                                botao(14,49,21,76,,' Valores Atuais  ')
                                DEVPOS(15,50);DEVOUT('Vlr.Mercad.:')
                                DEVPOS(16,50);DEVOUT('Cus.Mercad.:')
                                DEVPOS(17,50);DEVOUT('Custo Real.:')
                                DEVPOS(18,50);DEVOUT('Custo Medio:')
                                DEVPOS(19,50);DEVOUT('Preco Venda:')
                                DEVPOS(20,50);DEVOUT('Lucro R$...:')
                                DEVPOS(21,50);DEVOUT('Saldo Atual:             ')

                                IF mtot_vol = mvol_nota
                                        EXIT
                                ENDIF
                                *************
                                SELE('merc');ORDSETFOCUS(1)
                                GO TOP
                                *************
                                munidade := SPACE(3)
                                mmerc := SPACE(40)
                                mcod_bc := SPACE(14)
                                mcod_merc := mquantd := mp_lucro := ;
                                mpr_unit := mdesc_aux := mdesc1 := ;
                                mdesc2 := mdesc3 := mipi := mipi_aux := ;
                                mii := mii_aux := mpeso := mvlr_merc := ;
                                mcus_merc := mcus_real := mpr_venda := ;
                                mpr_medio := mlucro := ;
                                mvlr_merc4 := mcus_merc4 := mcus_real4 :=;
                                mpr_venda4 := mpr_medio4 := mpr_unit4 := mvlr_icm_sub := 0
                                setcor(3)
                                DEVPOS(12,14);DEVOUTPICT(mcod_merc,'99999')
                                DEVPOS(12,20);DEVOUT(mmerc)
                                DEVPOS(12,66);DEVOUT(munidade)
                                DEVPOS(13,28);DEVOUTPICT(mp_lucro,'999.99')
                                IF mp == 'X'
                                        tp_ipi = 'PERCENTUAL'
                                ELSE
                                        tp_ipi = 'VALOR (R$)'
                                ENDIF
                                setcor(1)
                                mensagem('Digite Codigo ou <ENTER>p/Desc. - <ALT+P>Cad.PROD. - <F10>Consulta')
                                f4 := ' '
                                @ 12,14 GET mcod_bc PICT '@!'   //WHEN men_get(13,14,'Digite o Codigo ou <ENTER>p/Digitar Descricao - <ALT+P>cadastra PRODUTOS') VALID lim_get()
                                READ
                                IF LASTKEY() = 27
                                        opcao := op_simnao('N','Deseja abandonar a entrada da NOTA:')
                                        IF opcao = 'N'
                                                LOOP
                                        ENDIF
                                        RESTSCREEN(00,00,24,79,tela)
                                        DBCLOSEALL()
                                        wvw_lclosewindow()
                                        RETURN NIL
                                ENDIF
                                IF EMPTY(mcod_bc)
                                        @ 12,21 GET mmerc PICT '@!'             //VALID lim_get() WHEN men_get(12,21,'<Digite descricao mercadoria>  <ENTER>p/retornar ')
                                        READ
                                        IF LASTKEY() = 27;LOOP;ENDIF
                                ENDIF
                                IF EMPTY(mcod_bc) .AND. EMPTY(mmerc)
                                        LOOP
                                ENDIF
                                IF ! EMPTY(mcod_bc)
                                        IF LEN(RTRIM(mcod_bc)) > 5 .OR. VAL(mcod_bc) = 0
                                                mcons_merc:={}
                                                sr_getconnection():exec("SELECT * FROM sacmerc WHERE cod_barr = "+sr_cdbvalue(mcod_bc),,.t.,@mcons_merc)
                                                IF LEN(mcons_merc) = 0
                                                        mcons_merc:={}
                                                        sr_getconnection():exec("SELECT * FROM sacmerc WHERE ref = "+sr_cdbvalue(mcod_bc),,.t.,@mcons_merc)
                                                        IF LEN(mcons_merc) = 0
                                                                atencao('Codigo de BARRA e REFERENCIA AUXILIAR nao cadastrado')
                                                                LOOP
                                                        ENDIF
                                                ENDIF
                                                mcod_merc := VAL(mcod_bc)
                                        ELSE
                                                mcod_merc := VAL(mcod_bc)
                                                mcons_merc:={}
                                                sr_getconnection():exec("SELECT * FROM sacmerc WHERE cod_merc = "+sr_cdbvalue(mcod_bc),,.t.,@mcons_merc)
                                                IF LEN(mcons_merc) = 0
                                                        atencao('Codigo da mercadoria nao cadastrado')
                                                        LOOP
                                                ENDIF
                                        ENDIF
                                ELSEIF ! EMPTY(mmerc)
                                        IF(m_set[1,93] <> 'A',f4_merc(),f4_merc1())
                                        //f4_merc()
                                        IF LASTKEY() = 27;LOOP;ENDIF
                                        mcons_merc:={}
                                        sr_getconnection():exec("SELECT * FROM sacmerc WHERE cod_merc = "+sr_cdbvalue(mcod_bc),,.t.,@mcons_merc)
                                        IF LEN(mcons_merc) = 0
                                                atencao('Codigo da mercadoria nao cadastrado')
                                                LOOP
                                        ENDIF
                                ENDIF
                                y := 0
                                FOR y = 1 TO LEN(m_entrada)
                                        IF mcod_merc = m_entrada[y,2]
                                                atencao('Este Produto ja foi Incluido')
                                                EXIT
                                        ENDIF
                                NEXT
                                mcod_merc := VAL(mcons_merc[1,8])
                                mmerc := mcons_merc[1,9]
                                munidade := mcons_merc[1,14]
                                mp_lucro := mcons_merc[1,22]
                                mpeso := mcons_merc[1,17]
				mgramatura := mcons_merc[1,76]
                                setcor(3)
                                DEVPOS(12,14);DEVOUT(STRZERO(mcod_merc,5))
                                DEVPOS(12,20);DEVOUT(mcons_merc[1,9])
                                DEVPOS(12,66);DEVOUT(munidade)
                                DEVPOS(15,13);DEVOUTPICT(mp_lucro,'999.99')
                                DEVPOS(18,13);DEVOUTPICT(mgramatura,'9.999')
                                DEVPOS(15,01);DEVOUTPICT(mcons_merc[1,43],'9,999,999.99')
                                DEVPOS(16,14);DEVOUTPICT(mcons_merc[1,44],'9,999,999.99')
                                DEVPOS(17,27);DEVOUTPICT(mcons_merc[1,45],'9,999,999.99')
                                DEVPOS(18,40);DEVOUTPICT(mcons_merc[1,48],'9,999,999.99')
                                DEVPOS(19,53);DEVOUTPICT(mcons_merc[1,46],'9,999,999.99')
                                DEVPOS(20,66);DEVOUTPICT(mcons_merc[1,46]-mcons_merc[1,48],'9,999,999.99')
                                DEVPOS(21,27);DEVOUTPICT(mcons_merc[1,56],'999,999.99')
                                setcor(1)
                                //ver_merc()
                                @ 14,13 GET mquantd PICT (unidade(mcons_merc[1,14])) VALID IF(EMPTY(mquantd),.F.,.T.)
                                //@ 16,13 GET mpr_unit PICT (ALLTRIM(m_set[1,97]))
                                @ 16,13 GET mpr_unit PICT '9,999,999.9999'
                                READ
                                IF LASTKEY() = 27;LOOP;ENDIF
                                mquantd_aux := mquantd
                                mpreco_aux := mpr_unit
                                IF mgramatura > 1
                                        mquantd := mquantd_aux * mgramatura
                                        mpr_unit := mpreco_aux / mgramatura
                                ENDIF

                                setcor(3)
                                DEVPOS(14,13);DEVOUTPICT(mquantd,(unidade(mcons_merc[1,14])))
                                DEVPOS(16,13);DEVOUTPICT(mpr_unit,'9,999,999.9999')
                                setcor(1)
                                ********************************
                                opcao := op_simnao('S','Confirma a Entrada da Mercadoria [S/n]:')
                                IF opcao = 'N'
                                        LOOP
                                ELSE
                                        mtot_icmsub := mtot_icmsub + mvlr_icm_sub
                                        *                      1          2      3      4         5          6          7
                                        *         8         9      10         11         12    13    14     15     16
                                        *          17           18            19          20         21      22       23            24        25      26   27
                                        AADD(m_entrada,{mcons_merc[1,7],mcod_merc,mmerc,mpr_unit,mvlr_merc,mcust_merc,mcust_real,;
                                             mpr_medio,mpr_venda,mquantd,mcons_merc[1,74],mipi,mpeso,mdesc1,mdesc2,mdesc3,;
                                             mcons_merc[1,30],mcons_merc[1,31],mcons_merc[1,61],mquantd_aux,mpreco_aux,mii,mcons_merc[1,14],mcons_merc[1,68],mcfop,micmsub,micm,mcons_merc[1,56]})
                                        AADD(m_tipo4  ,{mcons_merc[1,7],mcod_merc,mmerc,mpr_unit4,mvlr_merc4,mcust_mer4,mcust_rea4,;
                                             mpr_medio4,mpr_venda4,mquantd,mcons_merc[1,74],mipi,mpeso,mdesc1,mdesc2,mdesc3,;
                                             mcons_merc[1,30],mcons_merc[1,31],mcons_merc[1,61],mquantd_aux,mpreco_aux,mii,mcons_merc[1,14],mcons_merc[1,68],mcfop,micmsub,micm,mcons_merc[1,56]})
                                        AADD(m_demo,STRZERO(mcod_merc,5)+'-'+mmerc+' '+TRANSFORM(mquantd_aux,'99999.9999')+' '+TRANSFORM(mpreco_aux,'9,999,999.99'))
                                        mtot_des := (mpr_unit * mquantd)
                                        mtot_des := mtot_des - (mtot_des * (mdesc1 / 100))
                                        mtot_des := mtot_des - (mtot_des * (mdesc2 / 100))
                                        mtot_vlr := mtot_vlr + (mtot_des + ((mpr_unit*mquantd) * (mipi/100)))
                                        mtot_vlr := mtot_vlr + (mtot_des + ((mpr_unit*mquantd) * (mii/100)))
                                        mtot_vlr := iat(mtot_vlr,2)
                                        mtot_vol := iat(mtot_vol + mquantd_aux,set_aredonda)
                                        mtot_des := 0
                                        setcor(3)
                                        DEVPOS(25,19);DEVOUT(TRANSFORM(mtot_vol,'999,999.999'))
                                        DEVPOS(25,52);DEVOUT(TRANSFORM(mtot_vlr,'9,999,999.99'))
                                        DEVPOS(25,82);DEVOUT(TRANSFORM(LEN(m_entrada),'9,999'))
                                        DEVPOS(27,19);DEVOUT(TRANSFORM(mvol_nota - mtot_vol,'999,999.999'))
                                        DEVPOS(27,52);DEVOUT(TRANSFORM(mvlr_nota - mtot_vlr,'9,999,999.99'))
                                        setcor(1)

                                        LOOP
                                ENDIF
                        ENDDO
                        IF iat(mtot_vol,set_aredonda) = mvol_nota
                                mtot_vlr := mtot_vlr + menc_aux + mfrete_aux
                                IF mtot_icmsub <> mvlr_icmsub
                                        opcao := op_simnao('N','Existe uma Diferenca no valor do ICM SUBSTITUTO, Valor Informado pela Nota:'+TRANSFORM(mvlr_icmsub,'999,999.99')+' Valor Digitado por Produto:'+TRANSFORM(mtot_icmsub,'999,999.99')+' Diferenca de :'+TRANSFORM(mtot_icmsub - mvlr_icmsub,'999,999.99'))
                                        IF opcao = 'N'
                                                LOOP
                                        ENDIF
                                ENDIF                                                        
                                opcao := op_simnao('S','Todas Informacoes "OK"... Confirma Entrada:')
                                IF opcao = 'N'
                                        LOOP
                                ELSE
                                        SR_BEGINTRANSACTION()
                                        mvl_base := msoma
                                        repl_forn()
                                        i := 0
                                        FOR i=1 TO LEN(m_entrada)
                                                        aret := {}
                                                                                  //         1        2        3     4    5        6        7      8      9      10      11
                                                        sr_getconnection():exec("SELECT saldo_mer,saldo_fis,doc_ent,icm,chegada,cod_barr,cod_merc,merc,unidade,sittrib,pr_venda FROM sacmerc WHERE cod_merc = "+sr_cdbvalue(STRZERO(m_entrada[i,2],5)),,.t.,@aret)
                                                        mlinha := aret[1,6]+aret[1,7]+aret[1,8]+aret[1,9]+STRZERO((aret[1,1] + m_entrada[i,10])*1000,13)+STRZERO(iat(aret[1,11])*100,14)+aret[1,10]

                                                        sr_getconnection():exec("UPDATE sacmerc SET "+;
                                                                              ",saldo_ant = "+sr_cdbvalue(aret[1,1])+;
                                                                              ",saldo_mer = "+sr_cdbvalue(aret[1,1] + m_entrada[i,10])+;
                                                                              ",dat_ult_e = "+sr_cdbvalue(mchegada                    )+;
                                                                              ",doc_ent_a = "+sr_cdbvalue(aret[1,3]                     )+;
                                                                              ",doc_ent   = "+sr_cdbvalue('PD'+mnota                        )+;
                                                                              ",saldo_fis = "+sr_cdbvalue(aret[1,2] + m_entrada[i,10])+;
                                                                              ",chv_cript = "+sr_cdbvalue(CRIPTO(mlinha,1))+;
                                                                              " WHERE cod_merc = "+sr_cdbvalue(STRZERO(m_entrada[i,2],5)),,.f.)
                                                        sr_getconnection():exec('INSERT INTO logproduto (data_sis,data,'+;
                                                                                'hora,cod_prod,quantd,saldo_ant,saldo_pos,cod_oper,prog,terminal,'+;
                                                                                'processo,ent_sai,SR_DELETED )'+;
                                                                                ' VALUES ('+;
                                                                                sr_cdbvalue(DATE())+','+; //1
                                                                                sr_cdbvalue(mdata_sis)+','+; //2
                                                                                sr_cdbvalue(TIME())+','+; //3
                                                                                sr_cdbvalue(STRZERO(m_entrada[i,2],5))+','+; //4
                                                                                sr_cdbvalue(m_entrada[i,10])+','+; //5
                                                                                sr_cdbvalue(aret[1,1])+','+; //6
                                                                                sr_cdbvalue(aret[1,1] + m_entrada[i,10])+','+; //7
                                                                                sr_cdbvalue(cod_operado)+','+; //8
                                                                                sr_cdbvalue('SAC22')+','+; //9
                                                                                sr_cdbvalue(LEFT(NETNAME(),15))+','+; //12
                                                                                sr_cdbvalue(IF(mcod_op = '02','ENTRADA: PD','ENTRADA: NF')+mnota)+','+; //11
                                                                                sr_cdbvalue('E')+','+; //12
                                                                                sr_cdbvalue(' ')+')',,.f.)
                                                        sr_getconnection():exec('INSERT INTO logprod_fis (data_sis,data,'+;
                                                                'hora,cod_prod,quantd,saldo_ant,saldo_pos,cod_oper,prog,terminal,'+;
                                                                'processo,ent_sai )'+;
                                                                ' VALUES ('+;
                                                                sr_cdbvalue(DATE())+','+; //1
                                                                sr_cdbvalue(mdata_sis)+','+; //2
                                                                sr_cdbvalue(TIME())+','+; //3
                                                                sr_cdbvalue(STRZERO(m_entrada[i,2],5))+','+; //4
                                                                sr_cdbvalue(m_entrada[i,10])+','+; //5
                                                                sr_cdbvalue(aret[1,2])+','+; //6
                                                                sr_cdbvalue(aret[1,2] + m_entrada[i,10])+','+; //7
                                                                sr_cdbvalue(cod_operado)+','+; //8
                                                                sr_cdbvalue('SAC22')+','+; //9
                                                                sr_cdbvalue(LEFT(NETNAME(),15))+','+; //12
                                                                sr_cdbvalue('ENTRADA: '+mtp_nota+mnota)+','+; //11
                                                                sr_cdbvalue('E')+')',,.f.)
                                        NEXT
                                        sr_committransaction()
                                        SR_ENDTRANSACTION()
                                        i := 0
                                        FOR i=1 TO LEN(m_entrada)
                                                ver_cod(m_entrada[i,2],,,,,'*')
                                                sr_getconnection():exec('INSERT INTO sacmov (empresa,'+;
                                                        'documento,serie,modelo,'+;
                                                        'num_ped,ped_forn,data_ped,'+;
                                                        'gru_sub,codigo,produto,cod_fab,'+;
                                                        'fabrica,unidade,data_s_e,ent_sai,'+;
                                                        'saldo_ant,quantd,quantd_aux,'+;
                                                        'pr_venda1,pr_venda,pr_unit,cod_forn,'+;
                                                        'fornece,uf_cli,icm_aliq,icm_sub,'+;
                                                        'fob,cif,dia1,dia2,dia3,emissao,saida,'+;
                                                        'chegada,disp_asse,'+;
                                                        'ipi_aliq,ipi,peso,desc1,desc2,desc3,'+;
                                                        'tipo,isento,sittrib,cod_nat,cod_oper,'+;
                                                        'icm,norm_ele,SR_DELETED )'+;
                                                        ' VALUES ('+;
                                                        sr_cdbvalue(mcodempresa         )+','+; //1
                                                        sr_cdbvalue('PD'+mnota          )+','+; //2
                                                        sr_cdbvalue(mserie              )+','+; //3
                                                        sr_cdbvalue(mmodelo             )+','+; //4
                                                        sr_cdbvalue(STRZERO(mnum_ped,6) )+','+; //5
                                                        sr_cdbvalue(mped_forn              )+','+; //6
                                                        sr_cdbvalue(mdata_ped              )+','+; //7
                                                        sr_cdbvalue(m_entrada[i,1]           )+','+; //8
                                                        sr_cdbvalue(STRZERO(m_entrada[i,2],5))+','+;//9
                                                        sr_cdbvalue(m_entrada[i,3]           )+','+;//10
                                                        sr_cdbvalue(m_entrada[i,17]          )+','+; //11
                                                        sr_cdbvalue(LEFT(m_entrada[i,18],30)          )+','+;//12
                                                        sr_cdbvalue(m_entrada[i,23]          )+','+;//13
                                                        sr_cdbvalue(mchegada               )+','+;//14
                                                        sr_cdbvalue('E'                    )+','+;//15
                                                        sr_cdbvalue(m_entrada[i,28]          )+','+;//16
                                                        sr_cdbvalue(m_entrada[i,10]          )+','+;//17
                                                        sr_cdbvalue(m_entrada[i,10]          )+','+;//18
                                                        sr_cdbvalue(mcons_merc[1,46]         )+','+;//19
                                                        sr_cdbvalue(m_entrada[i,9]           )+','+;//20
                                                        sr_cdbvalue(m_entrada[i,5]           )+','+;//21
                                                        sr_cdbvalue(STRZERO(mcod_forn,4)   )+','+;//22
                                                        sr_cdbvalue(LEFT(mfornece,30)      )+','+;//23
                                                        sr_cdbvalue(forn->uf               )+','+;//24
                                                        sr_cdbvalue(m_entrada[i,27]                                       )+','+;//13
                                                        sr_cdbvalue(m_entrada[i,26]                                       )+','+;//14
                                                        sr_cdbvalue(mfob                                                )+','+;//15
                                                        sr_cdbvalue(mcif                                                )+','+;//16
                                                        sr_cdbvalue(STRZERO(val(mdia1),2)                                               )+','+;//17
                                                        sr_cdbvalue(STRZERO(val(mdia2),2)                                               )+','+;//18
                                                        sr_cdbvalue(STRZERO(val(mdia3),2)                                               )+','+;//19
                                                        sr_cdbvalue(memissao                                            )+','+;//20
                                                        sr_cdbvalue(msaida                                              )+','+;//21
                                                        sr_cdbvalue(mchegada                                            )+','+;//22
                                                        sr_cdbvalue((m_entrada[i,5] * m_entrada[i,10]) * mfrete             )+','+;//23
                                                        sr_cdbvalue((m_entrada[i,5] * m_entrada[i,10]) * mencargo_f         )+','+;//24
                                                        sr_cdbvalue((m_entrada[i,5] * m_entrada[i,10]) * mdisp_asse         )+','+;//13
                                                        sr_cdbvalue(m_entrada[i,12]                                       )+','+;//14
                                                        sr_cdbvalue((m_entrada[i,5] * m_entrada[i,10]) * (m_entrada[i,12]/100))+','+;//15
                                                        sr_cdbvalue(m_entrada[i,13]                                       )+','+;//16
                                                        sr_cdbvalue((m_entrada[i,4] * m_entrada[i,10]) * (m_entrada[i,14]/100))+','+;//17
                                                        sr_cdbvalue((m_entrada[i,4] * m_entrada[i,10])* (m_entrada[i,15]/100) )+','+;//18
                                                        sr_cdbvalue((m_entrada[i,4] * m_entrada[i,10])*(m_entrada[i,16]/100)  )+','+;//19
                                                        sr_cdbvalue('02'                                                )+','+;//20
                                                        sr_cdbvalue(m_entrada[i,19]                                       )+','+;//21
                                                        sr_cdbvalue(m_entrada[i,24]                                       )+','+;//22
                                                        sr_cdbvalue(m_entrada[i,25]                                       )+','+;//23
                                                        sr_cdbvalue(cod_operado                                         )+','+;//13
                                                        sr_cdbvalue(IF(! EMPTY(m_entrada[i,27]),((m_entrada[i,5] * m_entrada[i,10]) * (m_entrada[i,27]/100)),0))+','+;//13
                                                        sr_cdbvalue(mnorm_ele)+','+;//13
                                                        sr_cdbvalue(' ')+')',,.f.)

                                                mtot_ipi := mtot_ipi + (m_entrada[i,5] * m_entrada[i,10]) * (m_entrada[i,12]/100)
                                                IF ! EMPTY(m_entrada[i,27])
                                                        mtot_icm := mtot_icm + ((m_entrada[i,5] * m_entrada[i,10]) * (m_entrada[i,27]/100))
                                                ENDIF
                                        NEXT i
                                        sr_getconnection():exec('INSERT INTO sactotnt (empresa,'+;
                                                'documento,serie,modelo,'+;
                                                'num_ped,emissao,ent_sai,'+;
                                                'cod_cli,cliente,uf_cli,'+;
                                                'cid_cli,insc_cli,cpf_cli,'+;
                                                'cgc_cli,vl_nota,'+;
                                                'vl_icm,aliq_icm,vlr_icmsub,base_icmsu,'+;
                                                'frete,encargo_f,disp_asse,ipi,'+;
                                                'vl_base,cod_nat,norm_ele,'+;
                                                'SR_DELETED )'+;
                                                ' VALUES ('+;
                                                sr_cdbvalue(mcodempresa         )+','+; //1
                                                sr_cdbvalue('PD'+mnota          )+','+; //2
                                                sr_cdbvalue(mserie              )+','+; //3
                                                sr_cdbvalue(mmodelo             )+','+; //4
                                                sr_cdbvalue(STRZERO(mnum_ped,6) )+','+; //5
                                                sr_cdbvalue(mchegada            )+','+; //6
                                                sr_cdbvalue('E'                 )+','+; //7
                                                sr_cdbvalue(STRZERO(mcod_forn,4))+','+; //8
                                                sr_cdbvalue(LEFT(mfornece,30)   )+','+;//9
                                                sr_cdbvalue(forn->uf    )+','+;//10
                                                sr_cdbvalue(forn->cidade)+','+; //11
                                                sr_cdbvalue(forn->insc  )+','+;//12
                                                sr_cdbvalue(forn->cpf   )+','+;//13
                                                sr_cdbvalue(forn->cgc   )+','+;//14
                                                sr_cdbvalue(mvlr_nota   )+','+;//15
                                                sr_cdbvalue(mvalor_icm     )+','+;//16
                                                sr_cdbvalue(m_entrada[1,27])+','+;//17
                                                sr_cdbvalue(mvlr_icmsub )+','+;//18
                                                sr_cdbvalue(mbas_icmsub )+','+;//19
                                                sr_cdbvalue(mfrete_aux  )+','+;//20
                                                sr_cdbvalue(menc_aux    )+','+;//21
                                                sr_cdbvalue(mdisp_aux   )+','+;//22
                                                sr_cdbvalue(iat(mtot_ipi,2))+','+;//23
                                                sr_cdbvalue(mvlr_base   )+','+;//24
                                                sr_cdbvalue(mcod_nat    )+','+;//24
                                                sr_cdbvalue(mnorm_ele    )+','+;//25
                                                sr_cdbvalue(' ')+')',,.f.)
                                        sr_getconnection():exec("COMMIT",,.f.)
                                        opcao := op_simnao('S','Deseja emitir o resumo da nota fiscal de entrada: ')
                                        IF opcao = 'S';imp_resu(mtp_nota,mnota);ENDIF
                                        /*
                                        IF ver_serie() = '141449' .OR. ver_serie() = '141265'   //.OR. mcod_nat = '1.917' .OR. mcod_nat = '1.918'
                                                op_tela(02,15,13,85,'PAGAMENTO DO PEDIDOS')
                                                WHILE .T.
                                                        mnum_ped := mtot_p := 0
                                                        mensagem('Digite o No.do pedido que deseja PAGAMENTO - <ESC>abandonar')
                                                        @ 9,cci TO 9,cba
                                                        DEVPOS(1,1);DEVOUT('No.do Pedido:')
                                                        DEVPOS(2,1);DEVOUT('Valor R$....:')
                                                        DEVPOS(3,1);DEVOUT('Data pedido.:')
                                                        DEVPOS(4,1);DEVOUT('Cod.vendedor:')
                                                        DEVPOS(5,1);DEVOUT('Cliente.....:')
                                                        DEVPOS(6,1);DEVOUT('Motivo......:')
                                                        @ 1,15 GET mnum_ped PICT '999999'
                                                        cons_ped:={}
                                                        cComm  := "SELECT * FROM sacped_s WHERE sr_deleted = ' ' AND pnum_ped = "+sr_cdbvalue(STRZERO(mnum_ped,6))+" ORDER BY pnum_ped,pcod_merc"
                                                        sr_getconnection():exec( cComm,,.t.,@cons_ped)
                                                        setcor(3)
                                                        DEVPOS(3,15);DEVOUT(cons_ped[1,4])
                                                        DEVPOS(4,15);DEVOUT(cons_ped[1,32])
                                                        DEVPOS(5,15);DEVOUT(cons_ped[1,23])
                                                        i := 0
                                                        FOR i = 1 TO LEN(cons_ped)
                                                                mtot_p := mtot_p + (cons_ped[i,18] * cons_ped[i,14])
                                                        NEXT
                                                        DEVPOS(2,15);DEVOUT(TRANSFORM(mtot_p,'999,999,999.99'))
                                                        DEVPOS(6,15);DEVOUT('REF.NOTA FISCAL ENTRADA No:'+mnota)
                                                        setcor(1)
                                                        opcao := op_simnao('N','Confirma o Pagamento do Pedido:')
                                                        IF opcao = 'S'
                                                                mensagem('Pagando o PEDIDO... Aguarde')
                                                                ccomm :="UPDATE sacped_s SET ppag = '*',pdatapag = "+sr_cdbvalue(mdata_sis)+",pautoriz = "+sr_cdbvalue(cod_operado)+",pent_por = "+sr_cdbvalue(cod_operado)+",pent_dat = "+sr_cdbvalue(mdata_sis)+",pmotivo = "+sr_cdbvalue('REF.NOTA FISCAL ENTRADA No:'+mdocumento)+",phora_pg = "+sr_cdbvalue(TIME())+" WHERE pnum_ped = "+sr_cdbvalue(STRZERO(mnum_ped,6))
                                                                sr_getconnection():exec(ccomm,,.f.)
                                                                ccomm :="DELETE FROM sacdupr  WHERE num_ped = "+sr_cdbvalue(STRZERO(mnum_ped,6))
                                                                sr_getconnection():exec(ccomm,,.f.)
                                                                sr_getconnection():exec('COMMIT',,.f.)
                                                                EXIT
                                                        ENDIF
                                                ENDDO
                                                wvw_lclosewindow()
                                        ENDIF
                                        */
                                ENDIF
                        ENDIF
                ENDIF
        ENDIF
ENDDO
fimset()
wvw_lclosewindow()
RETURN NIL

**************************** f i m ******************************************
* VER LUCRO
******************
FUNCTION ver_lucro(mcod)
************************
LOCAL msele,morde
MEMVAR mp_lucro,msaldo_mer
msele := SELE()
morde := INDEXORD();IF(EMPTY(morde),morde := 0,morde)
****************
SELE('merc');ORDSETFOCUS(1)
GO TOP
****************
SEEK mcod
mp_lucro := mcons_merc[1,22]
msaldo_mer := mcons_merc[1,56]
SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
RETURN NIL
******************************* F I M *************************************************
* REPLACE NA DATA DA ULTIMA COMPRA FEITA POR ESTE FORNECEDOR
*************************************************************
FUNCTION repl_forn
***********************
LOCAL msele,morde
MEMVAR mcod_forn,mnum_ped,mchegada,mfornece
msele := SELE()
morde := INDEXORD()
IF EMPTY(morde)
        morde := 0
ENDIF
IF EMPTY(mcod_forn)
        RETURN .T.
ENDIF
/*
aret:={}
sr_getconnection():exec( "select sr_recno from sacmov where sacmov.documento = "+sr_cdbvalue(mtp_nota+mnota)+" AND sacmov.ent_sai = 'E' AND sacmov.cod_forn = "+sr_cdbvalue(STRZERO(mcod_forn,4)),,.t.,@aret)
setcor(1)
*************
IF LEN(aret) > 0
        atencao('Esta Nota ja foi processada')
        LOOP
ENDIF
*/
*************
SELE('forn');ORDSETFOCUS(1)
GO TOP
*************
SEEK STRZERO(mcod_forn,4)
IF ! FOUND()
        IF mnum_ped = 0
                atencao('Codigo Fornecedor nao Existe no Arquivo !!!')
                mcod_forn := 0
                RETURN .F.
        ENDIF
        ********************
        SELE('forn');ORDSETFOCUS(1)
        GO TOP
        ********************
        SEEK STRZERO(mcod_forn,4)
        IF ! FOUND()
                atencao('Codigo Fornecedor nao Existe no Arquivo !!!')
                mcod_forn := 0
                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                RETURN .F.
        ENDIF
ENDIF
sr_getconnection():exec("UPDATE sacforn SET ult_comp = "+sr_cdbvalue(mchegada) +" WHERE cod_forn = "+sr_cdbvalue(STRZERO(mcod_forn,4)),,.f.)
sr_getconnection():exec('COMMIT',,.f.)
IF mnum_ped > 0
        IF mfornece <> forn->razao
                ********************
                SELE('forn');ORDSETFOCUS(1)
                GO TOP
                ********************
                SEEK STRZERO(mcod_forn,4)
                IF ! FOUND()
                        atencao('Codigo Fornecedor nao Existe no Arquivo !!!')
                        mcod_forn := 0
                        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                        RETURN .F.
                ENDIF
        ENDIF
ENDIF
SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
RETURN .T.
******************************** f i m **********************************
* FUNCAO PARA GERAR DUPLICATAS
*****************************************
FUNCTION dup_pag
****************
LOCAL lba,cba,tel_dup,mdup1,mdup2,mdup3,mdup4,mdup5,mdup6,mdup7,mdup8,;
      mdup9,mdup10,mvlr1,mvlr2,mvlr3,mvlr4,mvlr5,mvlr6,mvlr7,mvlr8,mvlr9,mvlr10,;
      opcao,mtraco,mdoc_frete,mprn,mcod_trans,mn_dup1,mn_dup2,mn_dup3,mn_dup4,;
      mn_dup5,mn_dup6,mn_dup7,mn_dup8,mn_dup9,mn_dup10,op_dup,mtip_for,mlinha,;
      lin,mlin,mtp_pg:=' ',mobs := SPACE(60)

MEMVAR mcif,mdisp_aux,memissao,mcod_forn,mchegada,mavista,mdia1,mdia2,mdia3,;
       mdia4,mdia5,mdia6,mdia7,mdia8,mdia9,mdia10,mnota,mvlr_nota,mfornece

PRIVATE mvenc1,mvenc2,mvenc3,mvenc4,mvenc5,mbanco,mfornec,mtransp,mdata_frete,mextenso,;
        mvenc6,mvenc7,mvenc8,mvenc9,mvenc10,mtipo_imp,mimp_tipo:=0,marq:=SPACE(35),;
        marq := 'DUP_ENT.REL',mtipo_imp,mimp_tipo:=0

CLEAR GETS
IF mcif = 'X' .OR. ! EMPTY(mdisp_aux)
        lba := 16
        mdata_frete := memissao
ELSE
        lba := 13
ENDIF
cba := 85
op_tela(0,0,lba+4,cba," Inclusao de DUPLICATAS A PAGAR ")
mtraco = REPLI('-',80)
mtipo_imp := m_indiv[1,18]
WHILE .T.
********* VARIAVEIS DE IMPRESSAO *******************
        mtipo_imp := m_indiv[1,18]
****************************************************
        ****************
        //SELE('dupp');ORDSETFOCUS(1)
        ****************
        mtransp := SPACE(30)
        mprn := mtp_pg := SPACE(1)
        mdup1 := mdup2 := mdup3 := mdup4 := mdup5 := mdup6 := mdup7 :=;
        mdup8 := mdup9 := mdup10 := SPACE(10)
        mn_dup1 := mn_dup2 := mn_dup3 := mn_dup4 := mn_dup5 := ;
        mn_dup6 := mn_dup7 := mn_dup8 := mn_dup9 := mn_dup10 := SPACE(2)
        mvenc1 := mvenc2 := mvenc3 := mvenc4 := mvenc5 := ;
        mvenc6 := mvenc7 := mvenc8 := mvenc9 := mvenc10 := ctod("  /  /  ")
        mvlr1 := mvlr2 := mvlr3 := mvlr4 := mvlr5 := mvlr6 := mvlr7 := ;
        mvlr8 := mvlr9 := mvlr10 := ;
        mbanco := mcod_trans := 0
        mobs := SPACE(60)
        op_dup := SPACE(1)
        DEVPOS(1,1);DEVOUT('Fornecedor:')
        DEVPOS(1,49);DEVOUT('Emissao:')
        DEVPOS(3,1);DEVOUT('No.Duplicata1:')
        DEVPOS(3,29);DEVOUT('Vencimento:')
        DEVPOS(3,51);DEVOUT('Valor:')
        DEVPOS(4,1);DEVOUT('No.Duplicata2:')
        DEVPOS(4,29);DEVOUT('Vencimento:')
        DEVPOS(4,51);DEVOUT('Valor:')
        DEVPOS(5,1);DEVOUT('No.Duplicata3:')
        DEVPOS(5,29);DEVOUT('Vencimento:')
        DEVPOS(5,51);DEVOUT('Valor:')
        DEVPOS(6,1);DEVOUT('No.Duplicata4:')
        DEVPOS(6,29);DEVOUT('Vencimento:')
        DEVPOS(6,51);DEVOUT('Valor:')
        DEVPOS(7,1);DEVOUT('No.Duplicata5:')
        DEVPOS(7,29);DEVOUT('Vencimento:')
        DEVPOS(7,51);DEVOUT('Valor:')
        DEVPOS(8,1);DEVOUT('No.Duplicata6:')
        DEVPOS(8,29);DEVOUT('Vencimento:')
        DEVPOS(8,51);DEVOUT('Valor:')
        DEVPOS(9,1);DEVOUT('No.Duplicata7:')
        DEVPOS(9,29);DEVOUT('Vencimento:')
        DEVPOS(9,51);DEVOUT('Valor:')
        DEVPOS(10,1);DEVOUT('No.Duplicata8:')
        DEVPOS(10,29);DEVOUT('Vencimento:')
        DEVPOS(10,51);DEVOUT('Valor:')
        DEVPOS(11,1);DEVOUT('No.Duplicata9:')
        DEVPOS(11,29);DEVOUT('Vencimento:')
        DEVPOS(11,51);DEVOUT('Valor:')
        DEVPOS(12,1);DEVOUT('No.Duplicata10:')
        DEVPOS(12,29);DEVOUT('Vencimento:')
        DEVPOS(12,51);DEVOUT('Valor:')
        @ 13,1 TO 13,cba-1
        DEVPOS(14,1);DEVOUT('Tipo de Pagamento:')
        DEVPOS(15,1);DEVOUT('Observacao.......:')
        IF mcif = 'X' .OR. ! EMPTY(mdisp_aux)
                @ 16,1 TO 16,cba-1
                janela(16,0,' Duplicata do FRETE por fora da nota',,1)
                DEVPOS(17,1);DEVOUT('Cod.Transp.:')
                DEVPOS(18,1);DEVOUT('No.Duplicata:')
                DEVPOS(18,29);DEVOUT('Vencimento:')
                DEVPOS(18,51);DEVOUT('Valor:')
        ENDIF
        setcor(3)
        DEVPOS(1,13);DEVOUT(STRZERO(mcod_forn,4))
        DEVPOS(1,58);DEVOUT(mchegada)
        setcor(1)
        ent_forn(@mcod_forn,1,18)
        mtip_for := forn->tipo
        IF EMPTY(mavista) .AND. ! EMPTY(mdia1)
                mn_dup1 := mn_dup2 := mn_dup3 := mn_dup4 := mn_dup5 := ;
                mn_dup6 := mn_dup7 := mn_dup8 := mn_dup9 := mn_dup10 := 'DU'
                mdup1 := RTRIM(mnota)+SPACE(9-LEN(RTRIM(mnota)))
                IF ! EMPTY(mdia1) .AND. ! EMPTY(mdia2) .AND. ! EMPTY(mdia3) .AND.;
                   ! EMPTY(mdia4) .AND. ! EMPTY(mdia5) .AND. ! EMPTY(mdia6) .AND.;
                   ! EMPTY(mdia7) .AND. ! EMPTY(mdia8) .AND. ! EMPTY(mdia9) .AND.;
                   ! EMPTY(mdia10)
                        mdup2 := RTRIM(mnota)+'A'+SPACE(8-LEN(RTRIM(mnota)+'A'))
                        mdup3 := RTRIM(mnota)+'B'+SPACE(8-LEN(RTRIM(mnota)+'A'))
                        mdup4 := RTRIM(mnota)+'C'+SPACE(8-LEN(RTRIM(mnota)+'A'))
                        mdup5 := RTRIM(mnota)+'D'+SPACE(8-LEN(RTRIM(mnota)+'A'))
                        mdup6 := RTRIM(mnota)+'E'+SPACE(8-LEN(RTRIM(mnota)+'A'))
                        mdup7 := RTRIM(mnota)+'F'+SPACE(8-LEN(RTRIM(mnota)+'A'))
                        mdup8 := RTRIM(mnota)+'G'+SPACE(8-LEN(RTRIM(mnota)+'A'))
                        mdup9 := RTRIM(mnota)+'H'+SPACE(8-LEN(RTRIM(mnota)+'A'))
                        mdup10 := RTRIM(mnota)+'I'+SPACE(8-LEN(RTRIM(mnota)+'A'))
                        mvlr1 := mvlr2 := mvlr3 := mvlr4 := mvlr5 := ;
                        mvlr6 := mvlr7 := mvlr8 := mvlr9 := mvlr10:= mvlr_nota / 10
                        mvenc1 := memissao + VAL(mdia1)
                        mvenc2 := memissao + VAL(mdia2)
                        mvenc3 := memissao + VAL(mdia3)
                        mvenc4 := memissao + VAL(mdia4)
                        mvenc5 := memissao + VAL(mdia5)
                        mvenc6 := memissao + VAL(mdia6)
                        mvenc7 := memissao + VAL(mdia7)
                        mvenc8 := memissao + VAL(mdia8)
                        mvenc9 := memissao + VAL(mdia9)
                        mvenc10 := memissao + VAL(mdia10)
                ELSEIF ! EMPTY(mdia1) .AND. ! EMPTY(mdia2) .AND. ! EMPTY(mdia3) .AND.;
                       ! EMPTY(mdia4) .AND. ! EMPTY(mdia5) .AND. ! EMPTY(mdia6) .AND.;
                       ! EMPTY(mdia7) .AND. ! EMPTY(mdia8) .AND. ! EMPTY(mdia9)
                        mdup2 := RTRIM(mnota)+'A'+SPACE(8-LEN(RTRIM(mnota)+'A'))
                        mdup3 := RTRIM(mnota)+'B'+SPACE(8-LEN(RTRIM(mnota)+'A'))
                        mdup4 := RTRIM(mnota)+'C'+SPACE(8-LEN(RTRIM(mnota)+'A'))
                        mdup5 := RTRIM(mnota)+'D'+SPACE(8-LEN(RTRIM(mnota)+'A'))
                        mdup6 := RTRIM(mnota)+'E'+SPACE(8-LEN(RTRIM(mnota)+'A'))
                        mdup7 := RTRIM(mnota)+'F'+SPACE(8-LEN(RTRIM(mnota)+'A'))
                        mdup8 := RTRIM(mnota)+'G'+SPACE(8-LEN(RTRIM(mnota)+'A'))
                        mdup9 := RTRIM(mnota)+'H'+SPACE(8-LEN(RTRIM(mnota)+'A'))
                        mvlr1 := mvlr2 := mvlr3 := mvlr4 := mvlr5 := ;
                        mvlr6 := mvlr7 := mvlr8 := mvlr9 := mvlr_nota / 9
                        mvenc1 := memissao + VAL(mdia1)
                        mvenc2 := memissao + VAL(mdia2)
                        mvenc3 := memissao + VAL(mdia3)
                        mvenc4 := memissao + VAL(mdia4)
                        mvenc5 := memissao + VAL(mdia5)
                        mvenc6 := memissao + VAL(mdia6)
                        mvenc7 := memissao + VAL(mdia7)
                        mvenc8 := memissao + VAL(mdia8)
                        mvenc9 := memissao + VAL(mdia9)
                ELSEIF ! EMPTY(mdia1) .AND. ! EMPTY(mdia2) .AND. ! EMPTY(mdia3) .AND.;
                       ! EMPTY(mdia4) .AND. ! EMPTY(mdia5) .AND. ! EMPTY(mdia6) .AND.;
                       ! EMPTY(mdia7) .AND. ! EMPTY(mdia8)
                        mdup2 := RTRIM(mnota)+'A'+SPACE(8-LEN(RTRIM(mnota)+'A'))
                        mdup3 := RTRIM(mnota)+'B'+SPACE(8-LEN(RTRIM(mnota)+'A'))
                        mdup4 := RTRIM(mnota)+'C'+SPACE(8-LEN(RTRIM(mnota)+'A'))
                        mdup5 := RTRIM(mnota)+'D'+SPACE(8-LEN(RTRIM(mnota)+'A'))
                        mdup6 := RTRIM(mnota)+'E'+SPACE(8-LEN(RTRIM(mnota)+'A'))
                        mdup7 := RTRIM(mnota)+'F'+SPACE(8-LEN(RTRIM(mnota)+'A'))
                        mdup8 := RTRIM(mnota)+'G'+SPACE(8-LEN(RTRIM(mnota)+'A'))
                        mvlr1 := mvlr2 := mvlr3 := mvlr4 := mvlr5 := ;
                        mvlr6 := mvlr7 := mvlr8 := mvlr_nota / 8
                        mvenc1 := memissao + VAL(mdia1)
                        mvenc2 := memissao + VAL(mdia2)
                        mvenc3 := memissao + VAL(mdia3)
                        mvenc4 := memissao + VAL(mdia4)
                        mvenc5 := memissao + VAL(mdia5)
                        mvenc6 := memissao + VAL(mdia6)
                        mvenc7 := memissao + VAL(mdia7)
                        mvenc8 := memissao + VAL(mdia8)
                ELSEIF ! EMPTY(mdia1) .AND. ! EMPTY(mdia2) .AND. ! EMPTY(mdia3) .AND.;
                       ! EMPTY(mdia4) .AND. ! EMPTY(mdia5) .AND. ! EMPTY(mdia6) .AND.;
                       ! EMPTY(mdia7)
                        mdup2 := RTRIM(mnota)+'A'+SPACE(8-LEN(RTRIM(mnota)+'A'))
                        mdup3 := RTRIM(mnota)+'B'+SPACE(8-LEN(RTRIM(mnota)+'A'))
                        mdup4 := RTRIM(mnota)+'C'+SPACE(8-LEN(RTRIM(mnota)+'A'))
                        mdup5 := RTRIM(mnota)+'D'+SPACE(8-LEN(RTRIM(mnota)+'A'))
                        mdup6 := RTRIM(mnota)+'E'+SPACE(8-LEN(RTRIM(mnota)+'A'))
                        mdup7 := RTRIM(mnota)+'F'+SPACE(8-LEN(RTRIM(mnota)+'A'))
                        mvlr1 := mvlr2 := mvlr3 := mvlr4 := mvlr5 := ;
                        mvlr6 := mvlr7 := mvlr_nota / 7
                        mvenc1 := memissao + VAL(mdia1)
                        mvenc2 := memissao + VAL(mdia2)
                        mvenc3 := memissao + VAL(mdia3)
                        mvenc4 := memissao + VAL(mdia4)
                        mvenc5 := memissao + VAL(mdia5)
                        mvenc6 := memissao + VAL(mdia6)
                        mvenc7 := memissao + VAL(mdia7)
                ELSEIF ! EMPTY(mdia1) .AND. ! EMPTY(mdia2) .AND. ! EMPTY(mdia3) .AND.;
                       ! EMPTY(mdia4) .AND. ! EMPTY(mdia5) .AND. ! EMPTY(mdia6)
                        mdup2 := RTRIM(mnota)+'A'+SPACE(8-LEN(RTRIM(mnota)+'A'))
                        mdup3 := RTRIM(mnota)+'B'+SPACE(8-LEN(RTRIM(mnota)+'A'))
                        mdup4 := RTRIM(mnota)+'C'+SPACE(8-LEN(RTRIM(mnota)+'A'))
                        mdup5 := RTRIM(mnota)+'D'+SPACE(8-LEN(RTRIM(mnota)+'A'))
                        mdup6 := RTRIM(mnota)+'E'+SPACE(8-LEN(RTRIM(mnota)+'A'))
                        mvlr1 := mvlr2 := mvlr3 := mvlr4 := mvlr5 := ;
                        mvlr6 := mvlr_nota / 6
                        mvenc1 := memissao + VAL(mdia1)
                        mvenc2 := memissao + VAL(mdia2)
                        mvenc3 := memissao + VAL(mdia3)
                        mvenc4 := memissao + VAL(mdia4)
                        mvenc5 := memissao + VAL(mdia5)
                        mvenc6 := memissao + VAL(mdia6)
                ELSEIF ! EMPTY(mdia1) .AND. ! EMPTY(mdia2) .AND. ! EMPTY(mdia3) .AND.;
                       ! EMPTY(mdia4) .AND. ! EMPTY(mdia5)
                        mdup2 := RTRIM(mnota)+'A'+SPACE(8-LEN(RTRIM(mnota)+'A'))
                        mdup3 := RTRIM(mnota)+'B'+SPACE(8-LEN(RTRIM(mnota)+'A'))
                        mdup4 := RTRIM(mnota)+'C'+SPACE(8-LEN(RTRIM(mnota)+'A'))
                        mdup5 := RTRIM(mnota)+'D'+SPACE(8-LEN(RTRIM(mnota)+'A'))
                        mvlr1 := mvlr2 := mvlr3 := mvlr4 := mvlr5 :=  mvlr_nota / 5
                        mvenc1 := memissao + VAL(mdia1)
                        mvenc2 := memissao + VAL(mdia2)
                        mvenc3 := memissao + VAL(mdia3)
                        mvenc4 := memissao + VAL(mdia4)
                        mvenc5 := memissao + VAL(mdia5)
                ELSEIF ! EMPTY(mdia1) .AND. ! EMPTY(mdia2) .AND. ! EMPTY(mdia3) .AND.;
                       ! EMPTY(mdia4)
                        mdup2 := RTRIM(mnota)+'A'+SPACE(8-LEN(RTRIM(mnota)+'A'))
                        mdup3 := RTRIM(mnota)+'B'+SPACE(8-LEN(RTRIM(mnota)+'A'))
                        mdup4 := RTRIM(mnota)+'C'+SPACE(8-LEN(RTRIM(mnota)+'A'))
                        mvlr1 := mvlr2 := mvlr3 := mvlr4 := mvlr_nota / 4
                        mvenc1 := memissao + VAL(mdia1)
                        mvenc2 := memissao + VAL(mdia2)
                        mvenc3 := memissao + VAL(mdia3)
                        mvenc4 := memissao + VAL(mdia4)
                ELSEIF ! EMPTY(mdia1) .AND. ! EMPTY(mdia2) .AND. ! EMPTY(mdia3)
                        mdup2 := RTRIM(mnota)+'A'+SPACE(8-LEN(RTRIM(mnota)+'A'))
                        mdup3 := RTRIM(mnota)+'B'+SPACE(8-LEN(RTRIM(mnota)+'A'))
                        mvlr1 := mvlr2 := mvlr3 := mvlr_nota / 3
                        mvenc1 := memissao + VAL(mdia1)
                        mvenc2 := memissao + VAL(mdia2)
                        mvenc3 := memissao + VAL(mdia3)
                ELSEIF ! EMPTY(mdia1) .AND. ! EMPTY(mdia2)
                        mdup2 := RTRIM(mnota)+'A'+SPACE(8-LEN(RTRIM(mnota)+'A'))
                        mvlr1 := mvlr2 := mvlr_nota / 2
                        mvenc1 := memissao + VAL(mdia1)
                        mvenc2 := memissao + VAL(mdia2)
                ELSEIF ! EMPTY(mdia1)
                        mvlr1 := mvlr_nota
                        mvenc1 := memissao + VAL(mdia1)
                ENDIF
                @ 3,15 GET mn_dup1 PICT '@!' VALID IF(EMPTY(mn_dup1),.F.,.T.)
                @ 3,COL()+1 GET mdup1 PICT '@!'
                @ 3,41 GET mvenc1 VALID vencim(mvenc1,'T',mdup1)
                @ 3,58 GET mvlr1 PICTURE "99,999,999.99"
                @ 4,15 GET mn_dup2 PICT '@!' VALID IF(EMPTY(mn_dup2),.F.,.T.)
                @ 4,COL()+1 GET mdup2 PICT '@!'
                @ 4,41 GET mvenc2 VALID vencim(mvenc2,'T',mdup2)
                @ 4,58 GET mvlr2 PICTURE "99,999,999.99"
                @ 5,15 GET mn_dup3 PICT '@!' VALID IF(EMPTY(mn_dup3),.F.,.T.)
                @ 5,COL()+1 GET mdup3 PICT '@!'
                @ 5,41 GET mvenc3 VALID vencim(mvenc3,'T',mdup3)
                @ 5,58 GET mvlr3 PICTURE "99,999,999.99"
                @ 6,15 GET mn_dup4 PICT '@!' VALID IF(EMPTY(mn_dup4),.F.,.T.)
                @ 6,COL()+1 GET mdup4 PICT '@!'
                @ 6,41 GET mvenc4 VALID vencim(mvenc4,'T',mdup4)
                @ 6,58 GET mvlr4 PICTURE "99,999,999.99"
                @ 7,15 GET mn_dup5 PICT '@!' VALID IF(EMPTY(mn_dup5),.F.,.T.)
                @ 7,COL()+1 GET mdup5 PICT '@!'
                @ 7,41 GET mvenc5 VALID vencim(mvenc5,'T',mdup5)
                @ 7,58 GET mvlr5 PICTURE "99,999,999.99"
                @ 8,15 GET mn_dup6 PICT '@!' VALID IF(EMPTY(mn_dup6),.F.,.T.)
                @ 8,COL()+1 GET mdup6 PICT '@!'
                @ 8,41 GET mvenc6 VALID vencim(mvenc6,'T',mdup6)
                @ 8,58 GET mvlr6 PICTURE "99,999,999.99"
                @ 9,15 GET mn_dup7 PICT '@!' VALID IF(EMPTY(mn_dup7),.F.,.T.)
                @ 9,COL()+1 GET mdup7 PICT '@!'
                @ 9,41 GET mvenc7 VALID vencim(mvenc7,'T',mdup7)
                @ 9,58 GET mvlr7 PICTURE "99,999,999.99"
                @ 10,15 GET mn_dup8 PICT '@!' VALID IF(EMPTY(mn_dup8),.F.,.T.)
                @ 10,COL()+1 GET mdup8 PICT '@!'
                @ 10,41 GET mvenc8 VALID vencim(mvenc8,'T',mdup8)
                @ 10,58 GET mvlr8 PICTURE "99,999,999.99"
                @ 11,15 GET mn_dup9 PICT '@!' VALID IF(EMPTY(mn_dup9),.F.,.T.)
                @ 11,COL()+1 GET mdup9 PICT '@!'
                @ 11,41 GET mvenc9 VALID vencim(mvenc9,'T',mdup9)
                @ 11,58 GET mvlr9 PICTURE "99,999,999.99"
                @ 12,15 GET mn_dup10 PICT '@!' VALID IF(EMPTY(mn_dup10),.F.,.T.)
                @ 12,COL()+1 GET mdup10 PICT '@!'
                @ 12,41 GET mvenc10 VALID vencim(mvenc10,'T',mdup10)
                @ 12,58 GET mvlr10 PICTURE "99,999,999.99"
                READ
                IF LASTKEY()=27
                        RELEASE mvenc1,mvenc2,mvenc3,mvenc4,mvenc5,mbanco,mfornec,mtransp,mdata_frete
                        wvw_lclosewindow()
                        RETURN NIL
                ENDIF
                @ 14,20 GET mtp_pg PICT '@!' WHEN men_get(2,38,'Deixar em branco ou preencha com o tipo de pagamento que desajar') VALID lim_get()
                @ 15,20 GET mobs
                READ
                IF LASTKEY()=27
                        RELEASE mvenc1,mvenc2,mvenc3,mvenc4,mvenc5,mbanco,mfornec,mtransp,mdata_frete
                        wvw_lclosewindow()
                        RETURN NIL
                ENDIF
                opcao := op_simnao('S','Confirma os Dados:')
        ELSEIF ! EMPTY(mavista)
                opcao := op_simnao('S','Confirma a Inclussao da DUPLICATA AVISTA:')
        ENDIF
        IF opcao = 'N';LOOP;ENDIF
        IF mcif = 'X' .OR. ! EMPTY(mdisp_aux)
                WHILE .T.
                        op_dup := op_simnao('S','Deseja gerar duplicata do frete [S/n]:')
                        IF op_dup = 'N';EXIT;ENDIF
                        ****************
                        SELE('forn');ORDSETFOCUS(1)
                        ****************
                        mdoc_frete := mnota
                        @ 17,15 GET mcod_trans PICT '9999' VALID v_fornece(mcod_trans,14,20)
                        @ 18,15 GET mdoc_frete PICT '@!'
                        @ 18,41 GET mdata_frete
                        @ 18,58 GET mdisp_aux PICTURE "99,999,999.99"
                        READ
                        IF LASTKEY() = 27;LOOP;ENDIF
                        opcao := op_simnao('S','Confirma os dados da duplicata do frete [S/n]:')
                        IF opcao = 'N';LOOP;ENDIF
                        EXIT
                ENDDO
        ENDIF
        IF LASTKEY()=27;LOOP;ENDIF
        mprn := op_simnao('S','Deseja imprimir as DUPLICATA [S/n]:')
        IF mvlr_nota < mvlr1+mvlr2+mvlr3+mvlr4+mvlr5+mvlr6+mvlr7+mvlr8+mvlr9+mvlr10
                opcao := op_simnao('N','A soma duplicatas esta maior que a nota, Deseja Confirmar os dados [s/N]:')
                IF LASTKEY() = 27 .OR. opcao = 'N';LOOP;ENDIF
        ENDIF

        IF mprn = 'S'
                IF ! imp_arq(marq,'R')
                        LOOP
                ENDIF
        ENDIF
        IF mavista = 'X'
                mensagem('Incluindo Duplicata Avista...')
                sr_getconnection():exec('INSERT INTO sacdupp '+;
                                '(empresa ,'+;
                                'tipo     ,'+;
                                'duplicata,'+;
                                'tip_for  ,'+;
                                'fornec   ,'+;
                                'cliente  ,'+;
                                'emissao  ,'+;
                                'venc     ,'+;
                                'banco    ,'+;
                                'valor    ,'+;
                                'datpag   ,'+;
                                'vlpago   ,'+;
                                'pago     ,'+;
                                'num_ped  ,'+;
                                'operador ,'+;
                                'tp_pg    ,'+;
                                'obs      ,'+;
                                'SR_DELETED )'+;
                                ' VALUES ('+;
                                sr_cdbvalue(mcodempresa         )+','+; //1
                                sr_cdbvalue('DU'                )+','+; //2
                                sr_cdbvalue(mnota               )+','+; //3
                                sr_cdbvalue(mtip_for            )+','+; //4
                                sr_cdbvalue(STRZERO(mcod_forn,4))+','+; //5
                                sr_cdbvalue(mfornece            )+','+; //6
                                sr_cdbvalue(memissao            )+','+; //7
                                sr_cdbvalue(memissao            )+','+; //8
                                sr_cdbvalue(STRZERO(mbanco,3)   )+','+;//9
                                sr_cdbvalue(mvlr_nota           )+','+;//10
                                sr_cdbvalue(memissao            )+','+; //11
                                sr_cdbvalue(mvlr_nota           )+','+;//12
                                sr_cdbvalue("B"                 )+','+;//13
                                sr_cdbvalue(mnota               )+','+;//14
                                sr_cdbvalue(cod_operado         )+','+;//21
                                sr_cdbvalue(mtp_pg              )+','+;//22
                                sr_cdbvalue(mobs                )+','+;//23
                                sr_cdbvalue(' ')+')',,.f.)
                IF mprn = 'S'
                        imprt(mtipo_imp,'E')
                        pitalico(.T.)
                        DEVPOS(PROW(),00);DEVOUT(memp_resa)
                        pitalico(.F.)
                        imprt(mtipo_imp,'N',1)
                        DEVPOS(PROW(),00);DEVOUT(mend_firm)
                        DEVPOS(PROW()+1,00);DEVOUT(mcid_firm)
                        DEVPOS(PROW()+1,00);DEVOUT('Fone: '+mfone_firm)
                        DEVPOS(PROW()+1,00);DEVOUT('Inscr. '+minsc_firm+'   C.G.C.: '+mcgc_firm)
                        @ PROW()+1,00 SAY mtraco
                        @ PROW()+1,00 SAY ' '
                        @ PROW(),00 SAY 'Fornecedor:'
                        @ PROW(),PCOL()+1 SAY STRZERO(mcod_forn,4)
                        @ PROW(),PCOL()+1 SAY mfornece
                        @ PROW()+1,00 SAY mtraco
                        imprt(mtipo_imp,'E',1)
                        pitalico(.T.)
                        @ PROW(),00 SAY 'DUPLICATA No.: DU'+mnota
                        @ PROW()+1,00 SAY 'No.da Nota fiscal: '+mnota
                        pitalico(.F.)
                        imprt(mtipo_imp,'N')
                        @ PROW()+1,00 SAY mtraco
                        @ PROW()+1,00 SAY 'Emissao...:'
                        @ PROW(),12 SAY memissao
                        @ PROW()+1,00 SAY 'Vencimento:'
                        @ PROW(),12 SAY memissao
                        @ PROW()+1,00 SAY 'Tipo de Pagamento: A V I S T A'
                        @ PROW()+1,00 SAY mtraco
                        DEVPOS(PROW()+1,00);DEVOUT(PADC('Valor R$: ('+LTRIM(TRANSFORM(mvlr_nota,'99,999,999.99'))+')',60))
                        DEVPOS(PROW(),00);DEVOUT(PADC('Valor R$: ('+LTRIM(TRANSFORM(mvlr_nota,'99,999,999.99'))+')',60))
*                       mextenso:= '('+extenso(mvlr_nota,.T.)+')'
                        mextenso:= '('+RTRIM(EXT(mvlr_nota))+')'
                        mlinha := MLCOUNT(mextenso,80)
                        FOR lin = 1 TO mlinha
                                mlin := MEMOLINE(mextenso,80,lin,,10)
                                DEVPOS(PROW()+1,00);DEVOUT(PADR(RTRIM(mlin),80))
                        NEXT
                        @ PROW()+1,00 SAY mtraco
                        EJECT
                        SETPRC(00,00)
                ENDIF
        ENDIF
        mensagem('Incluindo e Imprimindo as Duplicata...')
        IF ! EMPTY(mvlr1) .AND. ! EMPTY(mdup1)
                sr_getconnection():exec('INSERT INTO sacdupp '+;
                                '(empresa ,'+;
                                'tipo      ,'+;
                                'duplicata ,'+;
                                'tip_for   ,'+;
                                'fornec    ,'+;
                                'cliente   ,'+;
                                'emissao   ,'+;
                                'venc      ,'+;
                                'banco     ,'+;
                                'valor     ,'+;
                                'pago      ,'+;
                                'num_ped   ,'+;
                                'operador  ,'+;
                                'tp_pg     ,'+;
                                'obs       ,'+;
                                'SR_DELETED )'+;
                                ' VALUES ('+;
                                sr_cdbvalue(mcodempresa         )+','+; //1
                                sr_cdbvalue(mn_dup1             )+','+; //2
                                sr_cdbvalue(mdup1               )+','+; //3
                                sr_cdbvalue(mtip_for            )+','+; //4
                                sr_cdbvalue(STRZERO(mcod_forn,4))+','+; //5
                                sr_cdbvalue(mfornece            )+','+; //6
                                sr_cdbvalue(memissao            )+','+; //7
                                sr_cdbvalue(mvenc1              )+','+; //8
                                sr_cdbvalue(STRZERO(mbanco,3)   )+','+; //9
                                sr_cdbvalue(mvlr1               )+','+; //10
                                sr_cdbvalue(" "                 )+','+; //11
                                sr_cdbvalue(mnota               )+','+; //12
                                sr_cdbvalue(cod_operado         )+','+; //13
                                sr_cdbvalue(mtp_pg              )+','+; //14
                                sr_cdbvalue(mobs                )+','+; //15
                                sr_cdbvalue(' ')+')',,.f.)
                IF mprn = 'S'
                        imprt(mtipo_imp,'E')
                        pitalico(.T.)
                        DEVPOS(PROW(),00);DEVOUT(memp_resa)
                        pitalico(.F.)
                        imprt(mtipo_imp,'N',1)
                        DEVPOS(PROW(),00);DEVOUT(mend_firm)
                        DEVPOS(PROW()+1,00);DEVOUT(mcid_firm)
                        DEVPOS(PROW()+1,00);DEVOUT('Fone: '+mfone_firm)
                        DEVPOS(PROW()+1,00);DEVOUT('Inscr. '+minsc_firm+'   C.G.C.: '+mcgc_firm)
                        @ PROW()+1,00 SAY mtraco
                        @ PROW()+1,00 SAY ' '
                        @ PROW(),00 SAY 'Fornecedor:'
                        @ PROW(),PCOL()+1 SAY STRZERO(mcod_forn,4)
                        @ PROW(),PCOL()+1 SAY mfornece
                        @ PROW()+1,00 SAY mtraco
                        imprt(mtipo_imp,'E',1)
                        pitalico(.T.)
                        @ PROW(),00 SAY 'DUPLICATA No.: '+mn_dup1+mdup1
                        @ PROW()+1,00 SAY 'No.da Nota fiscal: '+mnota
                        pitalico(.F.)
                        imprt(mtipo_imp,'N')
                        @ PROW()+1,00 SAY mtraco
                        @ PROW()+1,00 SAY 'Emissao...:'
                        @ PROW(),12 SAY memissao
                        @ PROW()+1,00 SAY 'Vencimento:'
                        @ PROW(),12 SAY mvenc1
                        @ PROW()+1,00 SAY 'Tipo de Pagamento: A P R A Z O'
                        @ PROW()+1,00 SAY mtraco
                        DEVPOS(PROW()+1,00);DEVOUT(PADC('Valor R$: ('+LTRIM(TRANSFORM(mvlr1,'99,999,999.99'))+')',60))
                        DEVPOS(PROW(),00);DEVOUT(PADC('Valor R$: ('+LTRIM(TRANSFORM(mvlr1,'99,999,999.99'))+')',60))
*                       mextenso:= '('+extenso(mvlr1,.T.)+')'
                        mextenso:= '('+RTRIM(EXT(mvlr1))+')'
                        mlinha := MLCOUNT(mextenso,80)
                        FOR lin = 1 TO mlinha
                                mlin := MEMOLINE(mextenso,80,lin,,10)
                                DEVPOS(PROW()+1,00);DEVOUT(PADR(RTRIM(mlin),80))
                        NEXT
                        @ PROW()+1,00 SAY mtraco
                        IF EMPTY(mdup2)
                                EJECT
                        ELSE
                                @ PROW()+3,00 SAY mtraco
                        ENDIF
                        SETPRC(00,00)
                ENDIF
        ENDIF
        IF ! EMPTY(mvlr2) .AND. ! EMPTY(mdup2)
                sr_getconnection():exec('INSERT INTO sacdupp '+;
                                '(empresa ,'+;
                                'tipo      ,'+;
                                'duplicata ,'+;
                                'tip_for   ,'+;
                                'fornec    ,'+;
                                'cliente   ,'+;
                                'emissao   ,'+;
                                'venc      ,'+;
                                'banco     ,'+;
                                'valor     ,'+;
                                'pago      ,'+;
                                'num_ped   ,'+;
                                'operador  ,'+;
                                'tp_pg     ,'+;
                                'obs       ,'+;
                                'SR_DELETED )'+;
                                ' VALUES ('+;
                                sr_cdbvalue(mcodempresa         )+','+; //1
                                sr_cdbvalue(mn_dup2             )+','+; //2
                                sr_cdbvalue(mdup2               )+','+; //3
                                sr_cdbvalue(mtip_for            )+','+; //4
                                sr_cdbvalue(STRZERO(mcod_forn,4))+','+; //5
                                sr_cdbvalue(mfornece            )+','+; //6
                                sr_cdbvalue(memissao            )+','+; //7
                                sr_cdbvalue(mvenc2              )+','+; //8
                                sr_cdbvalue(STRZERO(mbanco,3)   )+','+; //9
                                sr_cdbvalue(mvlr2               )+','+; //10
                                sr_cdbvalue(" "                 )+','+; //11
                                sr_cdbvalue(mnota               )+','+; //12
                                sr_cdbvalue(cod_operado         )+','+; //13
                                sr_cdbvalue(mtp_pg              )+','+; //14
                                sr_cdbvalue(mobs                )+','+; //15
                                sr_cdbvalue(' ')+')',,.f.)
                IF mprn = 'S'
                        imprt(mtipo_imp,'E')
                        pitalico(.T.)
                        DEVPOS(PROW(),00);DEVOUT(memp_resa)
                        pitalico(.F.)
                        imprt(mtipo_imp,'N',1)
                        DEVPOS(PROW(),00);DEVOUT(mend_firm)
                        DEVPOS(PROW()+1,00);DEVOUT(mcid_firm)
                        DEVPOS(PROW()+1,00);DEVOUT('Fone: '+mfone_firm)
                        DEVPOS(PROW()+1,00);DEVOUT('Inscr. '+minsc_firm+'   C.G.C.: '+mcgc_firm)
                        @ PROW()+1,00 SAY mtraco
                        @ PROW()+1,00 SAY ' '
                        @ PROW(),00 SAY 'Fornecedor:'
                        @ PROW(),PCOL()+1 SAY STRZERO(mcod_forn,4)
                        @ PROW(),PCOL()+1 SAY mfornece
                        @ PROW()+1,00 SAY mtraco
                        imprt(mtipo_imp,'E',1)
                        pitalico(.T.)
                        @ PROW(),00 SAY 'DUPLICATA No.: '+mn_dup2+mdup2
                        @ PROW()+1,00 SAY 'No.da Nota fiscal: '+mnota
                        pitalico(.F.)
                        imprt(mtipo_imp,'N')
                        @ PROW()+1,00 SAY mtraco
                        @ PROW()+1,00 SAY 'Emissao...:'
                        @ PROW(),12 SAY memissao
                        @ PROW()+1,00 SAY 'Vencimento:'
                        @ PROW(),12 SAY mvenc2
                        @ PROW()+1,00 SAY 'Tipo de Pagamento: A P R A Z O'
                        @ PROW()+1,00 SAY mtraco
                        DEVPOS(PROW()+1,00);DEVOUT(PADC('Valor R$: ('+LTRIM(TRANSFORM(mvlr2,'99,999,999.99'))+')',60))
                        DEVPOS(PROW(),00);DEVOUT(PADC('Valor R$: ('+LTRIM(TRANSFORM(mvlr2,'99,999,999.99'))+')',60))
*                       mextenso:= '('+extenso(mvlr2,.T.)+')'
                        mextenso:= '('+RTRIM(EXT(mvlr2))+')'
                        mlinha := MLCOUNT(mextenso,80)
                        FOR lin = 1 TO mlinha
                                mlin := MEMOLINE(mextenso,80,lin,,10)
                                DEVPOS(PROW()+1,00);DEVOUT(PADR(RTRIM(mlin),80))
                        NEXT
                        @ PROW()+1,00 SAY mtraco
                        IF EMPTY(mdup3)
                                EJECT
                        ELSE
                                @ PROW()+3,00 SAY mtraco
                        ENDIF
                        SETPRC(00,00)
                ENDIF
        ENDIF
        IF ! EMPTY(mvlr3) .AND. ! EMPTY(mdup3)
                sr_getconnection():exec('INSERT INTO sacdupp '+;
                                '(empresa ,'+;
                                'tipo      ,'+;
                                'duplicata ,'+;
                                'tip_for   ,'+;
                                'fornec    ,'+;
                                'cliente   ,'+;
                                'emissao   ,'+;
                                'venc      ,'+;
                                'banco     ,'+;
                                'valor     ,'+;
                                'pago      ,'+;
                                'num_ped   ,'+;
                                'operador  ,'+;
                                'tp_pg     ,'+;
                                'obs       ,'+;
                                'SR_DELETED )'+;
                                ' VALUES ('+;
                                sr_cdbvalue(mcodempresa         )+','+; //1
                                sr_cdbvalue(mn_dup3             )+','+; //2
                                sr_cdbvalue(mdup3               )+','+; //3
                                sr_cdbvalue(mtip_for            )+','+; //4
                                sr_cdbvalue(STRZERO(mcod_forn,4))+','+; //5
                                sr_cdbvalue(mfornece            )+','+; //6
                                sr_cdbvalue(memissao            )+','+; //7
                                sr_cdbvalue(mvenc3              )+','+; //8
                                sr_cdbvalue(STRZERO(mbanco,3)   )+','+; //9
                                sr_cdbvalue(mvlr3               )+','+; //10
                                sr_cdbvalue(" "                 )+','+; //11
                                sr_cdbvalue(mnota               )+','+; //12
                                sr_cdbvalue(cod_operado         )+','+; //13
                                sr_cdbvalue(mtp_pg              )+','+; //14
                                sr_cdbvalue(mobs                )+','+; //15
                                sr_cdbvalue(' ')+')',,.f.)
                IF mprn = 'S'
                        imprt(mtipo_imp,'E')
                        pitalico(.T.)
                        DEVPOS(PROW(),00);DEVOUT(memp_resa)
                        pitalico(.F.)
                        imprt(mtipo_imp,'N',1)
                        DEVPOS(PROW(),00);DEVOUT(mend_firm)
                        DEVPOS(PROW()+1,00);DEVOUT(mcid_firm)
                        DEVPOS(PROW()+1,00);DEVOUT('Fone: '+mfone_firm)
                        DEVPOS(PROW()+1,00);DEVOUT('Inscr. '+minsc_firm+'   C.G.C.: '+mcgc_firm)
                        @ PROW()+1,00 SAY mtraco
                        @ PROW()+1,00 SAY ' '
                        @ PROW(),00 SAY 'Fornecedor:'
                        @ PROW(),PCOL()+1 SAY STRZERO(mcod_forn,4)
                        @ PROW(),PCOL()+1 SAY mfornece
                        @ PROW()+1,00 SAY mtraco
                        imprt(mtipo_imp,'E',1)
                        pitalico(.T.)
                        @ PROW(),00 SAY 'DUPLICATA No.: '+mn_dup3+mdup3
                        @ PROW()+1,00 SAY 'No.da Nota fiscal: '+mnota
                        pitalico(.F.)
                        imprt(mtipo_imp,'N')
                        @ PROW()+1,00 SAY mtraco
                        @ PROW()+1,00 SAY 'Emissao...:'
                        @ PROW(),12 SAY memissao
                        @ PROW()+1,00 SAY 'Vencimento:'
                        @ PROW(),12 SAY mvenc3
                        @ PROW()+1,00 SAY 'Tipo de Pagamento: A P R A Z O'
                        @ PROW()+1,00 SAY mtraco
                        DEVPOS(PROW()+1,00);DEVOUT(PADC('Valor R$: ('+LTRIM(TRANSFORM(mvlr3,'99,999,999.99'))+')',60))
                        DEVPOS(PROW(),00);DEVOUT(PADC('Valor R$: ('+LTRIM(TRANSFORM(mvlr3,'99,999,999.99'))+')',60))
*                       mextenso:= '('+extenso(mvlr3,.T.)+')'
                        mextenso:= '('+RTRIM(EXT(mvlr3))+')'
                        mlinha := MLCOUNT(mextenso,80)
                        FOR lin = 1 TO mlinha
                                mlin := MEMOLINE(mextenso,80,lin,,10)
                                DEVPOS(PROW()+1,00);DEVOUT(PADR(RTRIM(mlin),80))
                        NEXT
                        @ PROW()+1,00 SAY mtraco
                        IF EMPTY(mdup4)
                                EJECT
                        ELSE
                                @ PROW()+3,00 SAY mtraco
                        ENDIF
                        SETPRC(00,00)
                ENDIF
        ENDIF
        IF ! EMPTY(mvlr4) .AND. ! EMPTY(mdup4)
                sr_getconnection():exec('INSERT INTO sacdupp '+;
                                '(empresa ,'+;
                                'tipo      ,'+;
                                'duplicata ,'+;
                                'tip_for   ,'+;
                                'fornec    ,'+;
                                'cliente   ,'+;
                                'emissao   ,'+;
                                'venc      ,'+;
                                'banco     ,'+;
                                'valor     ,'+;
                                'pago      ,'+;
                                'num_ped   ,'+;
                                'operador  ,'+;
                                'tp_pg     ,'+;
                                'obs       ,'+;
                                'SR_DELETED )'+;
                                ' VALUES ('+;
                                sr_cdbvalue(mcodempresa         )+','+; //1
                                sr_cdbvalue(mn_dup4             )+','+; //2
                                sr_cdbvalue(mdup4               )+','+; //3
                                sr_cdbvalue(mtip_for            )+','+; //4
                                sr_cdbvalue(STRZERO(mcod_forn,4))+','+; //5
                                sr_cdbvalue(mfornece            )+','+; //6
                                sr_cdbvalue(memissao            )+','+; //7
                                sr_cdbvalue(mvenc4              )+','+; //8
                                sr_cdbvalue(STRZERO(mbanco,3)   )+','+; //9
                                sr_cdbvalue(mvlr4               )+','+; //10
                                sr_cdbvalue(" "                 )+','+; //11
                                sr_cdbvalue(mnota               )+','+; //12
                                sr_cdbvalue(cod_operado         )+','+; //13
                                sr_cdbvalue(mtp_pg              )+','+; //14
                                sr_cdbvalue(mobs                )+','+; //15
                                sr_cdbvalue(' ')+')',,.f.)
                IF mprn = 'S'
                        imprt(mtipo_imp,'E')
                        pitalico(.T.)
                        DEVPOS(PROW(),00);DEVOUT(memp_resa)
                        pitalico(.F.)
                        imprt(mtipo_imp,'N',1)
                        DEVPOS(PROW(),00);DEVOUT(mend_firm)
                        DEVPOS(PROW()+1,00);DEVOUT(mcid_firm)
                        DEVPOS(PROW()+1,00);DEVOUT('Fone: '+mfone_firm)
                        DEVPOS(PROW()+1,00);DEVOUT('Inscr. '+minsc_firm+'   C.G.C.: '+mcgc_firm)
                        @ PROW()+1,00 SAY mtraco
                        @ PROW()+1,00 SAY ' '
                        @ PROW(),00 SAY 'Fornecedor:'
                        @ PROW(),PCOL()+1 SAY STRZERO(mcod_forn,4)
                        @ PROW(),PCOL()+1 SAY mfornece
                        @ PROW()+1,00 SAY mtraco
                        imprt(mtipo_imp,'E',1)
                        pitalico(.T.)
                        @ PROW(),00 SAY 'DUPLICATA No.: '+mn_dup4+mdup4
                        @ PROW()+1,00 SAY 'No.da Nota fiscal: '+mnota
                        pitalico(.F.)
                        imprt(mtipo_imp,'N')
                        @ PROW()+1,00 SAY mtraco
                        @ PROW()+1,00 SAY 'Emissao...:'
                        @ PROW(),12 SAY memissao
                        @ PROW()+1,00 SAY 'Vencimento:'
                        @ PROW(),12 SAY mvenc4
                        @ PROW()+1,00 SAY 'Tipo de Pagamento: A P R A Z O'
                        @ PROW()+1,00 SAY mtraco
                        DEVPOS(PROW()+1,00);DEVOUT(PADC('Valor R$: ('+LTRIM(TRANSFORM(mvlr4,'99,999,999.99'))+')',60))
                        DEVPOS(PROW(),00);DEVOUT(PADC('Valor R$: ('+LTRIM(TRANSFORM(mvlr4,'99,999,999.99'))+')',60))
*                       mextenso:= '('+extenso(mvlr4,.T.)+')'
                        mextenso:= '('+RTRIM(EXT(mvlr4))+')'
                        mlinha := MLCOUNT(mextenso,80)
                        FOR lin = 1 TO mlinha
                                mlin := MEMOLINE(mextenso,80,lin,,10)
                                DEVPOS(PROW()+1,00);DEVOUT(PADR(RTRIM(mlin),80))
                        NEXT
                        @ PROW()+1,00 SAY mtraco
                        IF EMPTY(mdup5)
                                EJECT
                        ELSE
                                @ PROW()+3,00 SAY mtraco
                        ENDIF
                        SETPRC(00,00)
                ENDIF
        ENDIF
        IF ! EMPTY(mvlr5) .AND. ! EMPTY(mdup5)
                sr_getconnection():exec('INSERT INTO sacdupp '+;
                                '(empresa ,'+;
                                'tipo      ,'+;
                                'duplicata ,'+;
                                'tip_for   ,'+;
                                'fornec    ,'+;
                                'cliente   ,'+;
                                'emissao   ,'+;
                                'venc      ,'+;
                                'banco     ,'+;
                                'valor     ,'+;
                                'pago      ,'+;
                                'num_ped   ,'+;
                                'operador  ,'+;
                                'tp_pg     ,'+;
                                'obs       ,'+;
                                'SR_DELETED )'+;
                                ' VALUES ('+;
                                sr_cdbvalue(mcodempresa         )+','+; //1
                                sr_cdbvalue(mn_dup5             )+','+; //2
                                sr_cdbvalue(mdup5               )+','+; //3
                                sr_cdbvalue(mtip_for            )+','+; //4
                                sr_cdbvalue(STRZERO(mcod_forn,4))+','+; //5
                                sr_cdbvalue(mfornece            )+','+; //6
                                sr_cdbvalue(memissao            )+','+; //7
                                sr_cdbvalue(mvenc5              )+','+; //8
                                sr_cdbvalue(STRZERO(mbanco,3)   )+','+; //9
                                sr_cdbvalue(mvlr5               )+','+; //10
                                sr_cdbvalue(" "                 )+','+; //11
                                sr_cdbvalue(mnota               )+','+; //12
                                sr_cdbvalue(cod_operado         )+','+; //13
                                sr_cdbvalue(mtp_pg              )+','+; //14
                                sr_cdbvalue(mobs                )+','+; //15
                                sr_cdbvalue(' ')+')',,.f.)
                IF mprn = 'S'
                        imprt(mtipo_imp,'E')
                        pitalico(.T.)
                        DEVPOS(PROW(),00);DEVOUT(memp_resa)
                        pitalico(.F.)
                        imprt(mtipo_imp,'N',1)
                        DEVPOS(PROW(),00);DEVOUT(mend_firm)
                        DEVPOS(PROW()+1,00);DEVOUT(mcid_firm)
                        DEVPOS(PROW()+1,00);DEVOUT('Fone: '+mfone_firm)
                        DEVPOS(PROW()+1,00);DEVOUT('Inscr. '+minsc_firm+'   C.G.C.: '+mcgc_firm)
                        @ PROW()+1,00 SAY mtraco
                        @ PROW()+1,00 SAY ' '
                        @ PROW(),00 SAY 'Fornecedor:'
                        @ PROW(),PCOL()+1 SAY STRZERO(mcod_forn,4)
                        @ PROW(),PCOL()+1 SAY mfornece
                        @ PROW()+1,00 SAY mtraco
                        imprt(mtipo_imp,'E',1)
                        pitalico(.T.)
                        @ PROW(),00 SAY 'DUPLICATA No.: '+mn_dup5+mdup5
                        @ PROW()+1,00 SAY 'No.da Nota fiscal: '+mnota
                        pitalico(.F.)
                        imprt(mtipo_imp,'N')
                        @ PROW()+1,00 SAY mtraco
                        @ PROW()+1,00 SAY 'Emissao...:'
                        @ PROW(),12 SAY memissao
                        @ PROW()+1,00 SAY 'Vencimento:'
                        @ PROW(),12 SAY mvenc5
                        @ PROW()+1,00 SAY 'Tipo de Pagamento: A P R A Z O'
                        @ PROW()+1,00 SAY mtraco
                        DEVPOS(PROW()+1,00);DEVOUT(PADC('Valor R$: ('+LTRIM(TRANSFORM(mvlr5,'99,999,999.99'))+')',60))
                        DEVPOS(PROW(),00);DEVOUT(PADC('Valor R$: ('+LTRIM(TRANSFORM(mvlr5,'99,999,999.99'))+')',60))
*                       mextenso:= '('+extenso(mvlr5,.T.)+')'
                        mextenso:= '('+RTRIM(EXT(mvlr5))+')'
                        mlinha := MLCOUNT(mextenso,80)
                        FOR lin = 1 TO mlinha
                                mlin := MEMOLINE(mextenso,80,lin,,10)
                                DEVPOS(PROW()+1,00);DEVOUT(PADR(RTRIM(mlin),80))
                        NEXT
                        @ PROW()+1,00 SAY mtraco
                        IF EMPTY(mdup6)
                                EJECT
                        ELSE
                                @ PROW()+3,00 SAY mtraco
                        ENDIF
                        SETPRC(00,00)
                ENDIF
        ENDIF
        IF ! EMPTY(mvlr6) .AND. ! EMPTY(mdup6)
                sr_getconnection():exec('INSERT INTO sacdupp '+;
                                '(empresa ,'+;
                                'tipo      ,'+;
                                'duplicata ,'+;
                                'tip_for   ,'+;
                                'fornec    ,'+;
                                'cliente   ,'+;
                                'emissao   ,'+;
                                'venc      ,'+;
                                'banco     ,'+;
                                'valor     ,'+;
                                'pago      ,'+;
                                'num_ped   ,'+;
                                'operador  ,'+;
                                'tp_pg     ,'+;
                                'obs       ,'+;
                                'SR_DELETED )'+;
                                ' VALUES ('+;
                                sr_cdbvalue(mcodempresa         )+','+; //1
                                sr_cdbvalue(mn_dup6             )+','+; //2
                                sr_cdbvalue(mdup6               )+','+; //3
                                sr_cdbvalue(mtip_for            )+','+; //4
                                sr_cdbvalue(STRZERO(mcod_forn,4))+','+; //5
                                sr_cdbvalue(mfornece            )+','+; //6
                                sr_cdbvalue(memissao            )+','+; //7
                                sr_cdbvalue(mvenc6              )+','+; //8
                                sr_cdbvalue(STRZERO(mbanco,3)   )+','+; //9
                                sr_cdbvalue(mvlr6               )+','+; //10
                                sr_cdbvalue(" "                 )+','+; //11
                                sr_cdbvalue(mnota               )+','+; //12
                                sr_cdbvalue(cod_operado         )+','+; //13
                                sr_cdbvalue(mtp_pg              )+','+; //14
                                sr_cdbvalue(mobs                )+','+; //15
                                sr_cdbvalue(' ')+')',,.f.)
                IF mprn = 'S'
                        imprt(mtipo_imp,'E')
                        pitalico(.T.)
                        DEVPOS(PROW(),00);DEVOUT(memp_resa)
                        pitalico(.F.)
                        imprt(mtipo_imp,'N',1)
                        DEVPOS(PROW(),00);DEVOUT(mend_firm)
                        DEVPOS(PROW()+1,00);DEVOUT(mcid_firm)
                        DEVPOS(PROW()+1,00);DEVOUT('Fone: '+mfone_firm)
                        DEVPOS(PROW()+1,00);DEVOUT('Inscr. '+minsc_firm+'   C.G.C.: '+mcgc_firm)
                        @ PROW()+1,00 SAY mtraco
                        @ PROW()+1,00 SAY ' '
                        @ PROW(),00 SAY 'Fornecedor:'
                        @ PROW(),PCOL()+1 SAY STRZERO(mcod_forn,4)
                        @ PROW(),PCOL()+1 SAY mfornece
                        @ PROW()+1,00 SAY mtraco
                        imprt(mtipo_imp,'E',1)
                        pitalico(.T.)
                        @ PROW(),00 SAY 'DUPLICATA No.: '+mn_dup6+mdup6
                        @ PROW()+1,00 SAY 'No.da Nota fiscal: '+mnota
                        pitalico(.F.)
                        imprt(mtipo_imp,'N')
                        @ PROW()+1,00 SAY mtraco
                        @ PROW()+1,00 SAY 'Emissao...:'
                        @ PROW(),12 SAY memissao
                        @ PROW()+1,00 SAY 'Vencimento:'
                        @ PROW(),12 SAY mvenc6
                        @ PROW()+1,00 SAY 'Tipo de Pagamento: A P R A Z O'
                        @ PROW()+1,00 SAY mtraco
                        DEVPOS(PROW()+1,00);DEVOUT(PADC('Valor R$: ('+LTRIM(TRANSFORM(mvlr6,'99,999,999.99'))+')',60))
                        DEVPOS(PROW(),00);DEVOUT(PADC('Valor R$: ('+LTRIM(TRANSFORM(mvlr6,'99,999,999.99'))+')',60))
*                       mextenso:= '('+extenso(mvlr6,.T.)+')'
                        mextenso:= '('+RTRIM(EXT(mvlr6))+')'
                        mlinha := MLCOUNT(mextenso,80)
                        FOR lin = 1 TO mlinha
                                mlin := MEMOLINE(mextenso,80,lin,,10)
                                DEVPOS(PROW()+1,00);DEVOUT(PADR(RTRIM(mlin),80))
                        NEXT
                        @ PROW()+1,00 SAY mtraco
                        IF EMPTY(mdup7)
                                EJECT
                        ELSE
                                @ PROW()+3,00 SAY mtraco
                        ENDIF
                        SETPRC(00,00)
                ENDIF
        ENDIF
        IF ! EMPTY(mvlr7) .AND. ! EMPTY(mdup7)
                sr_getconnection():exec('INSERT INTO sacdupp '+;
                                '(empresa ,'+;
                                'tipo      ,'+;
                                'duplicata ,'+;
                                'tip_for   ,'+;
                                'fornec    ,'+;
                                'cliente   ,'+;
                                'emissao   ,'+;
                                'venc      ,'+;
                                'banco     ,'+;
                                'valor     ,'+;
                                'pago      ,'+;
                                'num_ped   ,'+;
                                'operador  ,'+;
                                'tp_pg     ,'+;
                                'obs       ,'+;
                                'SR_DELETED )'+;
                                ' VALUES ('+;
                                sr_cdbvalue(mcodempresa         )+','+; //1
                                sr_cdbvalue(mn_dup7             )+','+; //2
                                sr_cdbvalue(mdup7               )+','+; //3
                                sr_cdbvalue(mtip_for            )+','+; //4
                                sr_cdbvalue(STRZERO(mcod_forn,4))+','+; //5
                                sr_cdbvalue(mfornece            )+','+; //6
                                sr_cdbvalue(memissao            )+','+; //7
                                sr_cdbvalue(mvenc7              )+','+; //8
                                sr_cdbvalue(STRZERO(mbanco,3)   )+','+; //9
                                sr_cdbvalue(mvlr7               )+','+; //10
                                sr_cdbvalue(" "                 )+','+; //11
                                sr_cdbvalue(mnota               )+','+; //12
                                sr_cdbvalue(cod_operado         )+','+; //13
                                sr_cdbvalue(mtp_pg              )+','+; //14
                                sr_cdbvalue(mobs                )+','+; //15
                                sr_cdbvalue(' ')+')',,.f.)
                IF mprn = 'S'
                        imprt(mtipo_imp,'E')
                        pitalico(.T.)
                        DEVPOS(PROW(),00);DEVOUT(memp_resa)
                        pitalico(.F.)
                        imprt(mtipo_imp,'N',1)
                        DEVPOS(PROW(),00);DEVOUT(mend_firm)
                        DEVPOS(PROW()+1,00);DEVOUT(mcid_firm)
                        DEVPOS(PROW()+1,00);DEVOUT('Fone: '+mfone_firm)
                        DEVPOS(PROW()+1,00);DEVOUT('Inscr. '+minsc_firm+'   C.G.C.: '+mcgc_firm)
                        @ PROW()+1,00 SAY mtraco
                        @ PROW()+1,00 SAY ' '
                        @ PROW(),00 SAY 'Fornecedor:'
                        @ PROW(),PCOL()+1 SAY STRZERO(mcod_forn,4)
                        @ PROW(),PCOL()+1 SAY mfornece
                        @ PROW()+1,00 SAY mtraco
                        imprt(mtipo_imp,'E',1)
                        pitalico(.T.)
                        @ PROW(),00 SAY 'DUPLICATA No.: '+mn_dup7+mdup7
                        @ PROW()+1,00 SAY 'No.da Nota fiscal: '+mnota
                        pitalico(.F.)
                        imprt(mtipo_imp,'N')
                        @ PROW()+1,00 SAY mtraco
                        @ PROW()+1,00 SAY 'Emissao...:'
                        @ PROW(),12 SAY memissao
                        @ PROW()+1,00 SAY 'Vencimento:'
                        @ PROW(),12 SAY mvenc7
                        @ PROW()+1,00 SAY 'Tipo de Pagamento: A P R A Z O'
                        @ PROW()+1,00 SAY mtraco
                        DEVPOS(PROW()+1,00);DEVOUT(PADC('Valor R$: ('+LTRIM(TRANSFORM(mvlr7,'99,999,999.99'))+')',60))
                        DEVPOS(PROW(),00);DEVOUT(PADC('Valor R$: ('+LTRIM(TRANSFORM(mvlr7,'99,999,999.99'))+')',60))
*                       mextenso:= '('+extenso(mvlr7,.T.)+')'
                        mextenso:= '('+RTRIM(EXT(mvlr7))+')'
                        mlinha := MLCOUNT(mextenso,80)
                        FOR lin = 1 TO mlinha
                                mlin := MEMOLINE(mextenso,80,lin,,10)
                                DEVPOS(PROW()+1,00);DEVOUT(PADR(RTRIM(mlin),80))
                        NEXT
                        @ PROW()+1,00 SAY mtraco
                        IF EMPTY(mdup8)
                                EJECT
                        ELSE
                                @ PROW()+3,00 SAY mtraco
                        ENDIF
                        SETPRC(00,00)
                ENDIF
        ENDIF
        IF ! EMPTY(mvlr8) .AND. ! EMPTY(mdup8)
                sr_getconnection():exec('INSERT INTO sacdupp '+;
                                '(empresa ,'+;
                                'tipo      ,'+;
                                'duplicata ,'+;
                                'tip_for   ,'+;
                                'fornec    ,'+;
                                'cliente   ,'+;
                                'emissao   ,'+;
                                'venc      ,'+;
                                'banco     ,'+;
                                'valor     ,'+;
                                'pago      ,'+;
                                'num_ped   ,'+;
                                'operador  ,'+;
                                'tp_pg     ,'+;
                                'obs       ,'+;
                                'SR_DELETED )'+;
                                ' VALUES ('+;
                                sr_cdbvalue(mcodempresa         )+','+; //1
                                sr_cdbvalue(mn_dup8             )+','+; //2
                                sr_cdbvalue(mdup8               )+','+; //3
                                sr_cdbvalue(mtip_for            )+','+; //4
                                sr_cdbvalue(STRZERO(mcod_forn,4))+','+; //5
                                sr_cdbvalue(mfornece            )+','+; //6
                                sr_cdbvalue(memissao            )+','+; //7
                                sr_cdbvalue(mvenc8              )+','+; //8
                                sr_cdbvalue(STRZERO(mbanco,3)   )+','+; //9
                                sr_cdbvalue(mvlr8               )+','+; //10
                                sr_cdbvalue(" "                 )+','+; //11
                                sr_cdbvalue(mnota               )+','+; //12
                                sr_cdbvalue(cod_operado         )+','+; //13
                                sr_cdbvalue(mtp_pg              )+','+; //14
                                sr_cdbvalue(mobs                )+','+; //15
                                sr_cdbvalue(' ')+')',,.f.)
                IF mprn = 'S'
                        imprt(mtipo_imp,'E')
                        pitalico(.T.)
                        DEVPOS(PROW(),00);DEVOUT(memp_resa)
                        pitalico(.F.)
                        imprt(mtipo_imp,'N',1)
                        DEVPOS(PROW(),00);DEVOUT(mend_firm)
                        DEVPOS(PROW()+1,00);DEVOUT(mcid_firm)
                        DEVPOS(PROW()+1,00);DEVOUT('Fone: '+mfone_firm)
                        DEVPOS(PROW()+1,00);DEVOUT('Inscr. '+minsc_firm+'   C.G.C.: '+mcgc_firm)
                        @ PROW()+1,00 SAY mtraco
                        @ PROW()+1,00 SAY ' '
                        @ PROW(),00 SAY 'Fornecedor:'
                        @ PROW(),PCOL()+1 SAY STRZERO(mcod_forn,4)
                        @ PROW(),PCOL()+1 SAY mfornece
                        @ PROW()+1,00 SAY mtraco
                        imprt(mtipo_imp,'E',1)
                        pitalico(.T.)
                        @ PROW(),00 SAY 'DUPLICATA No.: '+mn_dup8+mdup8
                        @ PROW()+1,00 SAY 'No.da Nota fiscal: '+mnota
                        pitalico(.F.)
                        imprt(mtipo_imp,'N')
                        @ PROW()+1,00 SAY mtraco
                        @ PROW()+1,00 SAY 'Emissao...:'
                        @ PROW(),12 SAY memissao
                        @ PROW()+1,00 SAY 'Vencimento:'
                        @ PROW(),12 SAY mvenc8
                        @ PROW()+1,00 SAY 'Tipo de Pagamento: A P R A Z O'
                        @ PROW()+1,00 SAY mtraco
                        DEVPOS(PROW()+1,00);DEVOUT(PADC('Valor R$: ('+LTRIM(TRANSFORM(mvlr8,'99,999,999.99'))+')',60))
                        DEVPOS(PROW(),00);DEVOUT(PADC('Valor R$: ('+LTRIM(TRANSFORM(mvlr8,'99,999,999.99'))+')',60))
*                       mextenso:= '('+extenso(mvlr8,.T.)+')'
                        mextenso:= '('+RTRIM(EXT(mvlr8))+')'
                        mlinha := MLCOUNT(mextenso,80)
                        FOR lin = 1 TO mlinha
                                mlin := MEMOLINE(mextenso,80,lin,,10)
                                DEVPOS(PROW()+1,00);DEVOUT(PADR(RTRIM(mlin),80))
                        NEXT
                        @ PROW()+1,00 SAY mtraco
                        IF EMPTY(mdup9)
                                EJECT
                        ELSE
                                @ PROW()+3,00 SAY mtraco
                        ENDIF
                        SETPRC(00,00)
                ENDIF
        ENDIF
        IF ! EMPTY(mvlr9) .AND. ! EMPTY(mdup9)
                sr_getconnection():exec('INSERT INTO sacdupp '+;
                                '(empresa ,'+;
                                'tipo      ,'+;
                                'duplicata ,'+;
                                'tip_for   ,'+;
                                'fornec    ,'+;
                                'cliente   ,'+;
                                'emissao   ,'+;
                                'venc      ,'+;
                                'banco     ,'+;
                                'valor     ,'+;
                                'pago      ,'+;
                                'num_ped   ,'+;
                                'operador  ,'+;
                                'tp_pg     ,'+;
                                'obs       ,'+;
                                'SR_DELETED )'+;
                                ' VALUES ('+;
                                sr_cdbvalue(mcodempresa         )+','+; //1
                                sr_cdbvalue(mn_dup9             )+','+; //2
                                sr_cdbvalue(mdup9               )+','+; //3
                                sr_cdbvalue(mtip_for            )+','+; //4
                                sr_cdbvalue(STRZERO(mcod_forn,4))+','+; //5
                                sr_cdbvalue(mfornece            )+','+; //6
                                sr_cdbvalue(memissao            )+','+; //7
                                sr_cdbvalue(mvenc9              )+','+; //8
                                sr_cdbvalue(STRZERO(mbanco,3)   )+','+; //9
                                sr_cdbvalue(mvlr9               )+','+; //10
                                sr_cdbvalue(" "                 )+','+; //11
                                sr_cdbvalue(mnota               )+','+; //12
                                sr_cdbvalue(cod_operado         )+','+; //13
                                sr_cdbvalue(mtp_pg              )+','+; //14
                                sr_cdbvalue(mobs                )+','+; //15
                                sr_cdbvalue(' ')+')',,.f.)
                IF mprn = 'S'
                        imprt(mtipo_imp,'E')
                        pitalico(.T.)
                        DEVPOS(PROW(),00);DEVOUT(memp_resa)
                        pitalico(.F.)
                        imprt(mtipo_imp,'N',1)
                        DEVPOS(PROW(),00);DEVOUT(mend_firm)
                        DEVPOS(PROW()+1,00);DEVOUT(mcid_firm)
                        DEVPOS(PROW()+1,00);DEVOUT('Fone: '+mfone_firm)
                        DEVPOS(PROW()+1,00);DEVOUT('Inscr. '+minsc_firm+'   C.G.C.: '+mcgc_firm)
                        @ PROW()+1,00 SAY mtraco
                        @ PROW()+1,00 SAY ' '
                        @ PROW(),00 SAY 'Fornecedor:'
                        @ PROW(),PCOL()+1 SAY STRZERO(mcod_forn,4)
                        @ PROW(),PCOL()+1 SAY mfornece
                        @ PROW()+1,00 SAY mtraco
                        imprt(mtipo_imp,'E',1)
                        pitalico(.T.)
                        @ PROW(),00 SAY 'DUPLICATA No.: '+mn_dup9+mdup9
                        @ PROW()+1,00 SAY 'No.da Nota fiscal: '+mnota
                        pitalico(.F.)
                        imprt(mtipo_imp,'N')
                        @ PROW()+1,00 SAY mtraco
                        @ PROW()+1,00 SAY 'Emissao...:'
                        @ PROW(),12 SAY memissao
                        @ PROW()+1,00 SAY 'Vencimento:'
                        @ PROW(),12 SAY mvenc9
                        @ PROW()+1,00 SAY 'Tipo de Pagamento: A P R A Z O'
                        @ PROW()+1,00 SAY mtraco
                        DEVPOS(PROW()+1,00);DEVOUT(PADC('Valor R$: ('+LTRIM(TRANSFORM(mvlr9,'99,999,999.99'))+')',60))
                        DEVPOS(PROW(),00);DEVOUT(PADC('Valor R$: ('+LTRIM(TRANSFORM(mvlr9,'99,999,999.99'))+')',60))
*                       mextenso:= '('+extenso(mvlr9,.T.)+')'
                        mextenso:= '('+RTRIM(EXT(mvlr9))+')'
                        mlinha := MLCOUNT(mextenso,80)
                        FOR lin = 1 TO mlinha
                                mlin := MEMOLINE(mextenso,80,lin,,10)
                                DEVPOS(PROW()+1,00);DEVOUT(PADR(RTRIM(mlin),80))
                        NEXT
                        @ PROW()+1,00 SAY mtraco
                        IF EMPTY(mdup10)
                                EJECT
                        ELSE
                                @ PROW()+3,00 SAY mtraco
                        ENDIF
                        SETPRC(00,00)
                ENDIF
        ENDIF
        IF ! EMPTY(mvlr10) .AND. ! EMPTY(mdup10)
                sr_getconnection():exec('INSERT INTO sacdupp '+;
                                '(empresa ,'+;
                                'tipo      ,'+;
                                'duplicata ,'+;
                                'tip_for   ,'+;
                                'fornec    ,'+;
                                'cliente   ,'+;
                                'emissao   ,'+;
                                'venc      ,'+;
                                'banco     ,'+;
                                'valor     ,'+;
                                'pago      ,'+;
                                'num_ped   ,'+;
                                'operador  ,'+;
                                'tp_pg     ,'+;
                                'obs       ,'+;
                                'SR_DELETED )'+;
                                ' VALUES ('+;
                                sr_cdbvalue(mcodempresa         )+','+; //1
                                sr_cdbvalue(mn_dup10            )+','+; //2
                                sr_cdbvalue(mdup10              )+','+; //3
                                sr_cdbvalue(mtip_for            )+','+; //4
                                sr_cdbvalue(STRZERO(mcod_forn,4))+','+; //5
                                sr_cdbvalue(mfornece            )+','+; //6
                                sr_cdbvalue(memissao            )+','+; //7
                                sr_cdbvalue(mvenc10             )+','+; //8
                                sr_cdbvalue(STRZERO(mbanco,3)   )+','+; //9
                                sr_cdbvalue(mvlr10              )+','+; //10
                                sr_cdbvalue(" "                 )+','+; //11
                                sr_cdbvalue(mnota               )+','+; //12
                                sr_cdbvalue(cod_operado         )+','+; //13
                                sr_cdbvalue(mtp_pg              )+','+; //14
                                sr_cdbvalue(mobs                )+','+; //15
                                sr_cdbvalue(' ')+')',,.f.)
                IF mprn = 'S'
                        imprt(mtipo_imp,'E')
                        pitalico(.T.)
                        DEVPOS(PROW(),00);DEVOUT(memp_resa)
                        pitalico(.F.)
                        imprt(mtipo_imp,'N',1)
                        DEVPOS(PROW(),00);DEVOUT(mend_firm)
                        DEVPOS(PROW()+1,00);DEVOUT(mcid_firm)
                        DEVPOS(PROW()+1,00);DEVOUT('Fone: '+mfone_firm)
                        DEVPOS(PROW()+1,00);DEVOUT('Inscr. '+minsc_firm+'   C.G.C.: '+mcgc_firm)
                        @ PROW()+1,00 SAY mtraco
                        @ PROW()+1,00 SAY ' '
                        @ PROW(),00 SAY 'Fornecedor:'
                        @ PROW(),PCOL()+1 SAY STRZERO(mcod_forn,4)
                        @ PROW(),PCOL()+1 SAY mfornece
                        @ PROW()+1,00 SAY mtraco
                        imprt(mtipo_imp,'E',1)
                        pitalico(.T.)
                        @ PROW(),00 SAY 'DUPLICATA No.: '+mn_dup10+mdup10
                        @ PROW()+1,00 SAY 'No.da Nota fiscal: '+mnota
                        pitalico(.F.)
                        imprt(mtipo_imp,'N')
                        @ PROW()+1,00 SAY mtraco
                        @ PROW()+1,00 SAY 'Emissao...:'
                        @ PROW(),12 SAY memissao
                        @ PROW()+1,00 SAY 'Vencimento:'
                        @ PROW(),12 SAY mvenc10
                        @ PROW()+1,00 SAY 'Tipo de Pagamento: A P R A Z O'
                        @ PROW()+1,00 SAY mtraco
                        DEVPOS(PROW()+1,00);DEVOUT(PADC('Valor R$: ('+LTRIM(TRANSFORM(mvlr10,'99,999,999.99'))+')',60))
                        DEVPOS(PROW(),00);DEVOUT(PADC('Valor R$: ('+LTRIM(TRANSFORM(mvlr10,'99,999,999.99'))+')',60))
*                       mextenso:= '('+extenso(mvlr10,.T.)+')'
                        mextenso:= '('+RTRIM(EXT(mvlr10))+')'
                        mlinha := MLCOUNT(mextenso,80)
                        FOR lin = 1 TO mlinha
                                mlin := MEMOLINE(mextenso,80,lin,,10)
                                DEVPOS(PROW()+1,00);DEVOUT(PADR(RTRIM(mlin),80))
                        NEXT
                        @ PROW()+1,00 SAY mtraco
                        @ PROW()+2,00 SAY '  '
                        EJECT
                        SETPRC(00,00)
                ENDIF
        ENDIF
        IF op_dup = 'S'
                sr_getconnection():exec('INSERT INTO sacdupp '+;
                                '(empresa ,'+;
                                'tipo      ,'+;
                                'duplicata ,'+;
                                'tip_for   ,'+;
                                'fornec    ,'+;
                                'cliente   ,'+;
                                'emissao   ,'+;
                                'venc      ,'+;
                                'banco     ,'+;
                                'valor     ,'+;
                                'pago      ,'+;
                                'num_ped   ,'+;
                                'operador  ,'+;
                                'tp_pg     ,'+;
                                'obs       ,'+;
                                'datpag    ,'+;
                                'vlpago    ,'+;
                                'pago      ,'+;
                                'SR_DELETED )'+;
                                ' VALUES ('+;
                                sr_cdbvalue(mcodempresa         )+','+; //1
                                sr_cdbvalue('FR'             )+','+; //2
                                sr_cdbvalue(mdoc_frete               )+','+; //3
                                sr_cdbvalue(mtip_for            )+','+; //4
                                sr_cdbvalue(STRZERO(mcod_forn,4))+','+; //5
                                sr_cdbvalue(forn->razao            )+','+; //6
                                sr_cdbvalue(memissao            )+','+; //7
                                sr_cdbvalue(mdata_frete              )+','+; //8
                                sr_cdbvalue(STRZERO(mbanco,3)   )+','+; //9
                                sr_cdbvalue(mdisp_aux               )+','+; //10
                                sr_cdbvalue(" "                 )+','+; //11
                                sr_cdbvalue(mnota               )+','+; //12
                                sr_cdbvalue(cod_operado         )+','+; //13
                                sr_cdbvalue(mtp_pg              )+','+; //14
                                sr_cdbvalue(mobs                )+','+; //15
                                IF(mdata_frete = memissao,sr_cdbvalue(memissao),'NULL')+','+; //13
                                IF(mdata_frete = memissao,sr_cdbvalue(mdisp_aux),'NULL')+','+; //13
                                IF(mdata_frete = memissao,sr_cdbvalue('B'),'NULL')+','+; //13
                                sr_cdbvalue(' ')+')',,.f.)

                IF mprn = 'S'
                        imprt(mtipo_imp,'E')
                        pitalico(.T.)
                        DEVPOS(PROW(),00);DEVOUT(memp_resa)
                        pitalico(.F.)
                        imprt(mtipo_imp,'N',1)
                        DEVPOS(PROW(),00);DEVOUT(mend_firm)
                        DEVPOS(PROW()+1,00);DEVOUT(mcid_firm)
                        DEVPOS(PROW()+1,00);DEVOUT('Fone: '+mfone_firm)
                        DEVPOS(PROW()+1,00);DEVOUT('Inscr. '+minsc_firm+'   C.G.C.: '+mcgc_firm)
                        @ PROW()+1,00 SAY mtraco
                        @ PROW()+1,00 SAY ' '
                        @ PROW(),00 SAY 'Frete apaga  a:'
                        @ PROW(),PCOL()+1 SAY STRZERO(mcod_trans,4)
                        @ PROW(),PCOL()+1 SAY forn->razao
                        @ PROW()+1,00 SAY mtraco
                        imprt(mtipo_imp,'E',1)
                        pitalico(.T.)
                        @ PROW(),00 SAY 'DUPLICATA No.: FR'+mdoc_frete
                        @ PROW()+1,00 SAY 'No.da Nota fiscal: '+mnota
                        @ PROW(),PCOL()+3 SAY 'F R E T E '
                        pitalico(.F.)
                        imprt(mtipo_imp,'N')
                        @ PROW()+1,00 SAY mtraco
                        @ PROW()+1,00 SAY 'Emissao...:'
                        @ PROW(),12 SAY memissao
                        @ PROW()+1,00 SAY 'Vencimento:'
                        @ PROW(),12 SAY mdata_frete
                        @ PROW(),12 SAY mdata_frete
                        IF mdata_frete = memissao
                                @ PROW()+1,00 SAY 'Tipo de Pagamento: A V I S T A'
                        ELSE
                                @ PROW()+1,00 SAY 'Tipo de Pagamento: A P R A Z O'
                        ENDIF
                        @ PROW()+1,00 SAY mtraco
                        DEVPOS(PROW()+1,00);DEVOUT(PADC('Valor R$: ('+LTRIM(TRANSFORM(mdisp_aux,'99,999,999.99'))+')',60))
                        DEVPOS(PROW(),00);DEVOUT(PADC('Valor R$: ('+LTRIM(TRANSFORM(mdisp_aux,'99,999,999.99'))+')',60))
*                       mextenso:= '('+extenso(mdisp_aux,.T.)+')'
                        mextenso:= '('+RTRIM(EXT(mdisp_aux))+')'
                        mlinha := MLCOUNT(mextenso,80)
                        FOR lin = 1 TO mlinha
                                mlin := MEMOLINE(mextenso,80,lin,,10)
                                DEVPOS(PROW()+1,00);DEVOUT(PADR(RTRIM(mlin),80))
                        NEXT
                        @ PROW()+1,00 SAY mtraco
                        @ PROW()+2,00 SAY '  '
                        EJECT
                        SETPRC(00,00)
                ENDIF
        ENDIF
        EJECT
        SETPRC(00,00)
        SET DEVI TO SCREEN;SET PRINT TO;SET PRINT OFF
        sr_getconnection():exec("COMMIT",,.f.)
        conf_impressao(marq)
        RELEASE mvenc1,mvenc2,mvenc3,mvenc4,mvenc5,mbanco,mfornec,mtransp,mdata_frete
        wvw_lclosewindow()
        RETURN NIL
ENDDO
wvw_lclosewindow()
RETURN NIL
**************************  F I M  *************************
* IMPRIMI O RESUMO DA NOTA DE ENTRADA
*************************************
FUNCTION imp_resu(mt_nt,mnum_nota)
**********************************
LOCAL mtraco,mquantd,mdoc_ent,mpreco_v,i,f,mpag,mtit,mcforn,mcont_mov:=0,;
      cons_mov:={},cons_merc:={},mvolume:=0,cons_forn:={},cons_tot := {}

MEMVAR mcod_forn,mvlr_nota

PRIVATE mtipo_imp,mimp_tipo:=0,marq:=SPACE(35)
mtipo_imp := m_indiv[1,18]
mtraco := REPLI('=',132)
mquantd := 1
mop_dupp := 'N'
CLEAR GETS
op_tela(10,10,11,40,'*** IMPRESSAO DO RESUMO DA NOTA ***')
DEVPOS(00,01);DEVOUT('Quantidades de copias:')
@ 00,COL()+2 GET mquantd PICT '99'
READ
wvw_lclosewindow()
mpreco_v := op_simnao('N','Deseja Imprimir so o PRECO DE VENDA: ',,,,0)
IF mquantd = 0
        RETURN NIL
ENDIF
WHILE .T.
        IF mt_nt = 'NF'
                cons_tot := {}
                sr_getconnection():exec("SELECT * FROM sactotnt WHERE documento = "+sr_cdbvalue(mt_nt+mnum_nota)+" AND ent_sai = 'E' AND cod_cli = "+sr_cdbvalue(STRZERO(mcod_forn,4)),,.t.,@cons_tot)
                IF LEN(cons_tot) = 0
                        atencao('Nao foi possivel encontra esta NOTA FISCAL (SACTOTNT)')
                        RETURN .F.
                ENDIF
        ELSE
                cons_tot := {}
                //sr_getconnection():exec("SELECT * FROM sactotnt WHERE SR_RECNO = "+sr_cdbvalue(1),,.t.,@cons_tot)
                sr_getconnection():exec("SELECT * FROM sactotnt WHERE vl_nota > 5 AND vl_nota < 100",,.t.,@cons_tot)
        ENDIF
        mdoc_ent := mt_nt+mnum_nota     //+'  '
        cons_mov := {}
        sr_getconnection():exec("SELECT * FROM sacmov WHERE documento = "+sr_cdbvalue(mdoc_ent)+" AND ent_sai = 'E' AND cod_forn = "+sr_cdbvalue(STRZERO(mcod_forn,4)),,.t.,@cons_mov)
        IF LEN(cons_mov) = 0
                atencao('Nao foi possivel encontra esta NOTA FISCAL (SACMOV)')
                RETURN .F.
        ENDIF
        IF mt_nt # 'NF'
                cons_tot[1,32] := cons_mov[1,55]
                cons_tot[1,33] := cons_mov[1,56]
                cons_tot[1,34] := cons_mov[1,57]
        ENDIF
        cons_forn := {}
        sr_getconnection():exec("SELECT * FROM sacforn WHERE cod_forn = "+sr_cdbvalue(cons_mov[1,40]),,.t.,@cons_forn)
        IF LEN(cons_forn) = 0
                atencao('Nao foi possivel encontra esta FORNECEDOR')
                RETURN .F.
        ENDIF
        i := mvolume := 0
        FOR i = 1 TO LEN(cons_mov)
                mvolume := mvolume + cons_mov[i,19]
        NEXT
        IF op_simnao('S','Deseja imprimir o relatorio financeiro (Duplicatas):') = 'S'
                mop_dupp := 'S'
        ENDIF
        mensagem('Aguarde o final da Impressao - <ESC> Cancelar!!!')
        IF ! imp_arq('RES_NOTA.REL','R')
                LOOP
        ENDIF
        i := f := mcont_mov := 0
        FOR f = 1 TO mquantd
                mpag := 1
                mtit := 'RESUMO DA NOTA FISCAL DE ENTRADA'
                cabecalho(mpag,mtit)
                imprt(mtipo_imp,'N')
                DEVPOS(PROW()+1,00);DEVOUT(PADC('DADOS DA NOTA',80))
                imprt(mtipo_imp,'C')
                DEVPOS(PROW()+1,00);DEVOUT('Fornecedor:')
                DEVPOS(PROW(),11);DEVOUT(cons_mov[1,40]+' - '+cons_forn[1,2])
                DEVPOS(PROW(),PCOL()+1);DEVOUT('ICM:')
                IF mt_nt = 'NF'
                        DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(cons_mov[1,42],'99.99'))
                ENDIF
                DEVPOS(PROW(),PCOL()+2);DEVOUT('Cond.Pagamento:')
                DEVPOS(PROW(),PCOL()+1);DEVOUT(cons_mov[1,48]+' dd '+cons_mov[1,49]+' dd '+cons_mov[1,50])
                DEVPOS(PROW(),PCOL()+2);DEVOUT('Documento:')
                DEVPOS(PROW(),PCOL()+1);DEVOUT(cons_mov[1,2])
                DEVPOS(PROW(),PCOL()+2);DEVOUT('Cod.:')
                DEVPOS(PROW(),PCOL()+1);DEVOUT(cons_mov[1,67])
                DEVPOS(PROW()+1,00);DEVOUT('Cod.Operador:')
                DEVPOS(PROW(),PCOL()+1);DEVOUT(cons_mov[1,30])
                DEVPOS(PROW(),PCOL()+2);DEVOUT('Volume:')
                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(0,'999,999.99'))
                DEVPOS(PROW(),PCOL()+2);DEVOUT('Chegada:')
                DEVPOS(PROW(),PCOL()+1);DEVOUT(cons_mov[1,16])
                DEVPOS(PROW(),PCOL()+2);DEVOUT('Frete:')
                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(cons_tot[1,32],'999,999.99'))
                DEVPOS(PROW(),PCOL()+2);DEVOUT('Encargos:')
                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(cons_tot[1,33],'999,999.99'))
                DEVPOS(PROW(),PCOL()+2);DEVOUT('Disp.Acess.:')
                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(cons_tot[1,34],'999,999.99'))
                DEVPOS(PROW()+1,00);DEVOUT('Valor Nota:')
                IF mt_nt = 'NF'
                        DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(cons_tot[1,27],'99,999,999.99'))
                ELSE
                        DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(mvlr_nota,'99,999,999.99'))
                ENDIF
                IF mt_nt = 'NF'
                        DEVPOS(PROW(),PCOL()+2);DEVOUT('Base do ICMS R$: '+TRANSFORM(cons_tot[1,20],'999,999.99'))
                        DEVPOS(PROW(),PCOL()+2);DEVOUT('Valor do ICMS R$: '+TRANSFORM(cons_tot[1,21],'999,999.99'))
                        DEVPOS(PROW()+1,00);DEVOUT('Base ICMS Substituicao R$: '+TRANSFORM(cons_tot[1,22],'999,999.99'))
                        DEVPOS(PROW(),PCOL()+2);DEVOUT('Valor ICMS Substituicao R$: '+TRANSFORM(cons_tot[1,23],'999,999.99'))
                ENDIF
                DEVPOS(PROW()+1,00);DEVOUT(mtraco)
                DEVPOS(PROW()+1,00);DEVOUT('Cod.')
                DEVPOS(PROW(),07);DEVOUT('Descricao')
                DEVPOS(PROW(),49);DEVOUT('UN')
                DEVPOS(PROW(),56);DEVOUT('Peso')
                DEVPOS(PROW(),63);DEVOUT('Quantd.')
                DEVPOS(PROW(),PCOL()+1);DEVOUT(' Lucro')
                DEVPOS(PROW(),PCOL()+1);DEVOUT(' Prc.Unit.')
                DEVPOS(PROW(),PCOL()+1);DEVOUT(' Desc1')
                //DEVPOS(PROW(),PCOL()+1);DEVOUT(' Desc2')
                //DEVPOS(PROW(),PCOL()+1);DEVOUT(' Desc3')
                DEVPOS(PROW(),PCOL()+1);DEVOUT(' IPI %')
                DEVPOS(PROW(),PCOL()+1);DEVOUT('IPI R$')
                DEVPOS(PROW(),PCOL()+1);DEVOUT('  I.I.')
                DEVPOS(PROW(),PCOL()+1);DEVOUT('ICMS %')
                DEVPOS(PROW()+1,00);DEVOUT(mtraco)
                i := mcont_mov := 0
                FOR mcont_mov = 1 TO LEN(cons_mov)
                        cons_merc:={}
                        sr_getconnection():exec("SELECT * FROM sacmerc WHERE cod_merc = "+sr_cdbvalue(cons_mov[mcont_mov,10]),,.t.,@cons_merc)
                        DEVPOS(PROW()+1,00);DEVOUT(cons_mov[mcont_mov,10])
                        DEVPOS(PROW(),07);DEVOUT(cons_merc[1,9])
                        DEVPOS(PROW(),49);DEVOUT(cons_merc[1,14])
                        DEVPOS(PROW(),52);DEVOUT(TRANSFORM(cons_mov[mcont_mov,63],'9999.999'))
                        DEVPOS(PROW(),61);DEVOUT(TRANSFORM(cons_mov[mcont_mov,19],'999999.99'))
                        IF mpreco_v = 'N'
                                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(cons_merc[1,22],'999.99'))
                                //DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(cons_merc[1,42],'999,999.99'))
                                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(cons_mov[mcont_mov,25],'999,999.99'))
                                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(cons_mov[mcont_mov,58],'999.99'))
                                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(cons_mov[mcont_mov,61],'999.99'))
                                //DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(cons_mov[mcont_mov,60],'999.99'))
                                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(cons_mov[mcont_mov,62]/cons_mov[mcont_mov,19],'999.99'))
                                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(0,'999.99'))
                                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(cons_mov[mcont_mov,42],'99.99'))
                                DEVPOS(PROW()+1,00);DEVOUT('Vlr.merc:')
                                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(cons_mov[mcont_mov,25],'999,999.99'))
                                DEVPOS(PROW(),PCOL()+2);DEVOUT('Cust.merc:')
                                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(cons_mov[mcont_mov,26],'999,999.99'))
                                DEVPOS(PROW(),PCOL()+2);DEVOUT('Cust.Real:')
                                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(cons_merc[1,45],'999,999.99'))
                                DEVPOS(PROW(),PCOL()+2);DEVOUT('Lucro:')
                                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(cons_merc[1,46]-cons_merc[1,45],'99,999.99'))
                                DEVPOS(PROW(),PCOL()+2);DEVOUT('Cust.Medio:')
                                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(cons_merc[1,48],'999,999.99'))
                        ENDIF
                        DEVPOS(PROW(),111);DEVOUT('Prc.Vend.:')
                        DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(cons_merc[1,46],'999,999.99'))
                        DEVPOS(PROW()+1,00);DEVOUT('Saldo Anterior:')
                        DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(cons_mov[mcont_mov,18],'999,999.99'))
                        DEVPOS(PROW(),PCOL()+2);DEVOUT('Saldo Atual:')
                        DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(cons_mov[mcont_mov,18]+cons_mov[mcont_mov,19],'999,999.99'))
                        DEVPOS(PROW()+1,00);DEVOUT(REPLI('-',132))
                        IF PROW() > 59
                                EJECT
                                mpag ++
                                cabecalho(mpag,mtit)
                                imprt(mtipo_imp,'C')
                                DEVPOS(PROW()+1,00);DEVOUT('Cod.')
                                DEVPOS(PROW(),07);DEVOUT('Descricao')
                                DEVPOS(PROW(),49);DEVOUT('UN')
                                DEVPOS(PROW(),56);DEVOUT('Peso')
                                DEVPOS(PROW(),63);DEVOUT('Quantd.')
                                DEVPOS(PROW(),PCOL()+1);DEVOUT(' Lucro')
                                DEVPOS(PROW(),PCOL()+1);DEVOUT(' Prc.Unit.')
                                DEVPOS(PROW(),PCOL()+1);DEVOUT(' Desc1')
                                //DEVPOS(PROW(),PCOL()+1);DEVOUT(' Desc2')
                                //DEVPOS(PROW(),PCOL()+1);DEVOUT(' Desc3')
                                DEVPOS(PROW(),PCOL()+1);DEVOUT(' IPI %')
                                DEVPOS(PROW(),PCOL()+1);DEVOUT('IPI R$')
                                DEVPOS(PROW(),PCOL()+1);DEVOUT('  I.I.')
                                DEVPOS(PROW(),PCOL()+1);DEVOUT('ICMS %')
                                imprt(mtipo_imp,'N')
                                DEVPOS(PROW()+1,00);DEVOUT('Continuacao')
                                imprt(mtipo_imp,'C')
                                DEVPOS(PROW()+1,00);DEVOUT(mtraco)
                        ENDIF
                NEXT
                IF mop_dupp = 'S'
                        cons_dupp := {}
                        sr_getconnection():exec("SELECT * FROM sacdupp WHERE fornec = "+sr_cdbvalue(STRZERO(mcod_forn,4))+" AND num_ped = "+sr_cdbvalue(SUBSTR(cons_mov[1,2],3)),,.t.,@cons_dupp)
                        IF PROW()+LEN(cons_dupp)+7 > 59
                                mpag ++
                                cabecalho(mpag,mtit)
                        ENDIF
                        IF LEN(cons_dupp) > 0
                                imprt(mtipo_imp,'N')
                                DEVPOS(PROW()+1,00);DEVOUT(PADC('DADOS FINANCEIRO DA NOTA (',80))
                                imprt(mtipo_imp,'C')
                                DEVPOS(PROW()+1,00);DEVOUT('Fornecedor:')
                                DEVPOS(PROW(),11);DEVOUT(cons_mov[1,40]+' - '+cons_forn[1,2])
                                DEVPOS(PROW(),PCOL()+2);DEVOUT('Cond.Pagamento:')
                                DEVPOS(PROW(),PCOL()+1);DEVOUT(cons_mov[1,48]+' dd '+cons_mov[1,49]+' dd '+cons_mov[1,50])
                                DEVPOS(PROW(),PCOL()+2);DEVOUT('Documento:')
                                DEVPOS(PROW(),PCOL()+1);DEVOUT(cons_mov[1,2])
                                DEVPOS(PROW()+1,00);DEVOUT('Cod.Operador:')
                                DEVPOS(PROW(),PCOL()+1);DEVOUT(cons_mov[1,30])
                                DEVPOS(PROW()+1,00);DEVOUT('Valor Nota:')
                                IF mt_nt = 'NF'
                                        DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(cons_tot[1,27],'99,999,999.99'))
                                ELSE
                                        DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(mvlr_nota,'99,999,999.99'))
                                ENDIF
                                DEVPOS(PROW()+1,00);DEVOUT(mtraco)
                                DEVPOS(PROW()+1,00);DEVOUT('Documento     Emissao  Vencimento    Valor R$')
                                DEVPOS(PROW()+1,00);DEVOUT(mtraco)
                                i:=0
                                FOR i = 1 TO LEN(cons_dupp)
                                        DEVPOS(PROW()+1,00);DEVOUT(cons_dupp[i,2]+cons_dupp[i,4]+' '+DTOC(cons_dupp[i,9])+'    '+DTOC(cons_dupp[i,10])+'  '+TRANSFORM(cons_dupp[i,16],'999,999.99'))
                                NEXT
                        ENDIF
                ENDIF
                DEVPOS(PROW()+3,00);DEVOUT(TIME())
                EJECT
                SETPRC(00,00)
        NEXT
        SET DEVI TO SCREEN;SET PRINT TO;SET PRINT OFF
        conf_impressao('RES_NOTA.REL')
        RETURN NIL
ENDDO
RETURN NIL
************************************* F I M *************************************
* VERIFICA SE A NOTA JA FOI PROCESSADA
***************************************
FUNCTION ver_ent()
******************
LOCAL msele,morde,pesq,tnota,cons_ent:={}
MEMVAR mnota,mcod_forn,mcod_op

IF EMPTY(mnota) .OR. LEN(ALLTRIM(mnota)) < 6
        RETURN .F.
ENDIF
tnota := 'NF'+mnota
cons_ent:={}
sr_getconnection():exec( "select tipo from sacmov where sacmov.documento = "+sr_cdbvalue(tnota)+" AND sacmov.ent_sai = 'E' AND sacmov.cod_forn = "+sr_cdbvalue(STRZERO(mcod_forn,4)),,.t.,@cons_ent)
*************
IF LEN(cons_ent) > 0
        IF cons_ent[1,1] = mcod_op
                atencao('Esta nota ja foi processada OK !!!')
                RETURN .F.
        ELSE
                RETURN .T.
        ENDIF
ELSE
        RETURN .T.
ENDIF
************************************* F I M *************************************
* ALTERACAO DE DADOS DA ENTRADA
*******************************
FUNCTION alt_dados(tp)
**********************
LOCAL lba,cba,opcao,point,tela,i,mquantd_aux,mpreco_aux,msele:=0,morde:=0,mponto:=0
MEMVAR mcus_merc,mcus_real,mtot_des,mtot_vlr,mtot_vol,m_entrada,mvlr_nota,;
       mfrete_aux,menc_aux,mvlr_icmsub,msoma,mvol_nota,m_demo,mquantd,mp_lucro,;
       mpr_unit,mipi,mipi_aux,mii,mii_aux,mvlr_merc,mpr_venda,mpr_medio,mdesc1,;
       mdesc2,mdesc3,mcod_merc,tp_ipi,mv,mdesc_aux,mp

msele := SELE()
morde := INDEXORD();IF(EMPTY(morde),morde := 0,morde)

IF LEN(m_entrada) = 0
        atencao('Nao foi digitadao nenhum produto na entrada de produto....')
        RETURN .F.
ENDIF
lba := 22
cba := 78
point := 0
opcao := ' '
mponto := RECNO()
*************
//SELE('merc');ORDSETFOCUS(1)
//GO TOP
*************
op_tela(0,0,lba,cba,'ALTERACAO DE MERCADORIA')
WHILE .T.
        i := mtot_des := mtot_vlr := mtot_vol := mquantd_aux := mpreco_aux := 0
        FOR i = 1 TO LEN(m_entrada)
                mtot_des := (m_entrada[i,4] * m_entrada[i,10])
                mtot_des := mtot_des - (mtot_des * (m_entrada[i,14] / 100))
                mtot_des := mtot_des - (mtot_des * (m_entrada[i,15] / 100))
                mtot_des := mtot_des - (mtot_des * (m_entrada[i,16] / 100))
                mtot_vlr := mtot_vlr + (mtot_des + ((m_entrada[i,4]*m_entrada[i,10]) * (m_entrada[i,12]/100)))
                mtot_vlr := iat(mtot_vlr,2)
                mtot_vol := iat(mtot_vol + m_entrada[i,20],set_aredonda)
        NEXT
        msoma := mtot_vlr - (mvlr_nota - mfrete_aux - menc_aux - mvlr_icmsub)
        IF (msoma <= set_vlr_ent .AND. msoma >= (set_vlr_ent * -1));
           .AND. iat(mtot_vol,set_aredonda) = mvol_nota
                CLEAR GETS
                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                GO mponto
                wvw_lclosewindow()
                RETURN .T.
        ENDIF
        IF (mtot_vlr = (mvlr_nota - menc_aux - mfrete_aux - mvlr_icmsub) .AND. mtot_vol <> mvol_nota);
           .OR. (mtot_vlr > (mvlr_nota - mfrete_aux - menc_aux - mvlr_icmsub) .AND. iat(mtot_vol,set_aredonda) > mvol_nota);
           .OR. (mtot_vlr <> (mvlr_nota - mfrete_aux - menc_aux - mvlr_icmsub) .AND. mtot_vol = mvol_nota);
           .OR. tp <> '*'
                @ lba-7,1 TO lba-7,cba-1
                @ lba-3,1 TO lba-3,cba-1
                janela(lba-7,0,' Mercadorias Solicitadas ','*',1)
                DEVPOS(lba-6,1);DEVOUT('Cod.Produto:')
                DEVPOS(lba-6,63);DEVOUT('UN:')
                DEVPOS(lba-5,1);DEVOUT('Quantd.:')
                DEVPOS(lba-5,21);DEVOUT('Lucro:')
                DEVPOS(lba-5,34);DEVOUT('%')
                DEVPOS(lba-5,37);DEVOUT('Vlr.Unit.:')
                DEVPOS(lba-4,1);DEVOUT('Desc.1:')
                //DEVPOS(lba-4,18);DEVOUT('Desc.2:')
                DEVPOS(lba-4,35);DEVOUT('Desc.3:')
                DEVPOS(lba-4,52);DEVOUT('IPI:')
                DEVPOS(lba-4,66);DEVOUT('I.I.:')

                janela(lba-3,0,' D I F E R E N C A S ','*',1)
                setcor(1)
                DEVPOS(lba-2,1);DEVOUT('Vlr Nota:')
                DEVPOS(lba-2,25);DEVOUT('Vlr Pedido:')
                DEVPOS(lba-2,51);DEVOUT('Dif.:')
                DEVPOS(lba-1,1);DEVOUT('Volume Nota:')
                DEVPOS(lba-1,27);DEVOUT('Volume Pedido:')
                DEVPOS(lba-1,55);DEVOUT('Diferenca:')
                setcor(3)
                DEVPOS(lba-2,11);DEVOUT(TRANSFORM(mvlr_nota - menc_aux - mfrete_aux,'9,999,999.99'))
                DEVPOS(lba-2,37);DEVOUT(TRANSFORM(mtot_vlr,'9,999,999.99'))
                DEVPOS(lba-2,57);DEVOUT(TRANSFORM(mtot_vlr - (mvlr_nota - menc_aux - mfrete_aux - mvlr_icmsub),'999999,999.99'))
                DEVPOS(lba-1,14);DEVOUT(TRANSFORM(mvol_nota,'999999.9999'))
                DEVPOS(lba-1,42);DEVOUT(TRANSFORM(mtot_vol,'999999.9999'))
                DEVPOS(lba-1,66);DEVOUT(TRANSFORM(mvol_nota - mtot_vol,'999999.9999'))

                point := ACHOICE(1,1,lba-8,cba-1,m_demo,,,point)

                DO CASE
                        CASE LASTKEY()=27
                                CLEAR GETS
                                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                                GO mponto
                                wvw_lclosewindow()
                                RETURN .F.
                        CASE LASTKEY() = 13
                                CLEAR GETS
                                IF ! aut_sen('**** Senha p/Liberar a Alteracao:','ALT_DADOS')
                                        CLEAR GETS
                                        ASIZE(m_entrada,0)
                                        ASIZE(m_tipo4,0)
                                        ASIZE(m_demo,0)
                                        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                                        GO mponto
                                        wvw_lclosewindow()
                                        RETURN .F.
                                ENDIF
                                mquantd := m_entrada[point,20]
                                mp_lucro := 0
                                mpr_unit := m_entrada[point,21]
                                mipi := mipi_aux := m_entrada[point,12]
                                mii := mii_aux := m_entrada[point,22]
                                mvlr_merc := m_entrada[point,5]
                                mcus_merc := m_entrada[point,6]
                                mcus_real := m_entrada[point,7]
                                mpr_venda := m_entrada[point,9]
                                mpr_medio := m_entrada[point,8]
                                mdesc1 := m_entrada[point,14]
                                mdesc2 := m_entrada[point,15]
                                mdesc3 := m_entrada[point,16]
                                mcod_merc := m_entrada[point,2]
                                //GO TOP
                                //merc->(DBSEEK(STRZERO(m_entrada[point,2],5)))
                                DEVPOS(lba-6,14);DEVOUT(STRZERO(m_entrada[point,2],5))
                                DEVPOS(lba-6,20);DEVOUT(m_entrada[point,3])
                                DEVPOS(lba-6,68);DEVOUT(mcons_merc[1,14])
                                setcor(1)
                                mp_lucro := mcons_merc[1,22]
                                @ lba-5,10 GET mquantd PICT (unidade(mcons_merc[1,14])) VALID IF(EMPTY(mquantd),.F.,.T.)
                                @ lba-5,28 GET mp_lucro PICT '999.99'               //VALID lim_get() WHEN men_get(lba-9,28,'Informe o percentual de lucro que deseja')
                                @ lba-5,48 GET mpr_unit PICT '9,999,999.9999' VALID IF(EMPTY(mpr_unit),.F.,.T.)
                                @ lba-4,08 GET mdesc1 PICT '9999.9999'              //VALID lim_get() WHEN men_get(lba-9,09,'Informe desconto '+tp_ipi)
                                //@ lba-4,25 GET mdesc2 PICT '9999.9999'              //VALID lim_get() WHEN men_get(lba-9,29,'Informe desconto '+tp_ipi)
                                @ lba-4,42 GET mdesc3 PICT '9999.9999'              //VALID lim_get() WHEN men_get(lba-9,45,'Informe desconto '+tp_ipi)
                                @ lba-4,56 GET mipi_aux PICT '9999.9999'            //VALID lim_get() WHEN men_get(lba-9,45,'Informe IPI '+tp_ipi)
                                @ lba-4,71 GET mii_aux PICT '9999.999'              //VALID lim_get() WHEN men_get(lba-9,45,'Informe I.I. [Imposto de Importacao] '+tp_ipi)
                                READ
                                IF LASTKEY() = 27
                                        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                                        GO mponto
                                        wvw_lclosewindow()
                                        RETURN .F.
                                ENDIF
                                mquantd_aux := mquantd
                                mpreco_aux := mpr_unit
                                IF mcons_merc[1,76] > 1
                                        mquantd := mquantd * mcons_merc[1,76]
                                        mpr_unit := ((mpr_unit*mquantd_aux) / mquantd)
                                ENDIF
                                IF mv = 'X'
                                        mipi := (mipi_aux / (mquantd * mpr_unit)) * 100
                                        mii := (mii_aux / (mquantd * mpr_unit)) * 100
                                        mdesc_aux := (mdesc1 / (mquantd * mpr_unit)) * 100
                                        mdesc1 := mdesc_aux
                                        mdesc_aux := (mdesc2 / (mquantd * mpr_unit)) * 100
                                        mdesc2 := mdesc_aux
                                        mdesc_aux := (mdesc3 / (mquantd * mpr_unit)) * 100
                                        mdesc3 := mdesc_aux
                                ELSEIF mp = 'X'
                                        mipi := mipi_aux
                                        mii := mii_aux
                                ENDIF
                                * Calculo de Custo da Mercadoria
                                calc_cus()
                                ********************************
                                opcao := op_simnao('S','Confirma a Alteracao [S/n]:')
                                IF opcao = 'N';LOOP;ENDIF
                                m_entrada[point,10] := mquantd
                                m_entrada[point,20] := mquantd_aux
                                m_entrada[point,21]  := mpreco_aux
                                m_entrada[point,4]  := mpr_unit
                                m_entrada[point,12] := mipi
                                m_entrada[point,5]   := mvlr_merc
                                m_entrada[point,6]  := mcus_merc
                                m_entrada[point,7]  := mcus_real
                                m_entrada[point,9]  := mpr_venda
                                m_entrada[point,8]  := mpr_medio
                                m_entrada[point,14] := mdesc1
                                m_entrada[point,15] := mdesc2
                                m_entrada[point,16] := mdesc3
                                m_entrada[point,22] := mii
                                m_demo[point] := STRZERO(m_entrada[point,2],5)+'-'+m_entrada[point,3]+' '+TRANSFORM(mquantd,'99999.9999')+' '+TRANSFORM(mpr_unit,'9,999,999.9999')
                ENDCASE
        ELSE
                CLEAR GETS
                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                GO mponto
                wvw_lclosewindow()
                RETURN .F.
        ENDIF
ENDDO
SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
GO mponto
wvw_lclosewindow()
RETURN NIL
**************************  F I M  *************************
* IMPRIMI O RESUMO DA NOTA DE ENTRADA P/VERIFICACAO
***************************************************
FUNCTION resu_veri
******************
LOCAL mtraco,mquantd,mdoc_ent,i,f,mpag,mtit
MEMVAR mnota,mcod_forn,mfornece,m_entrada,micm,mdia1,mdia2,mdia3,mcod_op,mvol_nota,;
       mvlr_nota,mchegada,mfrete_aux,menc_aux,mdisp_aux,mvlr_icmsub,tela,m_tipo4
mtraco := REPLI('=',80)
mquantd := 0
CLEAR GETS
botao(10,10,12,30,'*** RELATORIO DE VERIFICACAO *** Quantidades de copias:',,,,0)
@ 11,COL()+1 GET mquantd PICT '99'
READ
IF mquantd = 0
        RETURN NIL
ENDIF
WHILE .T.
        mquantd := mquantd +1
        mdoc_Ent := 'NF'+mnota
        IF ! imp_arq('RES_NOTA.REL','R')
                LOOP
        ENDIF
        i := f := 0
        FOR f = 1 TO mquantd
                mensagem('Aguarde o final da Impressao da Copia:'+TRANSFORM(mquantd,'999')+' - <ESC> Cancelar!!!')
                mpag := 1
                mtit := 'RESUMO DA NOTA FISCAL DE ENTRADA P/VERIFICACAO'
                cabecalho(mpag,mtit)
                imprt(mtipo_imp,'N')
                DEVPOS(PROW()+1,00);DEVOUT(PADC('DADOS DA NOTA',80))
                imprt(mtipo_imp,'C')
                DEVPOS(PROW()+1,00);DEVOUT('Fornecedor:')
                DEVPOS(PROW(),PCOL()+1);DEVOUT(STRZERO(mcod_forn,4)+' - '+mfornece)
                DEVPOS(PROW(),PCOL()+2);DEVOUT('ICM:')
                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(micm,'99.99'))
                DEVPOS(PROW(),PCOL()+2);DEVOUT('Cond.Pagamento:')
                DEVPOS(PROW(),PCOL()+1);DEVOUT(mdia1+' dd '+mdia2+' dd '+mdia3)
                DEVPOS(PROW(),PCOL()+2);DEVOUT('Documento:')
                DEVPOS(PROW(),PCOL()+1);DEVOUT(mnota)
                DEVPOS(PROW(),PCOL()+2);DEVOUT('Cod.:')
                DEVPOS(PROW(),PCOL()+1);DEVOUT(mcod_op)
                DEVPOS(PROW()+1,00);DEVOUT('Volume:')
                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(mvol_nota,'999,999.999'))
                DEVPOS(PROW(),PCOL()+2);DEVOUT('Valor Nota:')
                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(mvlr_nota,'99,999,999.99'))
                DEVPOS(PROW(),PCOL()+2);DEVOUT('Chegada:')
                DEVPOS(PROW(),PCOL()+1);DEVOUT(mchegada)
                DEVPOS(PROW(),PCOL()+2);DEVOUT('Frete:')
                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(mfrete_aux,'999,999.99'))
                DEVPOS(PROW(),PCOL()+2);DEVOUT('Encargos:')
                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(menc_aux,'999,999.99'))
                DEVPOS(PROW(),PCOL()+2);DEVOUT('Disp.Acess.:')
                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(mdisp_aux,'999,999.99'))
                DEVPOS(PROW()+1,00);DEVOUT('Valor do ICM Substituicao R$:')
                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(mvlr_icmsub,'999,999.99'))
                imprt(mtipo_imp,'N')
                DEVPOS(PROW()+1,00);DEVOUT(mtraco)
                imprt(mtipo_imp,'C')
                DEVPOS(PROW()+1,00);DEVOUT('Cod.')
                DEVPOS(PROW(),07);DEVOUT('Descricao')
                DEVPOS(PROW(),49);DEVOUT('Verificacao')
                imprt(mtipo_imp,'N')
                DEVPOS(PROW()+1,00);DEVOUT(mtraco)
                *************
                SELE('merc');ORDSETFOCUS(1)
                GO TOP
                *************
                i := 0
                FOR i = 1 TO LEN(m_entrada)
                        SEEK STRZERO(m_entrada[i,2],5)
                        imprt(mtipo_imp,'C')
                        DEVPOS(PROW()+1,00);DEVOUT(STRZERO(m_entrada[i,2],5))
                        DEVPOS(PROW(),PCOL()+2);DEVOUT(mcons_merc[1,9])
                        DEVPOS(PROW(),PCOL()+2);DEVOUT('...................')
                        imprt(mtipo_imp,'N')
                        DEVPOS(PROW()+1,00);DEVOUT(REPLI('-',80))
                        IF PROW() > 59
                                EJECT
                                mpag ++
                                cabecalho(mpag,mtit)
                                imprt(mtipo_imp,'C')
                                DEVPOS(PROW()+1,00);DEVOUT('Cod.')
                                DEVPOS(PROW(),07);DEVOUT('Descricao')
                                DEVPOS(PROW(),49);DEVOUT('Verificacao')
                                imprt(mtipo_imp,'N')
                                DEVPOS(PROW()+1,00);DEVOUT('Continuacao')
                                DEVPOS(PROW()+1,00);DEVOUT(mtraco)
                        ENDIF
                NEXT
                DEVPOS(PROW()+3,00);DEVOUT(TIME())
                EJECT
                SETPRC(00,00)
        NEXT
        SET DEVI TO SCREEN;SET PRINT TO;SET PRINT OFF
        conf_impressao('RES_NOTA.REL')
        RESTSCREEN(01,00,24,79,tela)
        RETURN NIL
ENDDO
RETURN NIL
************************************* F I M *************************************
* ATUALIZAR O ARQUIVO DE MOVIMENTO
**********************************
FUNCTION atu_movi(mtpo_nota,mtpo,atu_i)
***************************************
IF mtpo <> '02'
        IF ! EMPTY(m_entrada[atu_i,27])
                mtot_icm := mtot_icm + ((m_entrada[atu_i,5] * m_entrada[atu_i,10]) * (m_entrada[atu_i,27]/100))
        ENDIF
        mtot_ipi := mtot_ipi + (m_entrada[atu_i,5] * m_entrada[atu_i,10]) * (m_entrada[atu_i,12]/100)
ENDIF
        cons_merc:={}
        sr_getconnection():exec("SELECT pr_venda FROM sacmerc WHERE cod_merc = "+sr_cdbvalue(STRZERO(m_entrada[atu_i,2],5)),,.t.,@cons_merc)

        ccomm := 'INSERT INTO sacmov (empresa,'+;
        'documento,serie,modelo,'+;
        'num_ped,ped_forn,'
        IF ! EMPTY(mdata_ped)
                ccomm := ccomm + 'data_pd,'
        ENDIF
        ccomm := ccomm + 'gru_sub,codigo,produto,cod_fab,'+;
        'fabrica,unidade,data_s_e,ent_sai,'+;
        'saldo_ant,quantd,quantd_aux,'+;
        'pr_venda,pr_venda1,pr_unit,cust_mer,cod_forn,'+;
        'fornece,uf_cli,icm_aliq,icm,icm_sub,'+;
        'fob,cif,dia1,dia2,dia3,emissao,'
        IF ! EMPTY(msaida)
                ccomm := ccomm + 'saida,'
        ENDIF
        ccomm := ccomm + 'chegada,frete,encargo_f,disp_asse,'+;
        'ipi_aliq,ipi,peso,desc1,desc2,desc3,'+;
        'tipo,isento,sittrib,cod_nat,cod_oper,norm_ele,'+;
        'SR_DELETED )'+;
        ' VALUES ('+;
        sr_cdbvalue(mcodempresa            )+','+; //1
        sr_cdbvalue(mtpo_nota+mnota        )+','+; //2
        sr_cdbvalue(mserie                 )+','+; //3
        sr_cdbvalue(mmodelo                )+','+; //4
        sr_cdbvalue(STRZERO(mnum_ped,6)    )+','+; //5
        sr_cdbvalue(mped_forn              )+',' //6
        IF ! EMPTY(mdata_ped)
                ccomm := ccomm + sr_cdbvalue(mdata_pd)+','
        ENDIF
        ccomm := ccomm + sr_cdbvalue(m_entrada[atu_i,1]         )+','+; //8
        sr_cdbvalue(STRZERO(m_entrada[atu_i,2],5))+','+;//9
        sr_cdbvalue(m_entrada[atu_i,3]           )+','+;//10
        sr_cdbvalue(m_entrada[atu_i,17]          )+','+; //11
        sr_cdbvalue(LEFT(m_entrada[atu_i,18],30)          )+','+;//12
        sr_cdbvalue(m_entrada[atu_i,23]          )+','+;//13
        sr_cdbvalue(mchegada               )+','+;//14
        sr_cdbvalue('E'                    )+','+;//15
        sr_cdbvalue(m_entrada[atu_i,28]          )+','+;//16
        sr_cdbvalue(m_entrada[atu_i,10]          )+','+;//17
        sr_cdbvalue(m_entrada[atu_i,10]          )+','+;//18
        sr_cdbvalue(iat(m_entrada[atu_i,9],4))+','+;//20
        sr_cdbvalue(cons_merc[1,1]         )+','+;//19
        sr_cdbvalue(iat(m_entrada[atu_i,5],2))+','+;//21
        sr_cdbvalue(iat(m_entrada[atu_i,7],2))+','+;//21
        sr_cdbvalue(STRZERO(mcod_forn,4)   )+','+;//22
        sr_cdbvalue(LEFT(mfornece,30)               )+','+;//23
        sr_cdbvalue(forn->uf)+','+;//24
        sr_cdbvalue(iat(IF(mtpo <> '02',m_entrada[atu_i,27],0),2))+','+;//24
        sr_cdbvalue(iat(IF(mtpo <> '02' .AND. ! EMPTY(m_entrada[atu_i,27]),((m_entrada[atu_i,5] * m_entrada[atu_i,10]) * (m_entrada[atu_i,27]/100)),iat(0.00,2)),2))+','+;//24
        sr_cdbvalue(iat(IF(mtpo <> '02',m_entrada[atu_i,26],0),2))+','+;//24
        sr_cdbvalue(mfob                                                )+','+;//15
        sr_cdbvalue(mcif                                                )+','+;//16
        sr_cdbvalue(STRZERO(val(mdia1),2)                               )+','+;//17
        sr_cdbvalue(STRZERO(val(mdia2),2)                               )+','+;//18
        sr_cdbvalue(STRZERO(val(mdia3),2)                               )+','+;//19
        sr_cdbvalue(memissao                                            )+','//20
        IF ! EMPTY(msaida)
                ccomm := ccomm + sr_cdbvalue(msaida)+','//21
        ENDIF
        ccomm := ccomm + sr_cdbvalue(mchegada                                            )+','+;//22
        sr_cdbvalue(iat((m_entrada[atu_i,5] * m_entrada[atu_i,10]) * mfrete,2))+','+;//23
        sr_cdbvalue(iat((m_entrada[atu_i,5] * m_entrada[atu_i,10]) * mencargo_f,2))+','+;//24
        sr_cdbvalue(iat((m_entrada[atu_i,5] * m_entrada[atu_i,10]) * mdisp_asse,2))+','+;//13
        sr_cdbvalue(iat(m_entrada[atu_i,12],2)                                    )+','+;//14
        sr_cdbvalue(iat((m_entrada[atu_i,5] * m_entrada[atu_i,10]) * (m_entrada[atu_i,12]/100),2))+','+;//15
        sr_cdbvalue(iat(m_entrada[atu_i,13],2)                                    )+','+;//16
        sr_cdbvalue(iat((m_entrada[atu_i,4] * m_entrada[atu_i,10]) * (m_entrada[atu_i,14]/100),2))+','+;//17
        sr_cdbvalue(iat((m_entrada[atu_i,4] * m_entrada[atu_i,10])* (m_entrada[atu_i,15]/100),2))+','+;//18
        sr_cdbvalue(iat((m_entrada[atu_i,4] * m_entrada[atu_i,10])*(m_entrada[atu_i,16]/100),2))+','+;//19
        sr_cdbvalue(mtpo                                                )+','+;//20
        sr_cdbvalue(m_entrada[atu_i,19]                                 )+','+;//21
        sr_cdbvalue(m_entrada[atu_i,24]                                 )+','+;//22
        sr_cdbvalue(m_entrada[atu_i,25]                                 )+','+;//23
        sr_cdbvalue(cod_operado                                         )+','+;//13
        sr_cdbvalue(mnorm_ele                                           )+','+;//14
        sr_cdbvalue(' ')+')'
sr_getconnection():exec(ccomm,,.f.)
RETURN NIL
*********************************** f i m ***********************************************
FUNCTION calc_cus(consulta)
***************************
LOCAL icm_aux:=0,mmedio_ven,mtipo_preco,firm_aux:=0,pis_aux:=0,;
      confis_aux:=0,micm_calc:=0,calc_merc:={}
MEMVAR mcod_merc,micm,mcod_op,micm_firm,mpis,mconfis,mvlr_merc,mcust_merc,mpr_unit,;
       mdesc1,mdesc2,mdesc3,mencargo_f,mipi,mfrete,mii,mdisp_asse,mvlr_icmsub,;
       mvlr_nota,mimposto,mp_lucro,mfator,mcust_real,mquantd,mpr_medio,mpr_venda,;
       mpercent,mnivel_cal,micmsub

calc_merc:={}
cComm  := "SELECT * FROM sacmerc WHERE cod_merc = "+sr_cdbvalue(STRZERO(mcod_merc,5))
sr_getconnection():exec(ccomm,,.t.,@calc_merc)
IF LEN(calc_merc) = 0
        atencao('Codigo nao Cadastrado !!!')
        RETURN .F.
ENDIF
micm_calc := icm_aux := micm
firm_aux := micm_firm
pis_aux  := mpis
confis_aux := mconfis
IF calc_merc[1,61] = 'S'   //.OR. mcod_op = '02'
        micm_firm := micm_calc := 0
ENDIF
IF mnivel_cal = '1'
        mvlr_merc := mpr_unit - (mpr_unit*(mdesc1/100))
        //mvlr_merc := mvlr_merc - (mpr_unit*(mdesc2/100))
        //mvlr_merc := mvlr_merc - (mpr_unit*(mdesc3/100))
        mvlr_merc := mvlr_merc + (iat(mvlr_merc * mencargo_f,2)) + (iat(mvlr_merc * mfrete,2))
        IF mipi > 0
                mcust_merc := mvlr_merc + (mvlr_merc * (mipi/100)) - (mvlr_merc * (micm_calc/100))
        ELSE
                mcust_merc := mvlr_merc * (100 - micm_calc)
                mcust_merc := mcust_merc / 100
        ENDIF
        IF mii > 0
                mcust_merc := mvlr_merc + (mvlr_merc * (mii/100))
        ENDIF
        IF mdisp_asse > 0
                mcust_merc := mcust_merc + (mvlr_merc * mdisp_asse)
        ENDIF
        micmsub := 0
        IF mtipo_icmsub = 'I'
                //micmsub := (mvlr_merc * (mvlr_icm_sub/(mpr_unit * mquantd)))
                micmsub := (mvlr_merc) * (mvlr_icm_sub/100)
                mcust_merc := mcust_merc + micmsub
        ELSEIF mvlr_icmsub > 0 
                micmsub := (mvlr_merc * (mvlr_icmsub/mvlr_nota))
                mcust_merc := mcust_merc + micmsub
        ENDIF
        **********************************************************************
        //mfator := 100 - (mpis + mconfis + micm_firm + mimposto + mp_lucro)
        **********************************************************************
        mcust_real := (mcust_merc / (100 - (micm_firm + mpis + mconfis + mimposto)))*100
        IF calc_merc[1,56] > 0
                mpr_medio := ((mquantd * mcust_real) + (calc_merc[1,56] * calc_merc[1,48])) / (mquantd + calc_merc[1,56])
        ELSE
                mpr_medio := mcust_real
        ENDIF
        IF m_set[1,79] == 'O'
                mpr_venda := (mcust_merc / (100 - (micm_firm + mpis + mconfis + mimposto + mp_lucro)))*100
        ELSEIF m_set[1,79] == 'M'
                IF mpercent == 'P'
                        mpr_venda := mpr_medio * ((mp_lucro/100)+1)  // pelo CUSTO REAL
                ELSEIF mpercent == 'F'
                        mpr_venda := (mpr_medio / (100-mp_lucro)) * 100  // pelo CUSTO REAL
                ENDIF
        ELSEIF m_set[1,79] == 'R'
                IF mpercent == 'P'
                        mpr_venda := mcust_real * ((mp_lucro/100)+1)  // pelo CUSTO REAL
                ELSEIF mpercent == 'F'
                        mpr_venda := (mcust_real / (100-mp_lucro)) * 100  // pelo CUSTO REAL
                ENDIF
        ENDIF

        IF mcod_op = '04'
                mpr_unit4 := mpr_unit / IF(EMPTY(mper_vlr),1,mper_vlr/100)
                mvlr_merc4 := mpr_unit4 - (mpr_unit4*(mdesc1/100))
                mvlr_merc4 := mvlr_merc4 + (iat(mvlr_merc4 * mencargo_f,2)) + (iat(mvlr_merc4 * mfrete,2))

                IF mipi > 0
                        mcust_mer4 := mvlr_merc4 + (mvlr_merc4 * (mipi/100)) - (mvlr_merc4 * (micm_calc/100))
                ELSE
                        mcust_mer4 := mvlr_merc4 * (100 - micm_calc)
                        mcust_mer4 := mcust_mer4 / 100
                ENDIF
                IF mii > 0
                        mcust_mer4 := mvlr_merc4 + (mvlr_merc4 * (mii/100))
                ENDIF
                IF mdisp_asse > 0
                        mcust_mer4 := mcust_mer4 + (mvlr_merc4 * mdisp_asse)
                ENDIF
                micmsub := 0
                IF mvlr_icmsub > 0
                        micmsub := (mvlr_merc4 * (mvlr_icmsub/mvlr_nota))
                        mcust_mer4 := mcust_mer4 + micmsub
                ENDIF
                **********************************************************************
                //mfator := 100 - (mpis + mconfis + micm_firm + mimposto + mp_lucro)
                **********************************************************************
                mcust_rea4 := (mcust_mer4 / (100 - (micm_firm+mpis+mconfis+mimposto)))*100
                //mcust_rea4 := (mcust_mer4 / (100 - (micm_firm+mpis+mconfis+mimposto)))*100
                IF calc_merc[1,56] > 0
                        mpr_medio4 := ((mquantd * mcust_rea4) + (calc_merc[1,56] * calc_merc[1,48])) / (mquantd + calc_merc[1,56])
                ELSE
                        mpr_medio4 := mcust_rea4
                ENDIF
                IF m_set[1,79] == 'O'
                        mpr_venda4 := (mcust_mer4 / (100 - (micm_firm+mpis+mconfis+mimposto+mp_lucro)))*100
                ELSEIF m_set[1,79] == 'M'
                        IF mpercent == 'P'
                                mpr_venda4 := mpr_medio4 * ((mp_lucro/100)+1)  // pelo CUSTO REAL
                        ELSEIF mpercent == 'F'
                                mpr_venda4 := (mpr_medio4 / (100-mp_lucro)) * 100  // pelo CUSTO REAL
                        ENDIF
                ELSEIF m_set[1,79] == 'R'
                        IF mpercent == 'P'
                                mpr_venda4 := mcust_rea4 * ((mp_lucro/100)+1)  // pelo CUSTO REAL
                        ELSEIF mpercent == 'F'
                                mpr_venda4 := (mcust_rea4 / (100-mp_lucro)) * 100  // pelo CUSTO REAL
                        ENDIF
                ENDIF
        ENDIF
ELSEIF mnivel_cal = '2'
        mvlr_merc := mpr_unit
        mcust_merc := mvlr_merc
        mcust_real := mcust_merc
        mpr_medio := ((mquantd * mcust_real) + (calc_merc[1,56] * calc_merc[1,48])) / (mquantd + calc_merc[1,56])
        IF m_set[1,79] = 'M'
                mpr_venda := mpr_medio * ((mp_lucro/100)+1)  // pelo CUSTO REAL
        ELSEIF m_set[1,79] = 'R'
                mpr_venda := mcust_real * ((mp_lucro/100)+1)  // pelo CUSTO REAL
        ENDIF
ELSEIF mnivel_cal = '3'
        mvlr_merc := mpr_unit - (mpr_unit*(mdesc1/100))
        mvlr_merc := mvlr_merc + (iat(mvlr_merc * mencargo_f,2)) + (iat(mvlr_merc * mfrete,2))

        mcust_merc := mvlr_merc + (mvlr_merc * (mipi/100))

        IF mii > 0
                mcust_merc := mcust_merc + (mcust_merc * (mii/100))
        ENDIF
        IF mdisp_asse > 0
                mcust_merc := mcust_merc + (mcust_merc * mdisp_asse)
        ENDIF
        micmsub := 0
        IF mvlr_icmsub > 0
                micmsub := (mvlr_merc * (mvlr_icmsub/mvlr_nota))
                mcust_merc := mcust_merc + micmsub
        ENDIF

        mcust_real := mcust_merc*(((micm_firm - micm_calc)/100)+1)
        mcust_real := mcust_real*((mpis/100)+1)
        mcust_real := mcust_real*((mconfis/100)+1)
        mcust_real := mcust_real*((mimposto/100)+1)

        IF calc_merc[1,56] > 0
                mpr_medio := ((mquantd * mcust_real) + (calc_merc[1,56] * calc_merc[1,48])) / (mquantd + calc_merc[1,56])
        ELSE
                mpr_medio := mcust_real
        ENDIF
        IF m_set[1,79] == 'M'
                mpr_venda := mpr_medio * ((mp_lucro/100)+1)  // pelo CUSTO REAL
        ELSEIF m_set[1,79] == 'R'
                mpr_venda := mcust_real * ((mp_lucro/100)+1)  // pelo CUSTO REAL
        ENDIF
        IF mcod_op = '04'
                mpr_unit4 := mpr_unit / IF(EMPTY(mper_vlr),1,mper_vlr/100)
                mvlr_merc4 := mpr_unit4 - (mpr_unit4*(mdesc1/100))
                mvlr_merc4 := mvlr_merc4 + (iat(mvlr_merc4 * mencargo_f,2)) + (iat(mvlr_merc4 * mfrete,2))

                mcust_mer4 := mvlr_merc4 + (mvlr_merc4 * (mipi/100)) - (mvlr_merc4 * (micm_calc/100))
                IF mii > 0
                        mcust_mer4 := mcust_merc4 + (mvlr_merc4 * (mii/100))
                ENDIF
                IF mdisp_asse > 0
                        mcust_mer4 := mcust_mer4 + (mvlr_merc4 * mdisp_asse)
                ENDIF
                micmsub := 0
                IF mvlr_icmsub > 0
                        micmsub := (mvlr_merc4 * (mvlr_icmsub/mvlr_nota))
                        mcust_mer4 := mcust_mer4 + micmsub
                ENDIF

                mcust_rea4 := mcust_mer4*((micm_firm/100)+1)
                mcust_rea4 := mcust_rea4*((mpis/100)+1)
                mcust_rea4 := mcust_rea4*((mconfis/100)+1)
                mcust_rea4 := mcust_rea4*((mimposto/100)+1)

                IF calc_merc[1,56] > 0
                        mpr_medio4 := ((mquantd * mcust_rea4) + (calc_merc[1,56] * calc_merc[1,48])) / (mquantd + calc_merc[1,56])
                ELSE
                        mpr_medio4 := mcust_rea4
                ENDIF
                IF m_set[1,79] == 'M'
                        mpr_venda4 := mpr_medio4 * ((mp_lucro/100)+1)  // pelo CUSTO REAL
                ELSEIF m_set[1,79] == 'R'
                        mpr_venda4 := mcust_rea4 * ((mp_lucro/100)+1)  // pelo CUSTO REAL
                ENDIF
        ENDIF
ENDIF
op_tela(00,05,10,95,' RESUMO CALCULOS DOS PRECOS ')
mvlr_merc  :=  IAT(mvlr_merc)
mcust_merc :=  IAT(mcust_merc)
mcust_real :=  IAT(mcust_real)
mpr_medio  :=  IAT(mpr_medio)
mpr_venda  :=  IAT(mpr_venda)
WHILE .T.
        setcor(3)
        DEVPOS(0,01);DEVOUT(' Precos Anteriores ')
        @ 1,00 TO 1,95
        setcor(1)
        DEVPOS(2,01);DEVOUT(' Vlr.Mercad.')
        DEVPOS(2,14);DEVOUT(' Cus.Mercad.')
        DEVPOS(2,27);DEVOUT('  Custo Real')
        DEVPOS(2,40);DEVOUT(' Custo Medio')
        DEVPOS(2,53);DEVOUT(' Preco Venda')
        DEVPOS(2,66);DEVOUT('       Lucro')
        DEVPOS(4,01);DEVOUT('Saldo Atual da Mecadoria:             ')
        DEVPOS(5,0);DEVOUT(REPLI(CHR(223),95))
        //@ 5,0 TO 5,95
        setcor(3)
        DEVPOS(6,01);DEVOUT(' Precos Calculados ')
        @ 7,0 TO 7,95
        setcor(1)
        DEVPOS(8,01);DEVOUT(' Vlr.Mercad.')
        DEVPOS(8,14);DEVOUT(' Cus.Mercad.')
        DEVPOS(8,27);DEVOUT('  Custo Real')
        DEVPOS(8,40);DEVOUT(' Custo Medio')
        DEVPOS(8,53);DEVOUT(' Preco Venda')
        DEVPOS(8,66);DEVOUT('       Lucro')
        DEVPOS(10,01);DEVOUT('Saldo Apos a entrada:             ')

        setcor(3)
        DEVPOS(3,01);DEVOUTPICT(calc_merc[1,43],'9,999,999.99')
        DEVPOS(3,14);DEVOUTPICT(calc_merc[1,44],'9,999,999.99')
        DEVPOS(3,27);DEVOUTPICT(calc_merc[1,45],'9,999,999.99')
        DEVPOS(3,40);DEVOUTPICT(calc_merc[1,48],'9,999,999.99')
        DEVPOS(3,66);DEVOUTPICT(calc_merc[1,46]-calc_merc[1,48],'9,999,999.99')
        DEVPOS(4,27);DEVOUTPICT(calc_merc[1,56],'999,999.99')   

        DEVPOS(9,01);DEVOUTPICT(mvlr_merc,'9,999,999.99')
        DEVPOS(9,14);DEVOUTPICT(mcust_merc,'9,999,999.99')
        DEVPOS(9,27);DEVOUTPICT(mcust_real,'9,999,999.99')
        DEVPOS(9,40);DEVOUTPICT(mpr_medio,'9,999,999.99')
        DEVPOS(9,66);DEVOUTPICT(mpr_venda-mpr_medio,'9,999,999.99')
        DEVPOS(10,23);DEVOUTPICT(calc_merc[1,56]+mquantd,'999,999.99')
        IF mcust_real >= calc_merc[1,46]
                DEVPOS(3,53);DEVOUTPICT(calc_merc[1,46],'9,999,999.99')
                DEVPOS(9,53);DEVOUTPICT(mpr_venda,'9,999,999.99')
                IF 'N' = op_simnao('S','Preco de Venda Calculado R$: '+ALLTRIM(TRANSFORM(mpr_venda,'999,999.99'))+' e Maior que o Preco de Venda Anterior R$: '+ALLTRIM(TRANSFORM(calc_merc[1,46],'999,999,999.99'))+' ATUALIZAR')
                        IF ! aut_sen('Cod.Produto: '+STRZERO(mcod_merc,5)+' - Valor Custo Real Calculado: '+ALLTRIM(TRANSFORM(mcust_real,'999,999,999.99'))+' Preco de Venda Anterior: '+ALLTRIM(TRANSFORM(calc_merc[1,46],'999,999.99'))+' ... Senha de autorizacao:','LIB_ATU_PRECO',,,STRZERO(mcod_merc,5))
                                LOOP
                        ENDIF
                        mpr_venda := calc_merc[1,46]
                ENDIF
                EXIT
        ELSEIF calc_merc[1,46] <= mpr_venda
                DEVPOS(3,53);DEVOUTPICT(calc_merc[1,46],'9,999,999.99')
                DEVPOS(9,53);DEVOUTPICT(mpr_venda,'9,999,999.99')
                IF 'N' = op_simnao('S','Preco de Venda Atual Menor R$: '+ALLTRIM(TRANSFORM(calc_merc[1,46],'999,999,999.99'))+' que Preco Venda Calculado R$: '+ALLTRIM(TRANSFORM(mpr_venda,'999,999.99'))+' ATUALIZAR')
                        IF ! aut_sen('Cod.Produto: '+STRZERO(mcod_merc,5)+' - Valor Anterior: '+ALLTRIM(TRANSFORM(calc_merc[1,46],'999,999,999.99'))+' Preco de Venda Calculado: '+ALLTRIM(TRANSFORM(mpr_venda,'999,999.99'))+' ... Senha de autorizacao:','LIB_ATU_PRECO',,,STRZERO(mcod_merc,5))
                                LOOP
                        ENDIF
                        mpr_venda := calc_merc[1,46]
                ENDIF
                EXIT
        ELSEIF calc_merc[1,46] >= mpr_venda
                DEVPOS(3,53);DEVOUTPICT(calc_merc[1,46],'9,999,999.99')
                DEVPOS(9,53);DEVOUTPICT(mpr_venda,'9,999,999.99')
                IF 'S' = op_simnao('N','Preco de Venda ANTERIOR R$: '+ALLTRIM(TRANSFORM(calc_merc[1,46],'999,999,999.99'))+' Maior que Preco Venda Calculado R$: '+ALLTRIM(TRANSFORM(mpr_venda,'999,999.99'))+' ATUALIZAR')
                        IF ! aut_sen('Cod.Produto: '+STRZERO(mcod_merc,5)+' - Valor de Venda Anterior: '+ALLTRIM(TRANSFORM(calc_merc[1,46],'999,999,999.99'))+' Preco de Venda Calculado: '+ALLTRIM(TRANSFORM(mpr_venda,'999,999.99'))+' ... Senha de autorizacao:','LIB_ATU_PRECO',,,STRZERO(mcod_merc,5))
                                LOOP
                        ENDIF
                ELSE
                        mpr_venda := calc_merc[1,46]
                ENDIF
                EXIT
        ELSE
                DEVPOS(3,53);DEVOUTPICT(calc_merc[1,46],'9,999,999.99')
                DEVPOS(9,53);DEVOUTPICT(mpr_venda,'9,999,999.99')
        ENDIF
ENDDO
setcor(1)
******************
//SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
******************
micm       := icm_aux
micm_firm  := firm_aux
mpis       := pis_aux
mconfis    := confis_aux
wvw_lclosewindow()
RETURN .T.
************************** F I M **********************




